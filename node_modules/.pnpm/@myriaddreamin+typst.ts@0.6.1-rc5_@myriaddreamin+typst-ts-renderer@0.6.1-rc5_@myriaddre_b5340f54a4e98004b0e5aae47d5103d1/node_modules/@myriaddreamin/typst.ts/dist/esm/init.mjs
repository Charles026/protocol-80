class ComponentBuilder {
    loadedFonts = new Set();
    fetcher = fetch;
    setFetcher(fetcher) {
        this.fetcher = fetcher;
    }
    async loadFonts(builder, fonts) {
        const escapeImport = new Function('m', 'return import(m)');
        const fetcher = (this.fetcher ||= await (async function () {
            const { fetchBuilder, FileSystemCache } = await escapeImport('node-fetch-cache');
            const cache = new FileSystemCache({
                /// By default, we don't have a complicated cache policy.
                cacheDirectory: '.cache/typst/fonts',
            });
            const cachedFetcher = fetchBuilder.withCache(cache);
            return function (input, init) {
                const timeout = setTimeout(() => {
                    console.warn('font fetching is stucking:', input);
                }, 15000);
                return cachedFetcher(input, init).finally(() => {
                    clearTimeout(timeout);
                });
            };
        })());
        const fontsToLoad = fonts.filter(font => {
            if (font instanceof Uint8Array || (typeof font === 'object' && 'info' in font)) {
                return true;
            }
            if (this.loadedFonts.has(font)) {
                return false;
            }
            this.loadedFonts.add(font);
            return true;
        });
        const fontLists = await Promise.all(fontsToLoad.map(async (font) => {
            if (font instanceof Uint8Array) {
                await builder.add_raw_font(font);
                return;
            }
            if (typeof font === 'object' && 'info' in font) {
                await builder.add_lazy_font(font, 'blob' in font ? font.blob : loadFontSync(font));
                return;
            }
            return new Uint8Array(await (await fetcher(font)).arrayBuffer());
        }));
        for (const font of fontLists) {
            if (!font) {
                continue;
            }
            await builder.add_raw_font(font);
        }
    }
    async build(options, builder, hooks) {
        /// build typst component
        const buildCtx = { ref: this, builder, hooks };
        for (const fn of options?.beforeBuild ?? []) {
            await fn(undefined, buildCtx);
        }
        // await addPartialFonts(buildCtx);
        if (hooks.latelyBuild) {
            hooks.latelyBuild(buildCtx);
        }
        return await builder.build();
    }
}
/** @internal */
export async function buildComponent(options, gModule, Builder, hooks) {
    /// init typst wasm module
    await gModule.init(options?.getModule?.());
    return await new ComponentBuilder().build(options, new Builder(), hooks);
}
/**
 * Loads a font by a lazy font synchronously, which is required by the compiler.
 * @param font
 */
export function loadFontSync(font) {
    return () => {
        const xhr = new XMLHttpRequest();
        xhr.overrideMimeType('text/plain; charset=x-user-defined');
        xhr.open('GET', font.url, false);
        xhr.send(null);
        if (xhr.status === 200 &&
            (xhr.response instanceof String || typeof xhr.response === 'string')) {
            return Uint8Array.from(xhr.response, (c) => c.charCodeAt(0));
        }
        return new Uint8Array();
    };
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5pdC5tanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zcmMvaW5pdC5tdHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBOEJBLE1BQU0sZ0JBQWdCO0lBQ3BCLFdBQVcsR0FBRyxJQUFJLEdBQUcsRUFBVSxDQUFDO0lBQ2hDLE9BQU8sR0FBa0IsS0FBSyxDQUFDO0lBRS9CLFVBQVUsQ0FBQyxPQUFxQjtRQUM5QixJQUFJLENBQUMsT0FBTyxHQUFHLE9BQU8sQ0FBQztJQUN6QixDQUFDO0lBRUQsS0FBSyxDQUFDLFNBQVMsQ0FDYixPQUE4QixFQUM5QixLQUF5QztRQUV6QyxNQUFNLFlBQVksR0FBRyxJQUFJLFFBQVEsQ0FBQyxHQUFHLEVBQUUsa0JBQWtCLENBQUMsQ0FBQztRQUMzRCxNQUFNLE9BQU8sR0FBRyxDQUFDLElBQUksQ0FBQyxPQUFPLEtBQUssTUFBTSxDQUFDLEtBQUs7WUFDNUMsTUFBTSxFQUFFLFlBQVksRUFBRSxlQUFlLEVBQUUsR0FBRyxNQUFNLFlBQVksQ0FBQyxrQkFBa0IsQ0FBQyxDQUFDO1lBQ2pGLE1BQU0sS0FBSyxHQUFHLElBQUksZUFBZSxDQUFDO2dCQUNoQyx5REFBeUQ7Z0JBQ3pELGNBQWMsRUFBRSxvQkFBb0I7YUFDckMsQ0FBQyxDQUFDO1lBRUgsTUFBTSxhQUFhLEdBQUcsWUFBWSxDQUFDLFNBQVMsQ0FBQyxLQUFLLENBQUMsQ0FBQztZQUVwRCxPQUFPLFVBQVUsS0FBd0IsRUFBRSxJQUFrQjtnQkFDM0QsTUFBTSxPQUFPLEdBQUcsVUFBVSxDQUFDLEdBQUcsRUFBRTtvQkFDOUIsT0FBTyxDQUFDLElBQUksQ0FBQyw0QkFBNEIsRUFBRSxLQUFLLENBQUMsQ0FBQztnQkFDcEQsQ0FBQyxFQUFFLEtBQUssQ0FBQyxDQUFDO2dCQUNWLE9BQU8sYUFBYSxDQUFDLEtBQUssRUFBRSxJQUFJLENBQUMsQ0FBQyxPQUFPLENBQUMsR0FBRyxFQUFFO29CQUM3QyxZQUFZLENBQUMsT0FBTyxDQUFDLENBQUM7Z0JB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RUQ7OztHQUdHO0FBQ0gsTUFBTSxVQUFVLFlBQVksQ0FBQyxJQUFnQztJQUMzRCxPQUFPLEdBQUcsRUFBRTtRQUNWLE1BQU0sR0FBRyxHQUFHLElBQUksY0FBYyxFQUFFLENBQUM7UUFDakMsR0FBRyxDQUFDLGdCQUFnQixDQUFDLG9DQUFvQyxDQUFDLENBQUM7UUFDM0QsR0FBRyxDQUFDLElBQUksQ0FBQyxLQUFLLEVBQUUsSUFBSSxDQUFDLEdBQUcsRUFBRSxLQUFLLENBQUMsQ0FBQztRQUNqQyxHQUFHLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO1FBRWYsSUFDRSxHQUFHLENBQUMsTUFBTSxLQUFLLEdBQUc7WUFDbEIsQ0FBQyxHQUFHLENBQUMsUUFBUSxZQUFZLE1BQU0sSUFBSSxPQUFPLEdBQUcsQ0FBQyxRQUFRLEtBQUssUUFBUSxDQUFDLEVBQ3BFLENBQUM7WUFDRCxPQUFPLFVBQVUsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLFFBQVEsRUFBRSxDQUFDLENBQVMsRUFBRSxFQUFFLENBQUMsQ0FBQyxDQUFDLFVBQVUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQ3ZFLENBQUM7UUFDRCxPQUFPLElBQUksVUFBVSxFQUFFLENBQUM7SUFDMUIsQ0FBQyxDQUFDO0FBQ0osQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEJlZm9yZUJ1aWxkTWFyaywgSW5pdE9wdGlvbnMsIExhenlGb250IH0gZnJvbSAnLi9vcHRpb25zLmluaXQubWpzJztcclxuaW1wb3J0IHsgTGF6eVdhc21Nb2R1bGUgfSBmcm9tICcuL3dhc20ubWpzJztcclxuXHJcbi8qKiBAaW50ZXJuYWwgKi9cclxuZXhwb3J0IGludGVyZmFjZSBUeXBzdENvbW1vbkJ1aWxkZXI8VD4ge1xyXG4gIGZyZWUoKTogdm9pZDtcclxuXHJcbiAgYWRkX3Jhd19mb250KGZvbnRfYnVmZmVyOiBVaW50OEFycmF5KTogUHJvbWlzZTx2b2lkPjtcclxuXHJcbiAgYWRkX2xhenlfZm9udDxDIGV4dGVuZHMgTGF6eUZvbnQ+KFxyXG4gICAgaW5mbzogQyxcclxuICAgIGJsb2I6ICh0aGlzOiBDLCBpbmRleDogbnVtYmVyKSA9PiBVaW50OEFycmF5LFxyXG4gICk6IFByb21pc2U8dm9pZD47XHJcblxyXG4gIGJ1aWxkKCk6IFByb21pc2U8VD47XHJcbn1cclxuXHJcbi8qKiBAaW50ZXJuYWwgKi9cclxuZXhwb3J0IGludGVyZmFjZSBDb21wb25lbnRCdWlsZEhvb2tzIHtcclxuICBsYXRlbHlCdWlsZD86IChjdHg6IHVua25vd24pID0+IHZvaWQ7XHJcbn1cclxuXHJcbmludGVyZmFjZSBJbml0Q29udGV4dDxUPiB7XHJcbiAgcmVmOiB7XHJcbiAgICBsb2FkRm9udHMoYnVpbGRlcjogVHlwc3RDb21tb25CdWlsZGVyPFQ+LCBmb250czogKHN0cmluZyB8IFVpbnQ4QXJyYXkpW10pOiBQcm9taXNlPHZvaWQ+O1xyXG4gIH07XHJcbiAgYnVpbGRlcjogVHlwc3RDb21tb25CdWlsZGVyPFQ+O1xyXG4gIGhvb2tzOiBDb21wb25lbnRCdWlsZEhvb2tzO1xyXG59XHJcblxyXG5jbGFzcyBDb21wb25lbnRCdWlsZGVyPFQ+IHtcclxuICBsb2FkZWRGb250cyA9IG5ldyBTZXQ8c3RyaW5nPigpO1xyXG4gIGZldGNoZXI/OiB0eXBlb2YgZmV0Y2ggPSBmZXRjaDtcclxuXHJcbiAgc2V0RmV0Y2hlcihmZXRjaGVyOiB0eXBlb2YgZmV0Y2gpOiB2b2lkIHtcclxuICAgIHRoaXMuZmV0Y2hlciA9IGZldGNoZXI7XHJcbiAgfVxyXG5cclxuICBhc3luYyBsb2FkRm9udHMoXHJcbiAgICBidWlsZGVyOiBUeXBzdENvbW1vbkJ1aWxkZXI8VD4sXHJcbiAgICBmb250czogKHN0cmluZyB8IFVpbnQ4QXJyYXkgfCBMYXp5Rm9udClbXSxcclxuICApOiBQcm9taXNlPHZvaWQ+IHtcclxuICAgIGNvbnN0IGVzY2FwZUltcG9ydCA9IG5ldyBGdW5jdGlvbignbScsICdyZXR1cm4gaW1wb3J0KG0pJyk7XHJcbiAgICBjb25zdCBmZXRjaGVyID0gKHRoaXMuZmV0Y2hlciB8fD0gYXdhaXQgKGFzeW5jIGZ1bmN0aW9uICgpIHtcclxuICAgICAgY29uc3QgeyBmZXRjaEJ1aWxkZXIsIEZpbGVTeXN0ZW1DYWNoZSB9ID0gYXdhaXQgZXNjYXBlSW1wb3J0KCdub2RlLWZldGNoLWNhY2hlJyk7XHJcbiAgICAgIGNvbnN0IGNhY2hlID0gbmV3IEZpbGVTeXN0ZW1DYWNoZSh7XHJcbiAgICAgICAgLy8vIEJ5IGRlZmF1bHQsIHdlIGRvbid0IGhhdmUgYSBjb21wbGljYXRlZCBjYWNoZSBwb2xpY3kuXHJcbiAgICAgICAgY2FjaGVEaXJlY3Rvcnk6ICcuY2FjaGUvdHlwc3QvZm9udHMnLFxyXG4gICAgICB9KTtcclxuXHJcbiAgICAgIGNvbnN0IGNhY2hlZEZldGNoZXIgPSBmZXRjaEJ1aWxkZXIud2l0aENhY2hlKGNhY2hlKTtcclxuXHJcbiAgICAgIHJldHVybiBmdW5jdGlvbiAoaW5wdXQ6IFJlcXVlc3RJbmZvIHwgVVJMLCBpbml0PzogUmVxdWVzdEluaXQpIHtcclxuICAgICAgICBjb25zdCB0aW1lb3V0ID0gc2V0VGltZW91dCgoKSA9PiB7XHJcbiAgICAgICAgICBjb25zb2xlLndhcm4oJ2ZvbnQgZmV0Y2hpbmcgaXMgc3R1Y2tpbmc6JywgaW5wdXQpO1xyXG4gICAgICAgIH0sIDE1MDAwKTtcclxuICAgICAgICByZXR1cm4gY2FjaGVkRmV0Y2hlcihpbnB1dCwgaW5pdCkuZmluYWxseSgoKSA9PiB7XHJcbiAgICAgICAgICBjbGVhclRpbWVvdXQodGltZW91dCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgIH07XHJcbiAgICB9KSgpKTtcclxuXHJcbiAgICBjb25zdCBmb250c1RvTG9hZCA9IGZvbnRzLmZpbHRlcihmb250ID0+IHtcclxuICAgICAgaWYgKGZvbnQgaW5zdGFuY2VvZiBVaW50OEFycmF5IHx8ICh0eXBlb2YgZm9udCA9PT0gJ29iamVjdCcgJiYgJ2luZm8nIGluIGZvbnQpKSB7XHJcbiAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGlmICh0aGlzLmxvYWRlZEZvbnRzLmhhcyhmb250KSkge1xyXG4gICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgfVxyXG5cclxuICAgICAgdGhpcy5sb2FkZWRGb250cy5hZGQoZm9udCk7XHJcbiAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgfSk7XHJcblxyXG4gICAgY29uc3QgZm9udExpc3RzID0gYXdhaXQgUHJvbWlzZS5hbGwoXHJcbiAgICAgIGZvbnRzVG9Mb2FkLm1hcChhc3luYyBmb250ID0+IHtcclxuICAgICAgICBpZiAoZm9udCBpbnN0YW5jZW9mIFVpbnQ4QXJyYXkpIHtcclxuICAgICAgICAgIGF3YWl0IGJ1aWxkZXIuYWRkX3Jhd19mb250KGZvbnQpO1xyXG4gICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAodHlwZW9mIGZvbnQgPT09ICdvYmplY3QnICYmICdpbmZvJyBpbiBmb250KSB7XHJcbiAgICAgICAgICBhd2FpdCBidWlsZGVyLmFkZF9sYXp5X2ZvbnQoZm9udCwgJ2Jsb2InIGluIGZvbnQgPyBmb250LmJsb2IgOiBsb2FkRm9udFN5bmMoZm9udCkpO1xyXG4gICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIG5ldyBVaW50OEFycmF5KGF3YWl0IChhd2FpdCBmZXRjaGVyKGZvbnQpKS5hcnJheUJ1ZmZlcigpKTtcclxuICAgICAgfSksXHJcbiAgICApO1xyXG5cclxuICAgIGZvciAoY29uc3QgZm9udCBvZiBmb250TGlzdHMpIHtcclxuICAgICAgaWYgKCFmb250KSB7XHJcbiAgICAgICAgY29udGludWU7XHJcbiAgICAgIH1cclxuICAgICAgYXdhaXQgYnVpbGRlci5hZGRfcmF3X2ZvbnQoZm9udCk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBhc3luYyBidWlsZChcclxuICAgIG9wdGlvbnM6IFBhcnRpYWw8SW5pdE9wdGlvbnM+IHwgdW5kZWZpbmVkLFxyXG4gICAgYnVpbGRlcjogVHlwc3RDb21tb25CdWlsZGVyPFQ+LFxyXG4gICAgaG9va3M6IENvbXBvbmVudEJ1aWxkSG9va3MsXHJcbiAgKTogUHJvbWlzZTxUPiB7XHJcbiAgICAvLy8gYnVpbGQgdHlwc3QgY29tcG9uZW50XHJcbiAgICBjb25zdCBidWlsZEN0eDogSW5pdENvbnRleHQ8VD4gPSB7IHJlZjogdGhpcywgYnVpbGRlciwgaG9va3MgfTtcclxuXHJcbiAgICBmb3IgKGNvbnN0IGZuIG9mIG9wdGlvbnM/LmJlZm9yZUJ1aWxkID8/IFtdKSB7XHJcbiAgICAgIGF3YWl0IGZuKHVuZGVmaW5lZCBhcyB1bmtub3duIGFzIEJlZm9yZUJ1aWxkTWFyaywgYnVpbGRDdHgpO1xyXG4gICAgfVxyXG4gICAgLy8gYXdhaXQgYWRkUGFydGlhbEZvbnRzKGJ1aWxkQ3R4KTtcclxuXHJcbiAgICBpZiAoaG9va3MubGF0ZWx5QnVpbGQpIHtcclxuICAgICAgaG9va3MubGF0ZWx5QnVpbGQoYnVpbGRDdHgpO1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiBhd2FpdCBidWlsZGVyLmJ1aWxkKCk7XHJcbiAgfVxyXG59XHJcblxyXG4vKiogQGludGVybmFsICovXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBidWlsZENvbXBvbmVudDxUPihcclxuICBvcHRpb25zOiBQYXJ0aWFsPEluaXRPcHRpb25zPiB8IHVuZGVmaW5lZCxcclxuICBnTW9kdWxlOiBMYXp5V2FzbU1vZHVsZSxcclxuICBCdWlsZGVyOiB7IG5ldyAoKTogVHlwc3RDb21tb25CdWlsZGVyPFQ+IH0sXHJcbiAgaG9va3M6IENvbXBvbmVudEJ1aWxkSG9va3MsXHJcbik6IFByb21pc2U8VD4ge1xyXG4gIC8vLyBpbml0IHR5cHN0IHdhc20gbW9kdWxlXHJcbiAgYXdhaXQgZ01vZHVsZS5pbml0KG9wdGlvbnM/LmdldE1vZHVsZT8uKCkpO1xyXG5cclxuICByZXR1cm4gYXdhaXQgbmV3IENvbXBvbmVudEJ1aWxkZXI8VD4oKS5idWlsZChvcHRpb25zLCBuZXcgQnVpbGRlcigpLCBob29rcyk7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBMb2FkcyBhIGZvbnQgYnkgYSBsYXp5IGZvbnQgc3luY2hyb25vdXNseSwgd2hpY2ggaXMgcmVxdWlyZWQgYnkgdGhlIGNvbXBpbGVyLlxyXG4gKiBAcGFyYW0gZm9udFxyXG4gKi9cclxuZXhwb3J0IGZ1bmN0aW9uIGxvYWRGb250U3luYyhmb250OiBMYXp5Rm9udCAmIHsgdXJsOiBzdHJpbmcgfSk6IChpbmRleDogbnVtYmVyKSA9PiBVaW50OEFycmF5IHtcclxuICByZXR1cm4gKCkgPT4ge1xyXG4gICAgY29uc3QgeGhyID0gbmV3IFhNTEh0dHBSZXF1ZXN0KCk7XHJcbiAgICB4aHIub3ZlcnJpZGVNaW1lVHlwZSgndGV4dC9wbGFpbjsgY2hhcnNldD14LXVzZXItZGVmaW5lZCcpO1xyXG4gICAgeGhyLm9wZW4oJ0dFVCcsIGZvbnQudXJsLCBmYWxzZSk7XHJcbiAgICB4aHIuc2VuZChudWxsKTtcclxuXHJcbiAgICBpZiAoXHJcbiAgICAgIHhoci5zdGF0dXMgPT09IDIwMCAmJlxyXG4gICAgICAoeGhyLnJlc3BvbnNlIGluc3RhbmNlb2YgU3RyaW5nIHx8IHR5cGVvZiB4aHIucmVzcG9uc2UgPT09ICdzdHJpbmcnKVxyXG4gICAgKSB7XHJcbiAgICAgIHJldHVybiBVaW50OEFycmF5LmZyb20oeGhyLnJlc3BvbnNlLCAoYzogc3RyaW5nKSA9PiBjLmNoYXJDb2RlQXQoMCkpO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIG5ldyBVaW50OEFycmF5KCk7XHJcbiAgfTtcclxufVxyXG4iXX0=