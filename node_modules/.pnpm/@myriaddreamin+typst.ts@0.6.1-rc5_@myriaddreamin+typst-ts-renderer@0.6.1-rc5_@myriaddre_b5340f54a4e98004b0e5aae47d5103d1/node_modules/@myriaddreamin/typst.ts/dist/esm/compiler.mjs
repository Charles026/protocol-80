import { buildComponent } from './init.mjs';
import { kObject } from './internal.types.mjs';
import { loadFonts } from './options.init.mjs';
import { LazyWasmModule } from './wasm.mjs';
/**
 * Available formats for compiling the document.
 */
export var CompileFormatEnum;
(function (CompileFormatEnum) {
    CompileFormatEnum[CompileFormatEnum["vector"] = 0] = "vector";
    CompileFormatEnum[CompileFormatEnum["pdf"] = 1] = "pdf";
    CompileFormatEnum[CompileFormatEnum["_dummy"] = 2] = "_dummy";
})(CompileFormatEnum || (CompileFormatEnum = {}));
export class IncrementalServer {
    /**
     * @internal
     */
    [kObject];
    /**
     * @internal
     */
    constructor(s) {
        this[kObject] = s;
    }
    /**
     * Reset the incremental server to the initial state.
     */
    reset() {
        this[kObject].reset();
    }
    /**
     * Return current result.
     */
    current() {
        return this[kObject].current();
    }
    /**
     * Also attach the debug info to the result.
     */
    setAttachDebugInfo(enable) {
        this[kObject].set_attach_debug_info(enable);
    }
}
var TypstFontResolverCons;
(function (TypstFontResolverCons) {
})(TypstFontResolverCons || (TypstFontResolverCons = {}));
/**
 * create a Typst font builder.
 * @returns {TypstFontBuilder} - The Typst font builder.
 * @example
 * ```typescript
 * import { createTypstFontBuilder } from 'typst';
 * const fb = createTypstFontBuilder();
 * await fb.init();
 * await fb.addFontData(new Uint8Array(await fetch('font.ttf').then(r => r.arrayBuffer())));
 * await fb.build();
 * ```
 */
export function createTypstFontBuilder() {
    return new TypstFontBuilderDriver();
}
export class TypstWorld {
    [kObject];
    constructor(world) {
        this[kObject] = world;
    }
    /**
     * Compile the paged document.
     *
     * @param {DiagnosticsFormat} format - The format of the diagnostics.
     * @returns {Promise<{ diagnostics?: DiagnosticsData[DiagnosticsFormat][] }>} - The result of the compilation.
     */
    compile(opts) {
        return this[kObject].compile(0, getDiagnosticsArg(opts?.diagnostics));
    }
    /**
     * Compile the paged document.
     *
     * @param {DiagnosticsFormat} format - The format of the diagnostics.
     * @returns {Promise<{ diagnostics?: DiagnosticsData[DiagnosticsFormat][] }>} - The result of the compilation.
     */
    compileHtml(opts) {
        return this[kObject].compile(1, getDiagnosticsArg(opts?.diagnostics));
    }
    /**
     * Runs query on the paged document.
     */
    async query(options) {
        return JSON.parse(this[kObject].query(0, options.selector, options.field));
    }
    /**
     * Get the title of the paged document.
     * Throw error if the world didn't compile the paged document.
     *
     * @returns {string | undefined} - The title of the paged document.
     */
    title() {
        return this[kObject].title(0);
    }
    /**
     * Export the paged document as vector format.
     *
     * @returns {Uint8Array | undefined} - The title of the paged document.
     */
    vector(opts) {
        return this[kObject].get_artifact(0, getDiagnosticsArg(opts?.diagnostics)) || {};
    }
    /**
     * Export the paged document to PDF.
     *
     * @returns {Uint8Array | undefined} - The title of the paged document.
     */
    pdf(opts) {
        return this[kObject].get_artifact(1, getDiagnosticsArg(opts?.diagnostics)) || {};
    }
}
const gCompilerModule = (module) => new LazyWasmModule(async (bin) => {
    return await module.default(bin);
});
/**
 * create a Typst compiler.
 * @returns {TypstCompiler} - The Typst compiler.
 * @example
 * ```typescript
 * import { createTypstCompiler } from 'typst';
 * const compiler = createTypstCompiler();
 * await compiler.init();
 * compiler.addSource('/main.typ', 'Hello, typst!');
 * await compiler.compile({ mainFilePath: '/main.typ' });
 * ```
 */
export function createTypstCompiler() {
    return new TypstCompilerDriver();
}
export class TypstFontBuilderDriver {
    fontBuilderJs;
    fontBuilder;
    async init(options) {
        this.fontBuilderJs = await (options?.getWrapper?.() || import('@myriaddreamin/typst-ts-web-compiler'));
        /// init typst wasm module
        await gCompilerModule(this.fontBuilderJs).init(options?.getModule?.());
        this.fontBuilder = new this.fontBuilderJs.TypstFontResolverBuilder();
    }
    async getFontInfo(font_buffer) {
        return this.fontBuilder.get_font_info(font_buffer);
    }
    async addFontData(font_buffer) {
        this.fontBuilder.add_raw_font(font_buffer);
    }
    async addLazyFont(info, blob) {
        return this.fontBuilder.add_lazy_font(info, blob);
    }
    async build(cb) {
        const fonts = await this.fontBuilder.build();
        const result = await cb(fonts);
        fonts.free();
        return result;
    }
}
class TypstCompilerDriver {
    compiler;
    compilerJs;
    static defaultAssets = ['text'];
    constructor() { }
    async init(options) {
        this.compilerJs = await (options?.getWrapper?.() || import('@myriaddreamin/typst-ts-web-compiler'));
        const TypstCompilerBuilder = this.compilerJs.TypstCompilerBuilder;
        const compilerOptions = { ...(options || {}) };
        const beforeBuild = (compilerOptions.beforeBuild ??= []);
        const hasPreloadRemoteFonts = beforeBuild.some((fn) => fn._preloadRemoteFontOptions !== undefined);
        const hasSpecifiedAssets = beforeBuild.some((fn) => fn._preloadRemoteFontOptions?.assets !== undefined);
        const hasDisableAssets = beforeBuild.some((fn) => fn._preloadRemoteFontOptions?.assets === false);
        if (!hasPreloadRemoteFonts || (!hasSpecifiedAssets && !hasDisableAssets)) {
            beforeBuild.push(loadFonts([], { assets: TypstCompilerDriver.defaultAssets }));
        }
        const hasFontLoader = beforeBuild.some((fn) => fn._kind === 'fontLoader');
        if (!hasFontLoader) {
            throw new Error('TypstCompiler: no font loader found, please use font loaders, e.g. loadFonts or preloadSystemFonts');
        }
        this.compiler = await buildComponent(options, gCompilerModule(this.compilerJs), TypstCompilerBuilder, {});
    }
    setFonts(fonts) {
        this.compiler.set_fonts(fonts);
    }
    compile(options) {
        return new Promise(resolve => {
            const world = this.compiler.snapshot(options.root, options.mainFilePath, convertInputs(options.inputs));
            if ('incrementalServer' in options) {
                resolve(world.incr_compile(options.incrementalServer[kObject], getDiagnosticsArg(options.diagnostics)));
                return;
            }
            resolve(world.get_artifact(options.format || CompileFormatEnum.vector, getDiagnosticsArg(options.diagnostics)));
        });
    }
    async runWithWorld(options, cb) {
        const world = this.compiler.snapshot(options.root, options.mainFilePath, convertInputs(options.inputs));
        let result = await cb(new TypstWorld(world));
        world.free();
        return result;
    }
    query(options) {
        return this.runWithWorld(options, async (world) => {
            return JSON.parse(await world.query(options));
        });
    }
    getSemanticTokenLegend() {
        return new Promise(resolve => {
            resolve(this.compiler.get_semantic_token_legend());
        });
    }
    getSemanticTokens(opts) {
        return new Promise(resolve => {
            this.compiler.reset();
            resolve(this.compiler.get_semantic_tokens(opts.offsetEncoding || 'utf-16', opts.mainFilePath, opts.resultId));
        });
    }
    async withIncrementalServer(f) {
        const srv = new IncrementalServer(this.compiler.create_incr_server());
        try {
            return await f(srv);
        }
        finally {
            srv[kObject].free();
        }
    }
    async getAst(mainFilePath) {
        return this.compiler.get_ast(mainFilePath);
    }
    async reset() {
        await new Promise(resolve => {
            this.compiler.reset();
            resolve(undefined);
        });
    }
    addSource(path, source) {
        if (arguments.length > 2) {
            throw new Error('use of addSource(path, source, isMain) is deprecated, please use addSource(path, source) instead');
        }
        this.compiler.add_source(path, source);
    }
    mapShadow(path, content) {
        this.compiler.map_shadow(path, content);
    }
    unmapShadow(path) {
        this.compiler.unmap_shadow(path);
    }
    resetShadow() {
        this.compiler.reset_shadow();
    }
    renderPageToCanvas() {
        throw new Error('Please use the api TypstRenderer.renderToCanvas in v0.4.0');
    }
}
createTypstCompiler._impl = TypstCompilerDriver;
// todo: caching inputs
function convertInputs(inputs) {
    return inputs ? Object.entries(inputs) : undefined;
}
function getDiagnosticsArg(diagnostics) {
    switch (diagnostics) {
        case 'none':
            return 1;
        case 'unix':
            return 2;
        case 'full':
        default:
            return 3;
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29tcGlsZXIubWpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vc3JjL2NvbXBpbGVyLm10cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFFQSxPQUFPLEVBQUUsY0FBYyxFQUFFLE1BQU0sWUFBWSxDQUFDO0FBQzVDLE9BQU8sRUFBd0MsT0FBTyxFQUFFLE1BQU0sc0JBQXNCLENBQUM7QUFFckYsT0FBTyxFQUFFLFNBQVMsRUFBb0IsTUFBTSxvQkFBb0IsQ0FBQztBQUNqRSxPQUFPLEVBQUUsY0FBYyxFQUFFLE1BQU0sWUFBWSxDQUFDO0FBTzVDOztHQUVHO0FBQ0gsTUFBTSxDQUFOLElBQVksaUJBSVg7QUFKRCxXQUFZLGlCQUFpQjtJQUMzQiw2REFBVSxDQUFBO0lBQ1YsdURBQU8sQ0FBQTtJQUNQLDZEQUFVLENBQUE7QUFDWixDQUFDLEVBSlcsaUJBQWlCLEtBQWpCLGlCQUFpQixRQUk1QjtBQWdJRCxNQUFNLE9BQU8saUJBQWlCO0lBQzVCOztPQUVHO0lBQ0gsQ0FBQyxPQUFPLENBQUMsQ0FBbUI7SUFFNUI7O09BRUc7SUFDSCxZQUFZLENBQW1CO1FBQzdCLElBQUksQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFDLENBQUM7SUFDcEIsQ0FBQztJQUVEOztPQUVHO0lBQ0gsS0FBSztRQUNILElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQyxLQUFLLEVBQUUsQ0FBQztJQUN4QixDQUFDO0lBRUQ7O09BRUc7SUFDSCxPQUFPO1FBQ0wsT0FBTyxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUMsT0FBTyxFQUFFLENBQUM7SUFDakMsQ0FBQztJQUVEOztPQUVHO0lBQ0gsa0JBQWtCLENBQUMsTUFBZTtRQUNoQyxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUMscUJBQXFCLENBQUMsTUFBTSxDQUFDLENBQUM7SUFDOUMsQ0FBQztDQUNGO0FBU0QsSUFBSyxxQkFBeUI7QUFBOUIsV0FBSyxxQkFBcUI7QUFBRyxDQUFDLEVBQXpCLHFCQUFxQixLQUFyQixxQkFB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QyxDQUFDO1FBQ1gsS0FBSyxNQUFNO1lBQ1QsT0FBTyxDQUFDLENBQUM7UUFDWCxLQUFLLE1BQU0sQ0FBQztRQUNaO1lBQ0UsT0FBTyxDQUFDLENBQUM7SUFDYixDQUFDO0FBQ0gsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbIi8vIEB0cy1pZ25vcmVcclxuaW1wb3J0IHR5cGUgKiBhcyB0eXBzdCBmcm9tICdAbXlyaWFkZHJlYW1pbi90eXBzdC10cy13ZWItY29tcGlsZXInO1xyXG5pbXBvcnQgeyBidWlsZENvbXBvbmVudCB9IGZyb20gJy4vaW5pdC5tanMnO1xyXG5pbXBvcnQgeyBTZW1hbnRpY1Rva2VucywgU2VtYW50aWNUb2tlbnNMZWdlbmQsIGtPYmplY3QgfSBmcm9tICcuL2ludGVybmFsLnR5cGVzLm1qcyc7XHJcblxyXG5pbXBvcnQgeyBsb2FkRm9udHMsIHR5cGUgSW5pdE9wdGlvbnMgfSBmcm9tICcuL29wdGlvbnMuaW5pdC5tanMnO1xyXG5pbXBvcnQgeyBMYXp5V2FzbU1vZHVsZSB9IGZyb20gJy4vd2FzbS5tanMnO1xyXG5cclxuLyoqXHJcbiAqIEF2YWlsYWJsZSBmb3JtYXRzIGZvciBjb21waWxpbmcgdGhlIGRvY3VtZW50LlxyXG4gKi9cclxuZXhwb3J0IHR5cGUgQ29tcGlsZUZvcm1hdCA9IGtleW9mIHR5cGVvZiBDb21waWxlRm9ybWF0RW51bTtcclxuXHJcbi8qKlxyXG4gKiBBdmFpbGFibGUgZm9ybWF0cyBmb3IgY29tcGlsaW5nIHRoZSBkb2N1bWVudC5cclxuICovXHJcbmV4cG9ydCBlbnVtIENvbXBpbGVGb3JtYXRFbnVtIHtcclxuICB2ZWN0b3IgPSAwLFxyXG4gIHBkZiA9IDEsXHJcbiAgX2R1bW15ID0gMixcclxufVxyXG5cclxuXHJcbi8qKlxyXG4gKiBUaGUgZGlhZ25vc3RpYyBtZXNzYWdlIHBhcnRpYWxseSBmb2xsb3dpbmcgdGhlIExTUCBzcGVjaWZpY2F0aW9uLlxyXG4gKi9cclxuaW50ZXJmYWNlIERpYWdub3N0aWNNZXNzYWdlIHtcclxuICAvLyBUaGUgcGFja2FnZSBvd25pbmcgdGhlIHBhdGguXHJcbiAgLy8gSWYgdGhlIHBhY2thZ2UgaXMgZW1wdHksIHRoZSBwYXRoIGlzIGEgcmVsYXRpdmUgcGF0aCB0byB0aGUgKndvcmtzcGFjZSByb290Ki5cclxuICBwYWNrYWdlOiBzdHJpbmc7XHJcbiAgLy8gVGhlIHBhdGggb2YgdGhlIGZpbGUuXHJcbiAgcGF0aDogc3RyaW5nO1xyXG4gIC8vIFNldmVyaXR5IG9mIHRoZSBkaWFnbm9zdGljIG1lc3NhZ2UuXHJcbiAgc2V2ZXJpdHk6IHN0cmluZztcclxuICAvLyBaZXJvLWJhc2VkIGxpbmUgbnVtYmVyIGFuZCBvbmUtYmFzZWQgY2hhcmFjdGVyIG9mZnNldC5cclxuICAvLyBUaGUgcmFuZ2Ugb2YgdGhlIGRpYWdub3N0aWMgbWVzc2FnZS5cclxuICAvLyBJZiB0aGUgZGlhZ25vc3RpYyBtZXNzYWdlIGlzIGEgcmFuZ2UsIHRoZSByYW5nZSBpcyBpbiB0aGUgZm9ybWF0IG9mIGBzdGFydExpbmU6c3RhcnRDaGFyYWN0ZXItZW5kTGluZTplbmRDaGFyYWN0ZXJgLlxyXG4gIC8vIElmIHRoZSBkaWFnbm9zdGljIG1lc3NhZ2UgaXMgYSBwb2ludCwgdGhlIHJhbmdlIGlzIGluIHRoZSBmb3JtYXQgb2YgYGxpbmU6Y2hhcmFjdGVyYC5cclxuICAvLyBPdGhlcndpc2UsIHRoZSByYW5nZSBpcyBlbXB0eS5cclxuICByYW5nZTogc3RyaW5nO1xyXG4gIC8vIFRoZSBtZXNzYWdlIG9mIHRoZSBkaWFnbm9zdGljIG1lc3NhZ2UuXHJcbiAgbWVzc2FnZTogc3RyaW5nO1xyXG59XHJcblxyXG4vKipcclxuICogQXZhaWxhYmxlIGZvcm1hdHMgZm9yIGNvbXBpbGluZyB0aGUgZG9jdW1lbnQuXHJcbiAqXHJcbiAqIElmIHNldCB0byB1bml4LCBhIGRpYWdub3N0aWNzIGlzIGluIGZvcm1hdCBvZlxyXG4gKlxyXG4gKiBgYGBsb2dcclxuICogLy8gd2l0aCBwYWNrYWdlXHJcbiAqIGNldHo6MC4yLjBAbGliLnR5cDoyOjktMzoxNTogZXJyb3I6IHVuZXhwZWN0ZWQgdHlwZSBpbiBgK2AgYXBwbGljYXRpb25cclxuICogLy8gd2l0aG91dCBwYWNrYWdlXHJcbiAqIG1haW4udHlwOjI6OS0zOjE1OiBlcnJvcjogdW5leHBlY3RlZCB0eXBlIGluIGArYCBhcHBsaWNhdGlvblxyXG4gKiBgYGBcclxuICpcclxuICogSWYgc2V0IHRvIGxvbmcsIGEgZGlhZ25vc3RpY3MgaXMgaW4gZm9ybWF0IG9mIHtAbGluayBEaWFnbm9zdGljTWVzc2FnZX0uXHJcbiAqXHJcbiAqIElmIHNldCB0byBmdWxsLCBhIGRpYWdub3N0aWNzIGlzIGluIGZvcm1hdCBvZiB7QGxpbmsgRGlhZ25vc3RpY01lc3NhZ2V9LCBidXQgYWxzbyB3aXRoIHRyYWNlIG1lc3NhZ2VzLlxyXG4gKi9cclxuZXhwb3J0IHR5cGUgRGlhZ25vc3RpY3NGb3JtYXQgPSAnbm9uZScgfCAndW5peCcgfCAnZnVsbCc7XHJcblxyXG5leHBvcnQgdHlwZSBEaWFnbm9zdGljc0RhdGEgPSB7XHJcbiAgbm9uZTogbmV2ZXI7XHJcbiAgdW5peDogc3RyaW5nO1xyXG4gIGZ1bGw6IERpYWdub3N0aWNNZXNzYWdlO1xyXG59O1xyXG5cclxuaW50ZXJmYWNlIERpYWdPcHRzPEQgZXh0ZW5kcyBEaWFnbm9zdGljc0Zvcm1hdCA9IERpYWdub3N0aWNzRm9ybWF0PiB7XHJcbiAgLyoqXHJcbiAgICogV2hldGhlciB0byBpbmNsdWRlIGRpYWdub3N0aWMgaW5mb3JtYXRpb24gaW4gdGhlIHJlc3VsdC5cclxuICAgKiBOb3RlOiBpdCB3aWxsIGJlIHNldCB0byAnZnVsbCcgYnkgZGVmYXVsdCBpbiB2MC42LjBcclxuICAgKiBAZGVmYXVsdCAnZnVsbCdcclxuICAgKi9cclxuICBkaWFnbm9zdGljcz86IEQ7XHJcbn1cclxuXHJcbmludGVyZmFjZSBTbmFwc2hvdE9wdGlvbnMge1xyXG4gIC8qKlxyXG4gICAqIFRoZSBwYXRoIG9mIHRoZSBtYWluIGZpbGUuXHJcbiAgICovXHJcbiAgbWFpbkZpbGVQYXRoOiBzdHJpbmc7XHJcbiAgLyoqXHJcbiAgICogVGhlIHJvb3Qgb2YgdGhlIG1haW4gZmlsZS5cclxuICAgKi9cclxuICByb290Pzogc3RyaW5nO1xyXG4gIC8qKlxyXG4gICAqIEFkZHMgYSBzdHJpbmcga2V5LXZhbHVlIHBhaXIgdmlzaWJsZSB0aHJvdWdoIGBzeXMuaW5wdXRzYFxyXG4gICAqXHJcbiAgICogTm90ZTogcGFzcyBge31gIHRvIGNsZWFyIGBzeXMuaW5wdXRzYFxyXG4gICAqXHJcbiAgICogTm90ZTogV2hlbiBwYXNzaW5nIGB1bmRlZmluZWRgLCBjb21waWxlciB3aWxsIHVzZSBsYXN0IHNldCBgc3lzLmlucHV0c2AuXHJcbiAgICpcclxuICAgKiBOb3RlOiBUaGlzIG1lYW5zIHlvdSBzaG91bGQgYWx3YXlzIHNwZWNpZnkgaW5wdXRzIHdoZW4gdXNpbmcgY29tcGlsZXIgZm9yIGNvbmN1cnJlbnQgdGFza3MuXHJcbiAgICovXHJcbiAgaW5wdXRzPzogUmVjb3JkPHN0cmluZywgc3RyaW5nPjtcclxufVxyXG5cclxuaW50ZXJmYWNlIFRyYW5zaWVudENvbXBpbGVPcHRpb25zPFxyXG4gIEYgZXh0ZW5kcyBDb21waWxlRm9ybWF0RW51bSA9IENvbXBpbGVGb3JtYXRFbnVtLFxyXG4gIERpYWdub3N0aWNzIGV4dGVuZHMgRGlhZ25vc3RpY3NGb3JtYXQgPSBEaWFnbm9zdGljc0Zvcm1hdCxcclxuPiBleHRlbmRzIFNuYXBzaG90T3B0aW9ucyxcclxuICBEaWFnT3B0czxEaWFnbm9zdGljcz4ge1xyXG4gIC8qKlxyXG4gICAqIFRoZSBmb3JtYXQgb2YgdGhlIGFydGlmYWN0LlxyXG4gICAqIC0gQ29tcGlsZUZvcm1hdEVudW0udmVjdG9yOiBjYW4gdGhlbiBsb2FkIHRvIHRoZSByZW5kZXJlciB0byByZW5kZXIgdGhlIGRvY3VtZW50LlxyXG4gICAqIC0gQ29tcGlsZUZvcm1hdEVudW0ucGRmOiBmb3IgZmluYWxseSBleHBvcnRpbmcgcGRmIHRvIHRoZSB1c2VyLlxyXG4gICAqIFxyXG4gICAqIEhpbnQ6IHlvdSBjYW4gY29udmVydCB0aGUgZm9ybWF0IGZyb20ge0BsaW5rIENvbXBpbGVGb3JtYXR9IHRvXHJcbiAgICoge0BsaW5rIENvbXBpbGVGb3JtYXRFbnVtfSBieSBgQ29tcGlsZUZvcm1hdEVudW1bRm9ybWF0XWAuXHJcbiAgICogQGRlZmF1bHQgQ29tcGlsZUZvcm1hdEVudW0udmVjdG9yXHJcbiAgICovXHJcbiAgZm9ybWF0PzogRjtcclxufVxyXG5cclxuaW50ZXJmYWNlIEluY3JlbWVudGFsQ29tcGlsZU9wdGlvbnM8RGlhZ25vc3RpY3MgZXh0ZW5kcyBEaWFnbm9zdGljc0Zvcm1hdCA9IERpYWdub3N0aWNzRm9ybWF0PlxyXG4gIGV4dGVuZHMgU25hcHNob3RPcHRpb25zLFxyXG4gIERpYWdPcHRzPERpYWdub3N0aWNzPiB7XHJcbiAgLyoqXHJcbiAgICogVGhlIGZvcm1hdCBvZiB0aGUgaW5jcmVtZW50YWxseSBleHBvcnRlZCBhcnRpZmFjdC5cclxuICAgKiBAZGVmYXVsdCAndmVjdG9yJ1xyXG4gICAqL1xyXG4gIGZvcm1hdD86ICd2ZWN0b3InO1xyXG4gIC8qKlxyXG4gICAqIFRoZSBpbmNyZW1lbnRhbCBzZXJ2ZXIgZm9yIHRoZSBkb2N1bWVudC5cclxuICAgKi9cclxuICBpbmNyZW1lbnRhbFNlcnZlcjogSW5jcmVtZW50YWxTZXJ2ZXI7XHJcbn1cclxuXHJcbmV4cG9ydCBpbnRlcmZhY2UgUXVlcnlPcHRpb25zIHtcclxuICAvKipcclxuICAgKiBzZWxlY3QgcGFydCBvZiBkb2N1bWVudCBmb3IgcXVlcnkuXHJcbiAgICovXHJcbiAgc2VsZWN0b3I6IHN0cmluZztcclxuICAvKipcclxuICAgKiBjYXN0IHJlc3VsdCBieSBhY2Nlc3Npbmcgc2luZ2xlIGZpZWxkLlxyXG4gICAqL1xyXG4gIGZpZWxkPzogc3RyaW5nO1xyXG59XHJcblxyXG4vKipcclxuICogVGhlIG9wdGlvbnMgZm9yIGNvbXBpbGluZyB0aGUgZG9jdW1lbnQuXHJcbiAqL1xyXG5leHBvcnQgdHlwZSBDb21waWxlT3B0aW9uczxcclxuICBGb3JtYXQgZXh0ZW5kcyBDb21waWxlRm9ybWF0RW51bSA9IENvbXBpbGVGb3JtYXRFbnVtLFxyXG4gIERpYWdub3N0aWNzIGV4dGVuZHMgRGlhZ25vc3RpY3NGb3JtYXQgPSBEaWFnbm9zdGljc0Zvcm1hdCxcclxuPiA9IFRyYW5zaWVudENvbXBpbGVPcHRpb25zPEZvcm1hdCwgRGlhZ25vc3RpY3M+IHwgSW5jcmVtZW50YWxDb21waWxlT3B0aW9ucztcclxuXHJcbmV4cG9ydCBjbGFzcyBJbmNyZW1lbnRhbFNlcnZlciB7XHJcbiAgLyoqXHJcbiAgICogQGludGVybmFsXHJcbiAgICovXHJcbiAgW2tPYmplY3RdOiB0eXBzdC5JbmNyU2VydmVyO1xyXG5cclxuICAvKipcclxuICAgKiBAaW50ZXJuYWxcclxuICAgKi9cclxuICBjb25zdHJ1Y3RvcihzOiB0eXBzdC5JbmNyU2VydmVyKSB7XHJcbiAgICB0aGlzW2tPYmplY3RdID0gcztcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFJlc2V0IHRoZSBpbmNyZW1lbnRhbCBzZXJ2ZXIgdG8gdGhlIGluaXRpYWwgc3RhdGUuXHJcbiAgICovXHJcbiAgcmVzZXQoKTogdm9pZCB7XHJcbiAgICB0aGlzW2tPYmplY3RdLnJlc2V0KCk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBSZXR1cm4gY3VycmVudCByZXN1bHQuXHJcbiAgICovXHJcbiAgY3VycmVudCgpOiBVaW50OEFycmF5IHwgdW5kZWZpbmVkIHtcclxuICAgIHJldHVybiB0aGlzW2tPYmplY3RdLmN1cnJlbnQoKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEFsc28gYXR0YWNoIHRoZSBkZWJ1ZyBpbmZvIHRvIHRoZSByZXN1bHQuXHJcbiAgICovXHJcbiAgc2V0QXR0YWNoRGVidWdJbmZvKGVuYWJsZTogYm9vbGVhbik6IHZvaWQge1xyXG4gICAgdGhpc1trT2JqZWN0XS5zZXRfYXR0YWNoX2RlYnVnX2luZm8oZW5hYmxlKTtcclxuICB9XHJcbn1cclxuXHJcbmludGVyZmFjZSBDb21waWxlUmVzdWx0PFQsIEQgZXh0ZW5kcyBEaWFnbm9zdGljc0Zvcm1hdD4ge1xyXG4gIHJlc3VsdD86IFQ7XHJcbiAgZGlhZ25vc3RpY3M/OiBEaWFnbm9zdGljc0RhdGFbRF1bXTtcclxufVxyXG5cclxuZXhwb3J0IGludGVyZmFjZSBUeXBzdEZvbnRJbmZvIHsgfVxyXG5cclxuZW51bSBUeXBzdEZvbnRSZXNvbHZlckNvbnMgeyB9XHJcbmV4cG9ydCB0eXBlIFR5cHN0Rm9udFJlc29sdmVyID0gVHlwc3RGb250UmVzb2x2ZXJDb25zO1xyXG5cclxuZXhwb3J0IGludGVyZmFjZSBUeXBzdEZvbnRCdWlsZGVyIHtcclxuICAvKipcclxuICAgKiBJbml0aWFsaXplIHRoZSBmb250IGJ1aWxkZXIuXHJcbiAgICogQHBhcmFtIG9wdGlvbnMgLSBUaGUgb3B0aW9ucyBmb3IgaW5pdGlhbGl6aW5nIHRoZSBmb250IGJ1aWxkZXIuXHJcbiAgICovXHJcbiAgaW5pdChvcHRpb25zPzogUGFydGlhbDxJbml0T3B0aW9ucz4pOiBQcm9taXNlPHZvaWQ+O1xyXG4gIC8qKlxyXG4gICAqIEdldCB0aGUgZm9udCBpbmZvLlxyXG4gICAqXHJcbiAgICogQHBhcmFtIGZvbnRfYnVmZmVyIC0gVGhlIGZvbnQgYnVmZmVyIHRvIGdldCB0aGUgZm9udCBpbmZvLlxyXG4gICAqIEByZXR1cm5zIHtUeXBzdEZvbnRJbmZvfSAtIFRoZSBmb250IGluZm8uXHJcbiAgICovXHJcbiAgZ2V0Rm9udEluZm8oZm9udF9idWZmZXI6IFVpbnQ4QXJyYXkpOiBQcm9taXNlPFR5cHN0Rm9udEluZm8+O1xyXG4gIC8qKlxyXG4gICAqIEFkZCBhIHJhdyBmb250LlxyXG4gICAqXHJcbiAgICogQHBhcmFtIGZvbnRfYnVmZmVyIC0gVGhlIGZvbnQgYnVmZmVyIHRvIGFkZC5cclxuICAgKi9cclxuICBhZGRGb250RGF0YShmb250X2J1ZmZlcjogVWludDhBcnJheSk6IFByb21pc2U8dm9pZD47XHJcbiAgLyoqXHJcbiAgICogQWRkIGEgbGF6eSBmb250LlxyXG4gICAqXHJcbiAgICogQHBhcmFtIGluZm8gLSBUaGUgZm9udCBpbmZvLCB1c3VhbGx5IGZyb20ge0BsaW5rIGdldEZvbnRJbmZvfS5cclxuICAgKiBAcGFyYW0gYmxvYiAtIFRoZSBibG9iIGZ1bmN0aW9uIHRvIGdldCB0aGUgZm9udCBidWZmZXIuXHJcbiAgICogQHBhcmFtIGNvbnRleHQgLSBUaGUgY29udGV4dC5cclxuICAgKi9cclxuICBhZGRMYXp5Rm9udChcclxuICAgIGluZm86IFR5cHN0Rm9udEluZm8sXHJcbiAgICBibG9iOiAoaWR4OiBudW1iZXIpID0+IFVpbnQ4QXJyYXksXHJcbiAgICBjb250ZXh0Pzogb2JqZWN0LFxyXG4gICk6IFByb21pc2U8dm9pZD47XHJcblxyXG4gIC8qKlxyXG4gICAqIEJ1aWxkIHRoZSBmb250IHJlc29sdmVyLiBUaGUgZm9udCByZXNvbHZlciB3aWxsIGJlIGZyZWVkIGFmdGVyIHRoZSBjYWxsYmFja1xyXG4gICAqIGlzIGludm9rZWQgYW5kIGJlZm9yZSByZXR1cm5pbmcgdGhlIGJ1aWxkIGZ1bmN0aW9uLlxyXG4gICAqXHJcbiAgICogQHBhcmFtIGNiIC0gVGhlIGZ1bmN0aW9uIHRvIHVzZSB0aGUgZm9udCByZXNvbHZlci5cclxuICAgKiBAcmV0dXJucyB7UHJvbWlzZTxUPn0gLSBUaGUgcmVzdWx0IG9mIHRoZSBmdW5jdGlvbi5cclxuICAgKi9cclxuICBidWlsZDxUPihjYjogKHJlc29sdmVyOiBUeXBzdEZvbnRSZXNvbHZlcikgPT4gUHJvbWlzZTxUPik6IFByb21pc2U8VD47XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBjcmVhdGUgYSBUeXBzdCBmb250IGJ1aWxkZXIuXHJcbiAqIEByZXR1cm5zIHtUeXBzdEZvbnRCdWlsZGVyfSAtIFRoZSBUeXBzdCBmb250IGJ1aWxkZXIuXHJcbiAqIEBleGFtcGxlXHJcbiAqIGBgYHR5cGVzY3JpcHRcclxuICogaW1wb3J0IHsgY3JlYXRlVHlwc3RGb250QnVpbGRlciB9IGZyb20gJ3R5cHN0JztcclxuICogY29uc3QgZmIgPSBjcmVhdGVUeXBzdEZvbnRCdWlsZGVyKCk7XHJcbiAqIGF3YWl0IGZiLmluaXQoKTtcclxuICogYXdhaXQgZmIuYWRkRm9udERhdGEobmV3IFVpbnQ4QXJyYXkoYXdhaXQgZmV0Y2goJ2ZvbnQudHRmJykudGhlbihyID0+IHIuYXJyYXlCdWZmZXIoKSkpKTtcclxuICogYXdhaXQgZmIuYnVpbGQoKTtcclxuICogYGBgXHJcbiAqL1xyXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlVHlwc3RGb250QnVpbGRlcigpOiBUeXBzdEZvbnRCdWlsZGVyIHtcclxuICByZXR1cm4gbmV3IFR5cHN0Rm9udEJ1aWxkZXJEcml2ZXIoKTtcclxufVxyXG5cclxuZXhwb3J0IGNsYXNzIFR5cHN0V29ybGQge1xyXG4gIHByaXZhdGUgW2tPYmplY3RdOiB0eXBzdC5UeXBzdENvbXBpbGVXb3JsZDtcclxuXHJcbiAgY29uc3RydWN0b3Iod29ybGQ6IHR5cHN0LlR5cHN0Q29tcGlsZVdvcmxkKSB7XHJcbiAgICB0aGlzW2tPYmplY3RdID0gd29ybGQ7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBDb21waWxlIHRoZSBwYWdlZCBkb2N1bWVudC5cclxuICAgKlxyXG4gICAqIEBwYXJhbSB7RGlhZ25vc3RpY3NGb3JtYXR9IGZvcm1hdCAtIFRoZSBmb3JtYXQgb2YgdGhlIGRpYWdub3N0aWNzLlxyXG4gICAqIEByZXR1cm5zIHtQcm9taXNlPHsgZGlhZ25vc3RpY3M/OiBEaWFnbm9zdGljc0RhdGFbRGlhZ25vc3RpY3NGb3JtYXRdW10gfT59IC0gVGhlIHJlc3VsdCBvZiB0aGUgY29tcGlsYXRpb24uXHJcbiAgICovXHJcbiAgY29tcGlsZTxEIGV4dGVuZHMgRGlhZ25vc3RpY3NGb3JtYXQgPSAnZnVsbCc+KFxyXG4gICAgb3B0cz86IERpYWdPcHRzPEQ+LFxyXG4gICk6IFByb21pc2U8Q29tcGlsZVJlc3VsdDx1bmRlZmluZWQsIEQ+ICYgeyBoYXNFcnJvcjogYm9vbGVhbiB9PiB7XHJcbiAgICByZXR1cm4gdGhpc1trT2JqZWN0XS5jb21waWxlKDAsIGdldERpYWdub3N0aWNzQXJnKG9wdHM/LmRpYWdub3N0aWNzKSk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBDb21waWxlIHRoZSBwYWdlZCBkb2N1bWVudC5cclxuICAgKlxyXG4gICAqIEBwYXJhbSB7RGlhZ25vc3RpY3NGb3JtYXR9IGZvcm1hdCAtIFRoZSBmb3JtYXQgb2YgdGhlIGRpYWdub3N0aWNzLlxyXG4gICAqIEByZXR1cm5zIHtQcm9taXNlPHsgZGlhZ25vc3RpY3M/OiBEaWFnbm9zdGljc0RhdGFbRGlhZ25vc3RpY3NGb3JtYXRdW10gfT59IC0gVGhlIHJlc3VsdCBvZiB0aGUgY29tcGlsYXRpb24uXHJcbiAgICovXHJcbiAgY29tcGlsZUh0bWw8RCBleHRlbmRzIERpYWdub3N0aWNzRm9ybWF0ID0gJ2Z1bGwnPihcclxuICAgIG9wdHM/OiBEaWFnT3B0czxEPixcclxuICApOiBQcm9taXNlPENvbXBpbGVSZXN1bHQ8dW5kZWZpbmVkLCBEPiAmIHsgaGFzRXJyb3I6IGJvb2xlYW4gfT4ge1xyXG4gICAgcmV0dXJuIHRoaXNba09iamVjdF0uY29tcGlsZSgxLCBnZXREaWFnbm9zdGljc0FyZyhvcHRzPy5kaWFnbm9zdGljcykpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogUnVucyBxdWVyeSBvbiB0aGUgcGFnZWQgZG9jdW1lbnQuXHJcbiAgICovXHJcbiAgYXN5bmMgcXVlcnk8VCA9IGFueT4ob3B0aW9uczogUXVlcnlPcHRpb25zKTogUHJvbWlzZTxUPiB7XHJcbiAgICByZXR1cm4gSlNPTi5wYXJzZSh0aGlzW2tPYmplY3RdLnF1ZXJ5KDAsIG9wdGlvbnMuc2VsZWN0b3IsIG9wdGlvbnMuZmllbGQpKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEdldCB0aGUgdGl0bGUgb2YgdGhlIHBhZ2VkIGRvY3VtZW50LlxyXG4gICAqIFRocm93IGVycm9yIGlmIHRoZSB3b3JsZCBkaWRuJ3QgY29tcGlsZSB0aGUgcGFnZWQgZG9jdW1lbnQuXHJcbiAgICpcclxuICAgKiBAcmV0dXJucyB7c3RyaW5nIHwgdW5kZWZpbmVkfSAtIFRoZSB0aXRsZSBvZiB0aGUgcGFnZWQgZG9jdW1lbnQuXHJcbiAgICovXHJcbiAgdGl0bGUoKTogc3RyaW5nIHwgdW5kZWZpbmVkIHtcclxuICAgIHJldHVybiB0aGlzW2tPYmplY3RdLnRpdGxlKDApO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogRXhwb3J0IHRoZSBwYWdlZCBkb2N1bWVudCBhcyB2ZWN0b3IgZm9ybWF0LlxyXG4gICAqXHJcbiAgICogQHJldHVybnMge1VpbnQ4QXJyYXkgfCB1bmRlZmluZWR9IC0gVGhlIHRpdGxlIG9mIHRoZSBwYWdlZCBkb2N1bWVudC5cclxuICAgKi9cclxuICB2ZWN0b3I8RCBleHRlbmRzIERpYWdub3N0aWNzRm9ybWF0ID0gJ2Z1bGwnPihcclxuICAgIG9wdHM/OiBEaWFnT3B0czxEPixcclxuICApOiBQcm9taXNlPENvbXBpbGVSZXN1bHQ8VWludDhBcnJheSwgRD4+IHtcclxuICAgIHJldHVybiB0aGlzW2tPYmplY3RdLmdldF9hcnRpZmFjdCgwLCBnZXREaWFnbm9zdGljc0FyZyhvcHRzPy5kaWFnbm9zdGljcykpIHx8IHt9O1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogRXhwb3J0IHRoZSBwYWdlZCBkb2N1bWVudCB0byBQREYuXHJcbiAgICpcclxuICAgKiBAcmV0dXJucyB7VWludDhBcnJheSB8IHVuZGVmaW5lZH0gLSBUaGUgdGl0bGUgb2YgdGhlIHBhZ2VkIGRvY3VtZW50LlxyXG4gICAqL1xyXG4gIHBkZjxEIGV4dGVuZHMgRGlhZ25vc3RpY3NGb3JtYXQgPSAnZnVsbCc+KFxyXG4gICAgb3B0cz86IERpYWdPcHRzPEQ+LFxyXG4gICk6IFByb21pc2U8Q29tcGlsZVJlc3VsdDxVaW50OEFycmF5LCBEPj4ge1xyXG4gICAgcmV0dXJuIHRoaXNba09iamVjdF0uZ2V0X2FydGlmYWN0KDEsIGdldERpYWdub3N0aWNzQXJnKG9wdHM/LmRpYWdub3N0aWNzKSkgfHwge307XHJcbiAgfVxyXG59XHJcblxyXG4vKipcclxuICogVGhlIGludGVyZmFjZSBvZiBUeXBzdCBjb21waWxlci5cclxuICovXHJcbmV4cG9ydCBpbnRlcmZhY2UgVHlwc3RDb21waWxlciB7XHJcbiAgLyoqXHJcbiAgICogSW5pdGlhbGl6ZSB0aGUgdHlwc3QgY29tcGlsZXIuXHJcbiAgICogQHBhcmFtIHtQYXJ0aWFsPEluaXRPcHRpb25zPn0gb3B0aW9ucyAtIFRoZSBvcHRpb25zIGZvciBpbml0aWFsaXppbmcgdGhlXHJcbiAgICogdHlwc3QgY29tcGlsZXIuXHJcbiAgICovXHJcbiAgaW5pdChvcHRpb25zPzogUGFydGlhbDxJbml0T3B0aW9ucz4pOiBQcm9taXNlPHZvaWQ+O1xyXG5cclxuICAvKipcclxuICAgKiBSZXNldCB0aGUgdHlwc3QgY29tcGlsZXIgdG8gdGhlIGluaXRpYWwgc3RhdGUuXHJcbiAgICogTm90ZTogd2l0aG91dCBjYWxsaW5nIHRoaXMgZnVuY3Rpb24sIHRoZSBjb21waWxlciB3aWxsIGFsd2F5cyBrZWVwIGNhY2hlc1xyXG4gICAqIHN1Y2ggYXM6XHJcbiAgICogLSBsb2FkZWQgZm9udHNcclxuICAgKiAtIHNvdXJjZSBmaWxlcyBjb3JyZXNwb25kaW5nIHRvIHR5cHN0IG1vZHVsZXNcclxuICAgKlxyXG4gICAqIE5vdGU6IHRoaXMgZnVuY3Rpb24gaXMgaW5kZXBlbmRlbnQgdG8gdGhlIHtAbGluayByZXNldFNoYWRvd30gZnVuY3Rpb24uXHJcbiAgICogVGhpcyBpcyBpbnRlbmRlZCB0byBvcHRpbWl6ZSB0aGUgcGVyZm9ybWFuY2Ugb2YgdGhlIGNvbXBpbGVyLlxyXG4gICAqL1xyXG4gIHJlc2V0KCk6IFByb21pc2U8dm9pZD47XHJcblxyXG4gIC8qKlxyXG4gICAqIENvbXBpbGUgYW4gZG9jdW1lbnQgd2l0aCB0aGUgbWFpbnRhaW5lZCBzdGF0ZS5cclxuICAgKiBAcGFyYW0ge0NvbXBpbGVPcHRpb25zfSBvcHRpb25zIC0gVGhlIG9wdGlvbnMgZm9yIGNvbXBpbGluZyB0aGUgZG9jdW1lbnQuXHJcbiAgICogQHJldHVybnMge1Byb21pc2U8VWludDhBcnJheT59IC0gYXJ0aWZhY3QgaW4gdmVjdG9yIGZvcm1hdC5cclxuICAgKiBZb3UgY2FuIHRoZW4gbG9hZCB0aGUgYXJ0aWZhY3QgdG8gdGhlIHJlbmRlcmVyIHRvIHJlbmRlciB0aGUgZG9jdW1lbnQuXHJcbiAgICovXHJcbiAgY29tcGlsZTxEIGV4dGVuZHMgRGlhZ25vc3RpY3NGb3JtYXQ+KFxyXG4gICAgb3B0aW9uczogQ29tcGlsZU9wdGlvbnM8Q29tcGlsZUZvcm1hdEVudW0udmVjdG9yLCBEPixcclxuICApOiBQcm9taXNlPENvbXBpbGVSZXN1bHQ8VWludDhBcnJheSwgRD4+O1xyXG4gIGNvbXBpbGU8RCBleHRlbmRzIERpYWdub3N0aWNzRm9ybWF0PihcclxuICAgIG9wdGlvbnM6IENvbXBpbGVPcHRpb25zPENvbXBpbGVGb3JtYXRFbnVtLnBkZiwgRD4sXHJcbiAgKTogUHJvbWlzZTxDb21waWxlUmVzdWx0PFVpbnQ4QXJyYXksIEQ+PjtcclxuICBjb21waWxlPEYgZXh0ZW5kcyBDb21waWxlRm9ybWF0RW51bSwgRCBleHRlbmRzIERpYWdub3N0aWNzRm9ybWF0PihcclxuICAgIG9wdGlvbnM6IENvbXBpbGVPcHRpb25zPEYsIEQ+LFxyXG4gICk6IFByb21pc2U8Q29tcGlsZVJlc3VsdDxVaW50OEFycmF5LCBEPj47XHJcblxyXG4gIHJ1bldpdGhXb3JsZDxUPihvcHRpb25zOiBTbmFwc2hvdE9wdGlvbnMsIGNiOiAod29ybGQ6IFR5cHN0V29ybGQpID0+IFByb21pc2U8VD4pOiBQcm9taXNlPFQ+O1xyXG5cclxuICAvKipcclxuICAgKiBTZXQgdGhlIGZvbnRzIHRvIHRoZSBjb21waWxlci4gTm90ZTogbXVsdGlwbGUgY29tcGlsZXJzIGNhbiBzaGFyZSB0aGUgc2FtZSBmb250cy5cclxuICAgKlxyXG4gICAqIEBwYXJhbSB7VHlwc3RGb250UmVzb2x2ZXJ9IGZvbnRzIC0gVGhlIGZvbnRzIHRvIHNldC5cclxuICAgKi9cclxuICBzZXRGb250cyhmb250czogVHlwc3RGb250UmVzb2x2ZXIpOiB2b2lkO1xyXG5cclxuICAvKipcclxuICAgKiBleHBlcmltZW50YWxcclxuICAgKiBRdWVyeSB0aGUgcmVzdWx0IHdpdGggZG9jdW1lbnRcclxuICAgKi9cclxuICBxdWVyeTxUPihvcHRpb25zOiBRdWVyeU9wdGlvbnMgJiBTbmFwc2hvdE9wdGlvbnMpOiBQcm9taXNlPFQ+O1xyXG5cclxuICAvKipcclxuICAgKiBQcmludCB0aGUgQVNUIG9mIHRoZSBtYWluIGZpbGUuXHJcbiAgICogQHBhcmFtIHtzdHJpbmd9IG1haW5GaWxlUGF0aCAtIFRoZSBwYXRoIG9mIHRoZSBtYWluIGZpbGUuXHJcbiAgICogQHJldHVybnMge1Byb21pc2U8c3RyaW5nPn0gLSBhbiBzdHJpbmcgcmVwcmVzZW50YXRpb24gb2YgdGhlIEFTVC5cclxuICAgKi9cclxuICBnZXRBc3QobWFpbkZpbGVQYXRoOiBzdHJpbmcpOiBQcm9taXNlPHN0cmluZz47XHJcblxyXG4gIC8qKlxyXG4gICAqIEFkZCBhIHNvdXJjZSBmaWxlIHRvIHRoZSBjb21waWxlci5cclxuICAgKiBAcGFyYW0ge3N0cmluZ30gcGF0aCAtIFRoZSBwYXRoIG9mIHRoZSBzb3VyY2UgZmlsZS5cclxuICAgKiBAcGFyYW0ge3N0cmluZ30gc291cmNlIC0gVGhlIHNvdXJjZSBjb2RlIG9mIHRoZSBzb3VyY2UgZmlsZS5cclxuICAgKlxyXG4gICAqL1xyXG4gIGFkZFNvdXJjZShwYXRoOiBzdHJpbmcsIHNvdXJjZTogc3RyaW5nKTogdm9pZDtcclxuXHJcbiAgLyoqXHJcbiAgICogQWRkIGEgc2hhZG93IGZpbGUgdG8gdGhlIGNvbXBpbGVyLlxyXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBwYXRoIC0gVGhlIHBhdGggdG8gdGhlIHNoYWRvdyBmaWxlLlxyXG4gICAqIEBwYXJhbSB7VWludDhBcnJheX0gY29udGVudCAtIFRoZSBjb250ZW50IG9mIHRoZSBzaGFkb3cgZmlsZS5cclxuICAgKlxyXG4gICAqL1xyXG4gIG1hcFNoYWRvdyhwYXRoOiBzdHJpbmcsIGNvbnRlbnQ6IFVpbnQ4QXJyYXkpOiB2b2lkO1xyXG5cclxuICAvKipcclxuICAgKiBSZW1vdmUgYSBzaGFkb3cgZmlsZSBmcm9tIHRoZSBjb21waWxlci5cclxuICAgKiBAcGFyYW0ge3N0cmluZ30gcGF0aCAtIFRoZSBwYXRoIHRvIHRoZSBzaGFkb3cgZmlsZS5cclxuICAgKi9cclxuICB1bm1hcFNoYWRvdyhwYXRoOiBzdHJpbmcpOiB2b2lkO1xyXG5cclxuICAvKipcclxuICAgKiBSZXNldCB0aGUgc2hhZG93IGZpbGVzLlxyXG4gICAqIE5vdGU6IHRoaXMgZnVuY3Rpb24gaXMgaW5kZXBlbmRlbnQgdG8gdGhlIHtAbGluayByZXNldH0gZnVuY3Rpb24uXHJcbiAgICovXHJcbiAgcmVzZXRTaGFkb3coKTogdm9pZDtcclxuXHJcbiAgLyoqXHJcbiAgICogZXhwZXJpbWVudGFsXHJcbiAgICogU2VlIFNlbWFudGljIHRva2VuczogaHR0cHM6Ly9naXRodWIuY29tL21pY3Jvc29mdC92c2NvZGUvaXNzdWVzLzg2NDE1XHJcbiAgICovXHJcbiAgZ2V0U2VtYW50aWNUb2tlbkxlZ2VuZCgpOiBQcm9taXNlPFNlbWFudGljVG9rZW5zTGVnZW5kPjtcclxuXHJcbiAgLyoqXHJcbiAgICogZXhwZXJpbWVudGFsXHJcbiAgICogU2VlIFNlbWFudGljIHRva2VuczogaHR0cHM6Ly9naXRodWIuY29tL21pY3Jvc29mdC92c2NvZGUvaXNzdWVzLzg2NDE1XHJcbiAgICpcclxuICAgKiBAcGFyYW0ge3N0cmluZ30gb3B0cy5tYWluRmlsZVBhdGggLSBUaGUgcGF0aCBvZiB0aGUgbWFpbiBmaWxlLlxyXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBvcHRzLnJlc3VsdElkIC0gVGhlIGlkIG9mIHRoZSByZXN1bHQuXHJcbiAgICogQHBhcmFtIHtzdHJpbmd9IG9wdHMub2Zmc2V0RW5jb2RpbmcgLSBUaGUgZW5jb2Rpbmcgb2YgdGhlIG9mZnNldC5cclxuICAgKiAgIC0gJ3V0Zi0xNic6IHRoZSBvZmZzZXQgaXMgZW5jb2RlZCBpbiB1dGYtMTYuXHJcbiAgICogICAtICd1dGYtOCc6IHRoZSBvZmZzZXQgaXMgZW5jb2RlZCBpbiB1dGYtOC5cclxuICAgKiAgIEBkZWZhdWx0ICd1dGYtMTYnXHJcbiAgICogQHJldHVybnMge1Byb21pc2U8U2VtYW50aWNUb2tlbnM+fSAtIFRoZSBzZW1hbnRpYyB0b2tlbnMuXHJcbiAgICovXHJcbiAgZ2V0U2VtYW50aWNUb2tlbnMob3B0czoge1xyXG4gICAgbWFpbkZpbGVQYXRoOiBzdHJpbmc7XHJcbiAgICByZXN1bHRJZD86IHN0cmluZztcclxuICAgIG9mZnNldEVuY29kaW5nPzogc3RyaW5nO1xyXG4gIH0pOiBQcm9taXNlPFNlbWFudGljVG9rZW5zPjtcclxuXHJcbiAgLyoqXHJcbiAgICogZXhwZXJpbWVudGFsXHJcbiAgICogUnVuIHdpdGggYW4gaW5jcmVtZW50YWwgc2VydmVyIHdoaWNoIGhvbGRzIHRoZSBzdGF0ZSBvZiB0aGUgZG9jdW1lbnQgaW4gd2FzbS5cclxuICAgKlxyXG4gICAqIEBwYXJhbSB7ZnVuY3Rpb24oSW5jcmVtZW50YWxTZXJ2ZXIpOiBQcm9taXNlPFQ+fSBmIC0gVGhlIGZ1bmN0aW9uIHRvIHJ1biB3aXRoIHRoZSBpbmNyZW1lbnRhbCBzZXJ2ZXIuXHJcbiAgICogQHJldHVybnMge1Byb21pc2U8VD59IC0gVGhlIHJlc3VsdCBvZiB0aGUgZnVuY3Rpb24uXHJcbiAgICpcclxuICAgKiBOb3RlOiB0aGUgaW5jcmVtZW50YWwgc2VydmVyIHdpbGwgYmUgZnJlZWQgYWZ0ZXIgdGhlIGZ1bmN0aW9uIGlzIGZpbmlzaGVkLlxyXG4gICAqL1xyXG4gIHdpdGhJbmNyZW1lbnRhbFNlcnZlcjxUPihmOiAoczogSW5jcmVtZW50YWxTZXJ2ZXIpID0+IFByb21pc2U8VD4pOiBQcm9taXNlPFQ+O1xyXG59XHJcblxyXG5jb25zdCBnQ29tcGlsZXJNb2R1bGUgPSAobW9kdWxlOiB0eXBlb2YgdHlwc3QpID0+XHJcbiAgbmV3IExhenlXYXNtTW9kdWxlKGFzeW5jIChiaW4/OiBhbnkpID0+IHtcclxuICAgIHJldHVybiBhd2FpdCBtb2R1bGUuZGVmYXVsdChiaW4pO1xyXG4gIH0pO1xyXG5cclxuLyoqXHJcbiAqIGNyZWF0ZSBhIFR5cHN0IGNvbXBpbGVyLlxyXG4gKiBAcmV0dXJucyB7VHlwc3RDb21waWxlcn0gLSBUaGUgVHlwc3QgY29tcGlsZXIuXHJcbiAqIEBleGFtcGxlXHJcbiAqIGBgYHR5cGVzY3JpcHRcclxuICogaW1wb3J0IHsgY3JlYXRlVHlwc3RDb21waWxlciB9IGZyb20gJ3R5cHN0JztcclxuICogY29uc3QgY29tcGlsZXIgPSBjcmVhdGVUeXBzdENvbXBpbGVyKCk7XHJcbiAqIGF3YWl0IGNvbXBpbGVyLmluaXQoKTtcclxuICogY29tcGlsZXIuYWRkU291cmNlKCcvbWFpbi50eXAnLCAnSGVsbG8sIHR5cHN0IScpO1xyXG4gKiBhd2FpdCBjb21waWxlci5jb21waWxlKHsgbWFpbkZpbGVQYXRoOiAnL21haW4udHlwJyB9KTtcclxuICogYGBgXHJcbiAqL1xyXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlVHlwc3RDb21waWxlcigpOiBUeXBzdENvbXBpbGVyIHtcclxuICByZXR1cm4gbmV3IFR5cHN0Q29tcGlsZXJEcml2ZXIoKTtcclxufVxyXG5cclxuZXhwb3J0IGNsYXNzIFR5cHN0Rm9udEJ1aWxkZXJEcml2ZXIgaW1wbGVtZW50cyBUeXBzdEZvbnRCdWlsZGVyIHtcclxuICBwcml2YXRlIGZvbnRCdWlsZGVySnM6IHR5cGVvZiB0eXBzdDtcclxuICBwcml2YXRlIGZvbnRCdWlsZGVyOiB0eXBzdC5UeXBzdEZvbnRSZXNvbHZlckJ1aWxkZXI7XHJcblxyXG4gIGFzeW5jIGluaXQob3B0aW9ucz86IFBhcnRpYWw8SW5pdE9wdGlvbnM+KTogUHJvbWlzZTx2b2lkPiB7XHJcbiAgICB0aGlzLmZvbnRCdWlsZGVySnMgPSBhd2FpdCAob3B0aW9ucz8uZ2V0V3JhcHBlcj8uKCkgfHwgaW1wb3J0KCdAbXlyaWFkZHJlYW1pbi90eXBzdC10cy13ZWItY29tcGlsZXInKSk7XHJcbiAgICAvLy8gaW5pdCB0eXBzdCB3YXNtIG1vZHVsZVxyXG4gICAgYXdhaXQgZ0NvbXBpbGVyTW9kdWxlKHRoaXMuZm9udEJ1aWxkZXJKcykuaW5pdChvcHRpb25zPy5nZXRNb2R1bGU/LigpKTtcclxuXHJcbiAgICB0aGlzLmZvbnRCdWlsZGVyID0gbmV3IHRoaXMuZm9udEJ1aWxkZXJKcy5UeXBzdEZvbnRSZXNvbHZlckJ1aWxkZXIoKTtcclxuICB9XHJcblxyXG4gIGFzeW5jIGdldEZvbnRJbmZvKGZvbnRfYnVmZmVyOiBVaW50OEFycmF5KTogUHJvbWlzZTxUeXBzdEZvbnRJbmZvPiB7XHJcbiAgICByZXR1cm4gdGhpcy5mb250QnVpbGRlci5nZXRfZm9udF9pbmZvKGZvbnRfYnVmZmVyKSBhcyBUeXBzdEZvbnRJbmZvO1xyXG4gIH1cclxuXHJcbiAgYXN5bmMgYWRkRm9udERhdGEoZm9udF9idWZmZXI6IFVpbnQ4QXJyYXkpOiBQcm9taXNlPHZvaWQ+IHtcclxuICAgIHRoaXMuZm9udEJ1aWxkZXIuYWRkX3Jhd19mb250KGZvbnRfYnVmZmVyKTtcclxuICB9XHJcbiAgYXN5bmMgYWRkTGF6eUZvbnQ8QyBleHRlbmRzIFR5cHN0Rm9udEluZm8+KFxyXG4gICAgaW5mbzogVHlwc3RGb250SW5mbyxcclxuICAgIGJsb2I6ICh0aGlzOiBDLCBpZHg6IG51bWJlcikgPT4gVWludDhBcnJheSxcclxuICApOiBQcm9taXNlPHZvaWQ+IHtcclxuICAgIHJldHVybiB0aGlzLmZvbnRCdWlsZGVyLmFkZF9sYXp5X2ZvbnQoaW5mbywgYmxvYik7XHJcbiAgfVxyXG4gIGFzeW5jIGJ1aWxkPFQ+KGNiOiAocmVzb2x2ZXI6IFR5cHN0Rm9udFJlc29sdmVyKSA9PiBQcm9taXNlPFQ+KTogUHJvbWlzZTxUPiB7XHJcbiAgICBjb25zdCBmb250cyA9IGF3YWl0IHRoaXMuZm9udEJ1aWxkZXIuYnVpbGQoKTtcclxuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGNiKGZvbnRzIGFzIGFueSBhcyBUeXBzdEZvbnRSZXNvbHZlcik7XHJcbiAgICBmb250cy5mcmVlKCk7XHJcbiAgICByZXR1cm4gcmVzdWx0O1xyXG4gIH1cclxufVxyXG5cclxuY2xhc3MgVHlwc3RDb21waWxlckRyaXZlciBpbXBsZW1lbnRzIFR5cHN0Q29tcGlsZXIge1xyXG4gIGNvbXBpbGVyOiB0eXBzdC5UeXBzdENvbXBpbGVyO1xyXG4gIGNvbXBpbGVySnM6IHR5cGVvZiB0eXBzdDtcclxuXHJcbiAgc3RhdGljIGRlZmF1bHRBc3NldHMgPSBbJ3RleHQnIGFzIGNvbnN0XTtcclxuXHJcbiAgY29uc3RydWN0b3IoKSB7IH1cclxuXHJcbiAgYXN5bmMgaW5pdChvcHRpb25zPzogUGFydGlhbDxJbml0T3B0aW9ucz4pOiBQcm9taXNlPHZvaWQ+IHtcclxuICAgIHRoaXMuY29tcGlsZXJKcyA9IGF3YWl0IChvcHRpb25zPy5nZXRXcmFwcGVyPy4oKSB8fCBpbXBvcnQoJ0BteXJpYWRkcmVhbWluL3R5cHN0LXRzLXdlYi1jb21waWxlcicpKTtcclxuICAgIGNvbnN0IFR5cHN0Q29tcGlsZXJCdWlsZGVyID0gdGhpcy5jb21waWxlckpzLlR5cHN0Q29tcGlsZXJCdWlsZGVyO1xyXG5cclxuICAgIGNvbnN0IGNvbXBpbGVyT3B0aW9ucyA9IHsgLi4uKG9wdGlvbnMgfHwge30pIH07XHJcbiAgICBjb25zdCBiZWZvcmVCdWlsZCA9IChjb21waWxlck9wdGlvbnMuYmVmb3JlQnVpbGQgPz89IFtdKTtcclxuICAgIGNvbnN0IGhhc1ByZWxvYWRSZW1vdGVGb250cyA9IGJlZm9yZUJ1aWxkLnNvbWUoXHJcbiAgICAgIChmbjogYW55KSA9PiBmbi5fcHJlbG9hZFJlbW90ZUZvbnRPcHRpb25zICE9PSB1bmRlZmluZWQsXHJcbiAgICApO1xyXG4gICAgY29uc3QgaGFzU3BlY2lmaWVkQXNzZXRzID0gYmVmb3JlQnVpbGQuc29tZShcclxuICAgICAgKGZuOiBhbnkpID0+IGZuLl9wcmVsb2FkUmVtb3RlRm9udE9wdGlvbnM/LmFzc2V0cyAhPT0gdW5kZWZpbmVkLFxyXG4gICAgKTtcclxuICAgIGNvbnN0IGhhc0Rpc2FibGVBc3NldHMgPSBiZWZvcmVCdWlsZC5zb21lKFxyXG4gICAgICAoZm46IGFueSkgPT4gZm4uX3ByZWxvYWRSZW1vdGVGb250T3B0aW9ucz8uYXNzZXRzID09PSBmYWxzZSxcclxuICAgICk7XHJcblxyXG4gICAgaWYgKCFoYXNQcmVsb2FkUmVtb3RlRm9udHMgfHwgKCFoYXNTcGVjaWZpZWRBc3NldHMgJiYgIWhhc0Rpc2FibGVBc3NldHMpKSB7XHJcbiAgICAgIGJlZm9yZUJ1aWxkLnB1c2gobG9hZEZvbnRzKFtdLCB7IGFzc2V0czogVHlwc3RDb21waWxlckRyaXZlci5kZWZhdWx0QXNzZXRzIH0pKTtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCBoYXNGb250TG9hZGVyID0gYmVmb3JlQnVpbGQuc29tZSgoZm46IGFueSkgPT4gZm4uX2tpbmQgPT09ICdmb250TG9hZGVyJyk7XHJcbiAgICBpZiAoIWhhc0ZvbnRMb2FkZXIpIHtcclxuICAgICAgdGhyb3cgbmV3IEVycm9yKFxyXG4gICAgICAgICdUeXBzdENvbXBpbGVyOiBubyBmb250IGxvYWRlciBmb3VuZCwgcGxlYXNlIHVzZSBmb250IGxvYWRlcnMsIGUuZy4gbG9hZEZvbnRzIG9yIHByZWxvYWRTeXN0ZW1Gb250cycsXHJcbiAgICAgICk7XHJcbiAgICB9XHJcbiAgICB0aGlzLmNvbXBpbGVyID0gYXdhaXQgYnVpbGRDb21wb25lbnQob3B0aW9ucywgZ0NvbXBpbGVyTW9kdWxlKHRoaXMuY29tcGlsZXJKcyksIFR5cHN0Q29tcGlsZXJCdWlsZGVyLCB7fSk7XHJcbiAgfVxyXG5cclxuICBzZXRGb250cyhmb250czogVHlwc3RGb250UmVzb2x2ZXIpOiB2b2lkIHtcclxuICAgIHRoaXMuY29tcGlsZXIuc2V0X2ZvbnRzKGZvbnRzIGFzIGFueSBhcyB0eXBzdC5UeXBzdEZvbnRSZXNvbHZlcik7XHJcbiAgfVxyXG5cclxuICBjb21waWxlKG9wdGlvbnM6IENvbXBpbGVPcHRpb25zKTogUHJvbWlzZTxhbnk+IHtcclxuICAgIHJldHVybiBuZXcgUHJvbWlzZShyZXNvbHZlID0+IHtcclxuICAgICAgY29uc3Qgd29ybGQgPSB0aGlzLmNvbXBpbGVyLnNuYXBzaG90KFxyXG4gICAgICAgIG9wdGlvbnMucm9vdCxcclxuICAgICAgICBvcHRpb25zLm1haW5GaWxlUGF0aCxcclxuICAgICAgICBjb252ZXJ0SW5wdXRzKG9wdGlvbnMuaW5wdXRzKSxcclxuICAgICAgKTtcclxuICAgICAgaWYgKCdpbmNyZW1lbnRhbFNlcnZlcicgaW4gb3B0aW9ucykge1xyXG4gICAgICAgIHJlc29sdmUoXHJcbiAgICAgICAgICB3b3JsZC5pbmNyX2NvbXBpbGUoXHJcbiAgICAgICAgICAgIG9wdGlvbnMuaW5jcmVtZW50YWxTZXJ2ZXJba09iamVjdF0sXHJcbiAgICAgICAgICAgIGdldERpYWdub3N0aWNzQXJnKG9wdGlvbnMuZGlhZ25vc3RpY3MpLFxyXG4gICAgICAgICAgKSxcclxuICAgICAgICApO1xyXG4gICAgICAgIHJldHVybjtcclxuICAgICAgfVxyXG4gICAgICByZXNvbHZlKFxyXG4gICAgICAgIHdvcmxkLmdldF9hcnRpZmFjdChvcHRpb25zLmZvcm1hdCB8fCBDb21waWxlRm9ybWF0RW51bS52ZWN0b3IsIGdldERpYWdub3N0aWNzQXJnKG9wdGlvbnMuZGlhZ25vc3RpY3MpKSxcclxuICAgICAgKTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgYXN5bmMgcnVuV2l0aFdvcmxkPFQ+KFxyXG4gICAgb3B0aW9uczogU25hcHNob3RPcHRpb25zLFxyXG4gICAgY2I6ICh3b3JsZDogVHlwc3RXb3JsZCkgPT4gUHJvbWlzZTxUPixcclxuICApOiBQcm9taXNlPFQ+IHtcclxuICAgIGNvbnN0IHdvcmxkID0gdGhpcy5jb21waWxlci5zbmFwc2hvdChcclxuICAgICAgb3B0aW9ucy5yb290LFxyXG4gICAgICBvcHRpb25zLm1haW5GaWxlUGF0aCxcclxuICAgICAgY29udmVydElucHV0cyhvcHRpb25zLmlucHV0cyksXHJcbiAgICApO1xyXG4gICAgbGV0IHJlc3VsdCA9IGF3YWl0IGNiKG5ldyBUeXBzdFdvcmxkKHdvcmxkKSk7XHJcbiAgICB3b3JsZC5mcmVlKCk7XHJcbiAgICByZXR1cm4gcmVzdWx0O1xyXG4gIH1cclxuXHJcbiAgcXVlcnkob3B0aW9uczogUXVlcnlPcHRpb25zICYgU25hcHNob3RPcHRpb25zKTogUHJvbWlzZTxhbnk+IHtcclxuICAgIHJldHVybiB0aGlzLnJ1bldpdGhXb3JsZChvcHRpb25zLCBhc3luYyB3b3JsZCA9PiB7XHJcbiAgICAgIHJldHVybiBKU09OLnBhcnNlKGF3YWl0IHdvcmxkLnF1ZXJ5KG9wdGlvbnMpKTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgZ2V0U2VtYW50aWNUb2tlbkxlZ2VuZCgpOiBQcm9taXNlPFNlbWFudGljVG9rZW5zTGVnZW5kPiB7XHJcbiAgICByZXR1cm4gbmV3IFByb21pc2U8U2VtYW50aWNUb2tlbnNMZWdlbmQ+KHJlc29sdmUgPT4ge1xyXG4gICAgICByZXNvbHZlKHRoaXMuY29tcGlsZXIuZ2V0X3NlbWFudGljX3Rva2VuX2xlZ2VuZCgpKTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgZ2V0U2VtYW50aWNUb2tlbnMob3B0czoge1xyXG4gICAgbWFpbkZpbGVQYXRoOiBzdHJpbmc7XHJcbiAgICByZXN1bHRJZD86IHN0cmluZztcclxuICAgIG9mZnNldEVuY29kaW5nPzogc3RyaW5nO1xyXG4gIH0pOiBQcm9taXNlPFNlbWFudGljVG9rZW5zPiB7XHJcbiAgICByZXR1cm4gbmV3IFByb21pc2U8U2VtYW50aWNUb2tlbnM+KHJlc29sdmUgPT4ge1xyXG4gICAgICB0aGlzLmNvbXBpbGVyLnJlc2V0KCk7XHJcbiAgICAgIHJlc29sdmUoXHJcbiAgICAgICAgdGhpcy5jb21waWxlci5nZXRfc2VtYW50aWNfdG9rZW5zKFxyXG4gICAgICAgICAgb3B0cy5vZmZzZXRFbmNvZGluZyB8fCAndXRmLTE2JyxcclxuICAgICAgICAgIG9wdHMubWFpbkZpbGVQYXRoLFxyXG4gICAgICAgICAgb3B0cy5yZXN1bHRJZCxcclxuICAgICAgICApIGFzIGFueSxcclxuICAgICAgKTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgYXN5bmMgd2l0aEluY3JlbWVudGFsU2VydmVyPFQ+KGY6IChzOiBJbmNyZW1lbnRhbFNlcnZlcikgPT4gUHJvbWlzZTxUPik6IFByb21pc2U8VD4ge1xyXG4gICAgY29uc3Qgc3J2ID0gbmV3IEluY3JlbWVudGFsU2VydmVyKHRoaXMuY29tcGlsZXIuY3JlYXRlX2luY3Jfc2VydmVyKCkpO1xyXG4gICAgdHJ5IHtcclxuICAgICAgcmV0dXJuIGF3YWl0IGYoc3J2KTtcclxuICAgIH0gZmluYWxseSB7XHJcbiAgICAgIHNydltrT2JqZWN0XS5mcmVlKCk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBhc3luYyBnZXRBc3QobWFpbkZpbGVQYXRoOiBzdHJpbmcpOiBQcm9taXNlPHN0cmluZz4ge1xyXG4gICAgcmV0dXJuIHRoaXMuY29tcGlsZXIuZ2V0X2FzdChtYWluRmlsZVBhdGgpO1xyXG4gIH1cclxuXHJcbiAgYXN5bmMgcmVzZXQoKTogUHJvbWlzZTx2b2lkPiB7XHJcbiAgICBhd2FpdCBuZXcgUHJvbWlzZTx2b2lkPihyZXNvbHZlID0+IHtcclxuICAgICAgdGhpcy5jb21waWxlci5yZXNldCgpO1xyXG4gICAgICByZXNvbHZlKHVuZGVmaW5lZCk7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIGFkZFNvdXJjZShwYXRoOiBzdHJpbmcsIHNvdXJjZTogc3RyaW5nKTogdm9pZCB7XHJcbiAgICBpZiAoYXJndW1lbnRzLmxlbmd0aCA+IDIpIHtcclxuICAgICAgdGhyb3cgbmV3IEVycm9yKFxyXG4gICAgICAgICd1c2Ugb2YgYWRkU291cmNlKHBhdGgsIHNvdXJjZSwgaXNNYWluKSBpcyBkZXByZWNhdGVkLCBwbGVhc2UgdXNlIGFkZFNvdXJjZShwYXRoLCBzb3VyY2UpIGluc3RlYWQnLFxyXG4gICAgICApO1xyXG4gICAgfVxyXG5cclxuICAgIHRoaXMuY29tcGlsZXIuYWRkX3NvdXJjZShwYXRoLCBzb3VyY2UpO1xyXG4gIH1cclxuXHJcbiAgbWFwU2hhZG93KHBhdGg6IHN0cmluZywgY29udGVudDogVWludDhBcnJheSk6IHZvaWQge1xyXG4gICAgdGhpcy5jb21waWxlci5tYXBfc2hhZG93KHBhdGgsIGNvbnRlbnQpO1xyXG4gIH1cclxuXHJcbiAgdW5tYXBTaGFkb3cocGF0aDogc3RyaW5nKTogdm9pZCB7XHJcbiAgICB0aGlzLmNvbXBpbGVyLnVubWFwX3NoYWRvdyhwYXRoKTtcclxuICB9XHJcblxyXG4gIHJlc2V0U2hhZG93KCk6IHZvaWQge1xyXG4gICAgdGhpcy5jb21waWxlci5yZXNldF9zaGFkb3coKTtcclxuICB9XHJcblxyXG4gIHJlbmRlclBhZ2VUb0NhbnZhcygpOiBQcm9taXNlPGFueT4ge1xyXG4gICAgdGhyb3cgbmV3IEVycm9yKCdQbGVhc2UgdXNlIHRoZSBhcGkgVHlwc3RSZW5kZXJlci5yZW5kZXJUb0NhbnZhcyBpbiB2MC40LjAnKTtcclxuICB9XHJcbn1cclxuY3JlYXRlVHlwc3RDb21waWxlci5faW1wbCA9IFR5cHN0Q29tcGlsZXJEcml2ZXI7XHJcblxyXG4vLyB0b2RvOiBjYWNoaW5nIGlucHV0c1xyXG5mdW5jdGlvbiBjb252ZXJ0SW5wdXRzKGlucHV0cz86IFJlY29yZDxzdHJpbmcsIHN0cmluZz4pOiBbc3RyaW5nLCBzdHJpbmddW10gfCB1bmRlZmluZWQge1xyXG4gIHJldHVybiBpbnB1dHMgPyBPYmplY3QuZW50cmllcyhpbnB1dHMpIDogdW5kZWZpbmVkO1xyXG59XHJcblxyXG5mdW5jdGlvbiBnZXREaWFnbm9zdGljc0FyZyhkaWFnbm9zdGljczogc3RyaW5nIHwgdW5kZWZpbmVkKTogbnVtYmVyIHtcclxuICBzd2l0Y2ggKGRpYWdub3N0aWNzKSB7XHJcbiAgICBjYXNlICdub25lJzpcclxuICAgICAgcmV0dXJuIDE7XHJcbiAgICBjYXNlICd1bml4JzpcclxuICAgICAgcmV0dXJuIDI7XHJcbiAgICBjYXNlICdmdWxsJzpcclxuICAgIGRlZmF1bHQ6XHJcbiAgICAgIHJldHVybiAzO1xyXG4gIH1cclxufVxyXG4iXX0=