/*
THIS IS A GENERATED/BUNDLED FILE BY VITE
if you want to view the source, please visit the github repository https://github.com/Myriad-Dreamin/typst.ts/blob/main/packages/typst.ts
*/
"use strict";var Ir=Object.defineProperty;var Pr=(n,e,t)=>e in n?Ir(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var f=(n,e,t)=>Pr(n,typeof e!="symbol"?e+"":e,t);Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});var _e=typeof document<"u"?document.currentScript:null;const Er=["DejaVuSansMono-Bold.ttf","DejaVuSansMono-BoldOblique.ttf","DejaVuSansMono-Oblique.ttf","DejaVuSansMono.ttf","LibertinusSerif-Bold.otf","LibertinusSerif-BoldItalic.otf","LibertinusSerif-Italic.otf","LibertinusSerif-Regular.otf","LibertinusSerif-Semibold.otf","LibertinusSerif-SemiboldItalic.otf","NewCM10-Bold.otf","NewCM10-BoldItalic.otf","NewCM10-Italic.otf","NewCM10-Regular.otf","NewCMMath-Bold.otf","NewCMMath-Book.otf","NewCMMath-Regular.otf"],Fr=["InriaSerif-Bold.ttf","InriaSerif-BoldItalic.ttf","InriaSerif-Italic.ttf","InriaSerif-Regular.ttf","Roboto-Regular.ttf","NotoSerifCJKsc-Regular.otf"],Ar=["TwitterColorEmoji.ttf","NotoColorEmoji-Regular-COLR.subset.ttf"];function Lr(){return V([],{assets:!1})}function Mr(n){return V([],n)}function Tr(n){var t,r;const e=[];if(n&&(n==null?void 0:n.assets)!==!1&&((t=n==null?void 0:n.assets)!=null&&t.length)&&((r=n==null?void 0:n.assets)==null?void 0:r.length)>0){let i={text:"https://cdn.jsdelivr.net/gh/typst/typst-assets@v0.13.1/files/fonts/",_:"https://cdn.jsdelivr.net/gh/typst/typst-dev-assets@v0.13.1/files/fonts/"},s=n.assetUrlPrefix??i;typeof s=="string"?s={_:s}:s={...i,...s};for(const a of Object.keys(s)){const l=s[a];l[l.length-1]!=="/"&&(s[a]=l+"/")}const o=(a,l)=>l.map(u=>(s[a]||s._)+u);for(const a of n.assets)switch(a){case"text":e.push(...o(a,Er));break;case"cjk":e.push(...o(a,Fr));break;case"emoji":e.push(...o(a,Ar));break}}return e}function Or(n,e){return V(n,e)}function V(n,e){const t=Tr(e),r=async(i,{ref:s,builder:o})=>{e!=null&&e.fetcher&&s.setFetcher(e.fetcher),await s.loadFonts(o,[...n,...t])};return r._preloadRemoteFontOptions=e,r._kind="fontLoader",r}function Ke({byFamily:n}){return async(e,{builder:t})=>{const r=performance.now();if("queryLocalFonts"in window){const s=await window.queryLocalFonts();n=n??[];for(const o of s){if(!n.includes(o.family))continue;const a=await(await o.blob()).arrayBuffer();await t.add_raw_font(new Uint8Array(a))}}const i=performance.now();console.log("preload system font time used:",i-r)}}function Pe(n){return async(e,{builder:t})=>new Promise(r=>{t.set_package_registry(n,function(i){return n.resolve(i,this)}),r()})}function Xe(n){return async(e,t)=>{var r;if(t.alreadySetAccessModel)throw new Error(`already set some assess model before: ${(r=t.alreadySetAccessModel.constructor)==null?void 0:r.name}(${t.alreadySetAccessModel})`);return t.alreadySetAccessModel=n,new Promise(i=>{t.builder.set_access_model(n,s=>{const o=n.getMTime(s);return o?o.getTime():0},s=>n.isFile(s)||!1,s=>n.getRealPath(s)||s,s=>n.readAll(s)),i()})}}let $r=class{constructor(){f(this,"loadedFonts",new Set);f(this,"fetcher",fetch)}setFetcher(e){this.fetcher=e}async loadFonts(e,t){const r=new Function("m","return import(m)"),i=this.fetcher||(this.fetcher=await async function(){const{fetchBuilder:a,FileSystemCache:l}=await r("node-fetch-cache"),u=new l({cacheDirectory:".cache/typst/fonts"}),g=a.withCache(u);return function(w,x){const C=setTimeout(()=>{console.warn("font fetching is stucking:",w)},15e3);return g(w,x).finally(()=>{clearTimeout(C)})}}()),s=t.filter(a=>a instanceof Uint8Array||typeof a=="object"&&"info"in a?!0:this.loadedFonts.has(a)?!1:(this.loadedFonts.add(a),!0)),o=await Promise.all(s.map(async a=>{if(a instanceof Uint8Array){await e.add_raw_font(a);return}if(typeof a=="object"&&"info"in a){await e.add_lazy_font(a,"blob"in a?a.blob:_t(a));return}return new Uint8Array(await(await i(a)).arrayBuffer())}));for(const a of o)a&&await e.add_raw_font(a)}async build(e,t,r){const i={ref:this,builder:t,hooks:r};for(const s of(e==null?void 0:e.beforeBuild)??[])await s(void 0,i);return r.latelyBuild&&r.latelyBuild(i),await t.build()}};async function Kt(n,e,t,r){var i;return await e.init((i=n==null?void 0:n.getModule)==null?void 0:i.call(n)),await new $r().build(n,new t,r)}function _t(n){return()=>{const e=new XMLHttpRequest;return e.overrideMimeType("text/plain; charset=x-user-defined"),e.open("GET",n.url,!1),e.send(null),e.status===200&&(e.response instanceof String||typeof e.response=="string")?Uint8Array.from(e.response,t=>t.charCodeAt(0)):new Uint8Array}}class Xt{constructor(e,t){f(this,"fullyCached");f(this,"mTimes",new Map);f(this,"mRealPaths",new Map);f(this,"mData",new Map);this.root=e,e.endsWith("/")&&(this.root=this.root.slice(0,this.root.length-1)),t!=null&&t.polyfillHeadRequest,this.fullyCached=!!(t!=null&&t.fullyCached)}reset(){this.mTimes.clear(),this.mRealPaths.clear(),this.mData.clear()}resolvePath(e){return this.root+e}insertFile(e,t,r){this.mTimes.set(e,r),this.mData.set(e,t)}removeFile(e){this.mTimes.delete(e),this.mData.delete(e)}async getPreloadScript(){const e=[];e.push("((async () => {"),e.push("const snapshot = {  root: '', mTimes: new Map(),  mRealPaths: new Map(),  mData: [],};"),e.push("const runFetch = async (path) => {"),e.push("  const res = await fetch(snapshot.root + path);"),e.push("  const buffer = await res.arrayBuffer();"),e.push("  return [path, new Uint8Array(buffer)];"),e.push("};"),e.push(`snapshot.root = ${JSON.stringify(this.root)};`),e.push(`snapshot.mTimes = new Map([${[...this.mTimes.entries()].map(([r,i])=>`[${JSON.stringify(r)}, ${(i==null?void 0:i.getTime())||"undefined"}]`).join(", ")}]);`),e.push(`snapshot.mRealPaths = new Map([${[...this.mRealPaths.entries()].map(([r,i])=>`[${JSON.stringify(r)}, ${JSON.stringify(i)}]`).join(", ")}]);`);const t=await Promise.all([...this.mData.entries()].map(async([r,i])=>(r=JSON.stringify(r),i?`runFetch(${r})`:`Promise.resolve([${r}, undefined])`)));return e.push(`snapshot.mData = await Promise.all([${t.join(", ")}]);`),e.push("return snapshot;"),e.push("})())"),e.join(`
`)}getLastModified(e){const t=new XMLHttpRequest;return t.open("HEAD",e,!1),t.send(null),t.status===200?t.getResponseHeader("Last-Modified"):null}getMTimeInternal(e){const t=this.getLastModified(this.resolvePath(e));if(t)return new Date(t)}getMTime(e){if(e.startsWith("/@memory/"))return this.mTimes.has(e)?this.mTimes.get(e):void 0;if(!this.fullyCached)return this.getMTimeInternal(e);if(this.mTimes.has(e))return this.mTimes.get(e);const t=this.getMTimeInternal(e);return this.mTimes.set(e,t),t}isFile(){return!0}getRealPath(e){return e}readAllInternal(e){const t=new XMLHttpRequest;if(t.overrideMimeType("text/plain; charset=x-user-defined"),t.open("GET",this.resolvePath(e),!1),t.send(null),t.status===200&&(t.response instanceof String||typeof t.response=="string"))return Uint8Array.from(t.response,r=>r.charCodeAt(0))}readAll(e){if(e.startsWith("/@memory/"))return this.mData.has(e)?this.mData.get(e):void 0;if(!this.fullyCached)return this.readAllInternal(e);if(this.mData.has(e))return this.mData.get(e);const t=this.readAllInternal(e);return this.mData.set(e,t),t}}class Qe{constructor(){f(this,"mTimes",new Map);f(this,"mData",new Map)}reset(){this.mTimes.clear(),this.mData.clear()}insertFile(e,t,r){this.mTimes.set(e,r),this.mData.set(e,t)}removeFile(e){this.mTimes.delete(e),this.mData.delete(e)}getMTime(e){if(e.startsWith("/@memory/")&&this.mTimes.has(e))return this.mTimes.get(e)}isFile(){return!0}getRealPath(e){return e}readAll(e){if(e.startsWith("/@memory/")&&this.mData.has(e))return this.mData.get(e)}}class Le{constructor(e){f(this,"cache",new Map);this.am=e}resolvePath(e){return`https://packages.typst.org/preview/${e.name}-${e.version}.tar.gz`}pullPackageData(e){const t=new XMLHttpRequest;if(t.overrideMimeType("text/plain; charset=x-user-defined"),t.open("GET",this.resolvePath(e),!1),t.send(null),t.status===200&&(t.response instanceof String||typeof t.response=="string"))return Uint8Array.from(t.response,r=>r.charCodeAt(0))}resolve(e,t){if(e.namespace!=="preview")return;const r=this.resolvePath(e);if(this.cache.has(r))return this.cache.get(r)();const i=this.pullPackageData(e);if(!i)return;const s=`/@memory/fetch/packages/preview/${e.namespace}/${e.name}/${e.version}`,o=[];t.untar(i,(l,u,g)=>{o.push([s+"/"+l,u,new Date(g)])});const a=()=>{for(const[l,u,g]of o)this.am.insertFile(l,u,g);return s};return this.cache.set(r,a),a()}}function Dr(n){return Math.random().toString(36).replace("0.","")}const k=Symbol.for("reflexo-obj");var dt=(n=>(n[n.PIXEL_PER_PT=3]="PIXEL_PER_PT",n))(dt||{});const Br=n=>{let e=!1,t;return()=>e?t:(e=!0,t=n())};let Qt=class{constructor(e){f(this,"wasmBin");f(this,"initOnce");if(typeof e!="function")throw new Error("initFn is not a function");this.initOnce=Br(async()=>{await e(this.wasmBin)})}async init(e){this.wasmBin=e,await this.initOnce()}};var Yt=(n=>(n[n.vector=0]="vector",n[n.pdf=1]="pdf",n[n._dummy=2]="_dummy",n))(Yt||{}),zt;let jr=(zt=k,class{constructor(e){f(this,zt);this[k]=e}reset(){this[k].reset()}current(){return this[k].current()}setAttachDebugInfo(e){this[k].set_attach_debug_info(e)}});function Wr(){return new qr}var qt;let zr=(qt=k,class{constructor(e){f(this,qt);this[k]=e}compile(e){return this[k].compile(0,se(e==null?void 0:e.diagnostics))}compileHtml(e){return this[k].compile(1,se(e==null?void 0:e.diagnostics))}async query(e){return JSON.parse(this[k].query(0,e.selector,e.field))}title(){return this[k].title(0)}vector(e){return this[k].get_artifact(0,se(e==null?void 0:e.diagnostics))||{}}pdf(e){return this[k].get_artifact(1,se(e==null?void 0:e.diagnostics))||{}}});const Zt=n=>new Qt(async e=>await n.default(e));function ut(){return new er}let qr=class{constructor(){f(this,"fontBuilderJs");f(this,"fontBuilder")}async init(e){var t,r;this.fontBuilderJs=await(((t=e==null?void 0:e.getWrapper)==null?void 0:t.call(e))||Promise.resolve().then(()=>We)),await Zt(this.fontBuilderJs).init((r=e==null?void 0:e.getModule)==null?void 0:r.call(e)),this.fontBuilder=new this.fontBuilderJs.TypstFontResolverBuilder}async getFontInfo(e){return this.fontBuilder.get_font_info(e)}async addFontData(e){this.fontBuilder.add_raw_font(e)}async addLazyFont(e,t){return this.fontBuilder.add_lazy_font(e,t)}async build(e){const t=await this.fontBuilder.build(),r=await e(t);return t.free(),r}};var ee;let er=(ee=class{constructor(){f(this,"compiler");f(this,"compilerJs")}async init(e){var u;this.compilerJs=await(((u=e==null?void 0:e.getWrapper)==null?void 0:u.call(e))||Promise.resolve().then(()=>We));const t=this.compilerJs.TypstCompilerBuilder,r={...e||{}},i=r.beforeBuild??(r.beforeBuild=[]),s=i.some(g=>g._preloadRemoteFontOptions!==void 0),o=i.some(g=>{var w;return((w=g._preloadRemoteFontOptions)==null?void 0:w.assets)!==void 0}),a=i.some(g=>{var w;return((w=g._preloadRemoteFontOptions)==null?void 0:w.assets)===!1});if((!s||!o&&!a)&&i.push(V([],{assets:ee.defaultAssets})),!i.some(g=>g._kind==="fontLoader"))throw new Error("TypstCompiler: no font loader found, please use font loaders, e.g. loadFonts or preloadSystemFonts");this.compiler=await Kt(e,Zt(this.compilerJs),t,{})}setFonts(e){this.compiler.set_fonts(e)}compile(e){return new Promise(t=>{const r=this.compiler.snapshot(e.root,e.mainFilePath,gt(e.inputs));if("incrementalServer"in e){t(r.incr_compile(e.incrementalServer[k],se(e.diagnostics)));return}t(r.get_artifact(e.format||0,se(e.diagnostics)))})}async runWithWorld(e,t){const r=this.compiler.snapshot(e.root,e.mainFilePath,gt(e.inputs));let i=await t(new zr(r));return r.free(),i}query(e){return this.runWithWorld(e,async t=>JSON.parse(await t.query(e)))}getSemanticTokenLegend(){return new Promise(e=>{e(this.compiler.get_semantic_token_legend())})}getSemanticTokens(e){return new Promise(t=>{this.compiler.reset(),t(this.compiler.get_semantic_tokens(e.offsetEncoding||"utf-16",e.mainFilePath,e.resultId))})}async withIncrementalServer(e){const t=new jr(this.compiler.create_incr_server());try{return await e(t)}finally{t[k].free()}}async getAst(e){return this.compiler.get_ast(e)}async reset(){await new Promise(e=>{this.compiler.reset(),e(void 0)})}addSource(e,t){if(arguments.length>2)throw new Error("use of addSource(path, source, isMain) is deprecated, please use addSource(path, source) instead");this.compiler.add_source(e,t)}mapShadow(e,t){this.compiler.map_shadow(e,t)}unmapShadow(e){this.compiler.unmap_shadow(e)}resetShadow(){this.compiler.reset_shadow()}renderPageToCanvas(){throw new Error("Please use the api TypstRenderer.renderToCanvas in v0.4.0")}},f(ee,"defaultAssets",["text"]),ee);ut._impl=er;function gt(n){return n?Object.entries(n):void 0}function se(n){switch(n){case"none":return 1;case"unix":return 2;case"full":default:return 3}}const Ur=typeof process<"u"&&process.versions!=null&&process.versions.node!=null;class U{constructor(e){f(this,"mainFilePath");f(this,"cc");f(this,"fr");f(this,"ex");f(this,"providers");f(this,"ccOptions");f(this,"exOptions");f(this,"prepareUseOnce");this.cc=(e==null?void 0:e.compiler)||U.buildLocalCompiler,this.fr=(e==null?void 0:e.fontResolver)||U.buildLocalFontResolver,this.ex=(e==null?void 0:e.renderer)||U.buildLocalRenderer,this.mainFilePath="/main.typ",this.providers=[]}setCompiler(e){this.cc=e}async getFontResolver(){return typeof this.fr=="function"?this.fr=await this.fr():this.fr}async getCompiler(){return typeof this.cc=="function"?this.cc=await this.cc():this.cc}async getCompilerReset(){const e=await this.getCompiler();return await e.reset(),e}setRenderer(e){this.ex=e}async getRenderer(){return typeof this.ex=="function"?this.ex=await this.ex():this.ex}use(...e){if(!this.providers)throw new Error("already prepare uses for instances");this.providers.push(...e)}static preloadFontFromUrl(e){return U.preloadFonts([e])}static preloadFontData(e){return U.preloadFonts([e])}static preloadFonts(e){return{key:"access-model",forRoles:["compiler"],provides:[V(e)]}}static disableDefaultFontAssets(){return{key:"access-model",forRoles:["compiler"],provides:[Lr()]}}static preloadFontAssets(e){return{key:"access-model",forRoles:["compiler"],provides:[Mr(e)]}}static withAccessModel(e){return{key:"access-model",forRoles:["compiler"],provides:[Xe(e)]}}static withPackageRegistry(e){return{key:"package-registry",forRoles:["compiler"],provides:[Pe(e)]}}static fetchPackageRegistry(e){const t=e||new Qe,r=[...e?[]:[Xe(t)],Pe(new Le(t))];return{key:"package-registry$fetch",forRoles:["compiler"],provides:r}}static fetchPackageBy(e,t){class r extends Le{pullPackageData(s){return t(s,this.resolvePath(s))}}return{key:"package-registry$lambda",forRoles:["compiler"],provides:[Pe(new r(e))]}}setCompilerInitOptions(e){this.requireIsUninitialized("compiler",this.cc),this.ccOptions=e}setRendererInitOptions(e){this.requireIsUninitialized("renderer",this.ex),this.exOptions=e}setMainFilePath(e){this.mainFilePath=e}getMainFilePath(){return this.mainFilePath}removeTmp(e){return e.mainFilePath.startsWith("/tmp/")?this.unmapShadow(e.mainFilePath):Promise.resolve()}async setFonts(e){const t=await this.getFontResolver();for(const i of e)await t.addLazyFont(i,"blob"in i?i.blob:_t(i),i);const r=await this.getCompiler();await t.build(async i=>r.setFonts(i))}async addSource(e,t){(await this.getCompiler()).addSource(e,t)}async resetShadow(){(await this.getCompiler()).resetShadow()}async mapShadow(e,t){(await this.getCompiler()).mapShadow(e,t)}async unmapShadow(e){(await this.getCompiler()).unmapShadow(e)}async vector(e){const t=await this.getCompileOptions(e);return(await this.getCompilerReset()).compile(t).then(i=>i.result).finally(()=>this.removeTmp(t))}async pdf(e){const t=await this.getCompileOptions(e);return t.format=Yt.pdf,(await this.getCompilerReset()).compile(t).then(i=>i.result).finally(()=>this.removeTmp(t))}async svg(e){return this.transientRender(e,(t,r)=>t.renderSvg({...e,renderSession:r}))}async canvas(e,t){return this.transientRender(t,(r,i)=>r.renderToCanvas({container:e,...t,renderSession:i}))}async query(e){const t=await this.getCompileOptions(e);return(await this.getCompilerReset()).query({...e,...t}).finally(()=>this.removeTmp(t))}async getSemanticTokenLegend(){return(await this.getCompilerReset()).getSemanticTokenLegend()}async getSemanticTokens(e){const t=await this.getCompileOptions(e);return(await this.getCompilerReset()).getSemanticTokens({mainFilePath:t.mainFilePath,resultId:e.resultId}).finally(()=>this.removeTmp(t))}async getCompileOptions(e){if(e===void 0)return{mainFilePath:this.mainFilePath,diagnostics:"none"};if(typeof e=="string")throw new Error("please specify opts as {mainContent: '...'} or {mainFilePath: '...'}");if("mainFilePath"in e)return{...e,diagnostics:"none"};{const t=`/tmp/${Dr()}.typ`;return await this.addSource(t,e.mainContent),{mainFilePath:t,inputs:e.inputs,diagnostics:"none"}}}async getVector(e){if(e&&"vectorData"in e)return e.vectorData;const t=await this.getCompileOptions(e);return(await this.getCompiler()).compile(t).then(r=>r.result).finally(()=>this.removeTmp(t))}async transientRender(e,t){const r=await this.getRenderer();if(!r)throw new Error("does not provide renderer instance");const i=await this.getVector(e);return await r.runWithSession(async s=>(r.manipulateData({renderSession:s,action:"reset",data:i}),t(r,s)))}async prepareUse(){return this.prepareUseOnce?this.prepareUseOnce:this.prepareUseOnce=this.doPrepareUse()}async doPrepareUse(){if(!this.providers)return;const e=await Promise.all(this.providers.map(a=>typeof a=="function"?a():a));if(this.providers=[],Ce==this&&!e.some(a=>a.key.includes("package-registry")||a.key.includes("access-model")))if(Ur){const a=new Function("m","return import(m)");try{const l=new Qe,{default:u}=await a("sync-request");Ce.use(U.withAccessModel(l),U.fetchPackageBy(l,(g,w)=>{const x=u("GET",w);if(x.statusCode===200)return x.getBody(void 0)}))}catch{}}else Ce.use(U.fetchPackageRegistry());const t=await Promise.all(this.providers.map(a=>typeof a=="function"?a():a)),r=this.ccOptions||(this.ccOptions={}),i=r.beforeBuild||(r.beforeBuild=[]),s=this.exOptions||(this.exOptions={}),o=s.beforeBuild||(s.beforeBuild=[]);for(const a of[...e,...t])a.forRoles.includes("compiler")&&(this.requireIsUninitialized("compiler",this.cc),i.push(...a.provides)),a.forRoles.includes("renderer")&&(this.requireIsUninitialized("renderer",this.ex),o.push(...a.provides));this.providers=void 0}requireIsUninitialized(e,t,r){if(t&&typeof t!="function")throw new Error(`${e} has been initialized: ${t}`)}static async buildLocalCompiler(){const{createTypstCompiler:e}=await Promise.resolve().then(()=>Ne);await this.prepareUse();const t=e();return await t.init(this.ccOptions),t}static async buildLocalFontResolver(){const{createTypstFontBuilder:e}=await Promise.resolve().then(()=>Ne);await this.prepareUse();const t=e();return await t.init(this.ccOptions),t}static async buildGlobalCompiler(){const{createGlobalCompiler:e}=await Promise.resolve().then(()=>In),{createTypstCompiler:t}=await Promise.resolve().then(()=>Ne);return await this.prepareUse(),e(t,this.ccOptions)}static async buildLocalRenderer(){const{createTypstRenderer:e}=await Promise.resolve().then(()=>kt);await this.prepareUse();const t=e();return await t.init(this.exOptions),t}static async buildGlobalRenderer(){const{createGlobalRenderer:e}=await Promise.resolve().then(()=>Bn),{createTypstRenderer:t}=await Promise.resolve().then(()=>kt);return await this.prepareUse(),e(t,this.exOptions)}}const Ce=new U({compiler:U.buildGlobalCompiler,renderer:U.buildGlobalRenderer});let tr=class{constructor(e,t,r){f(this,"loadPageCount");f(this,"imageScaleFactor");f(this,"container");f(this,"canvasList");f(this,"textLayerList");f(this,"commonList");f(this,"textLayerParentList");f(this,"semanticLayerList");this.pageInfos=e,this.imageScaleFactor=r.pixelPerPt??dt.PIXEL_PER_PT,t.innerHTML="",t.style.width="100%",this.container=t,this.canvasList=new Array(this.loadPageCount),this.textLayerList=new Array(this.loadPageCount),this.commonList=new Array(this.loadPageCount),this.textLayerParentList=new Array(this.loadPageCount),this.semanticLayerList=new Array(this.loadPageCount);const i=(s,o,a)=>{const l=Math.ceil(o.width)*this.imageScaleFactor,u=Math.ceil(o.height)*this.imageScaleFactor,g=this.canvasList[s]=document.createElement("canvas"),w=this.semanticLayerList[s]=document.createElement("div"),x=this.textLayerList[s]=document.createElement("div"),C=this.textLayerParentList[s]=document.createElement("div");if(g.getContext("2d")){const A=document.createElement("div");g.width=l,g.height=u,A.appendChild(g),a.appendChild(A),A.style.position="absolute"}{C.appendChild(x),C.className="typst-html-semantics";const A=t.offsetWidth,D=A/o.width;C.style.width=`${A}px`,C.style.height=`${o.height*D}px`,C.style.setProperty("--data-text-width",`${D}px`),C.style.setProperty("--data-text-height",`${D}px`),a.classList.add("typst-page"),a.classList.add("canvas"),a.style.width=`${A}px`,a.style.height=`${u*D}px`,a.style.position="relative",w.appendChild(C),a.appendChild(w)}};for(let s=0;s<this.pageInfos.length;s++){const o=this.pageInfos[s];let a;a=this.commonList[s]=document.createElement("div"),t.appendChild(a),i(s,o,a)}}resetLayout(){for(let e=0;e<this.pageInfos.length;e++){const t=this.pageInfos[e],r=Math.ceil(t.width)*this.imageScaleFactor,i=Math.ceil(t.height)*this.imageScaleFactor,s=this.canvasList[e].parentElement;if(!s)throw new Error(`canvasDiv is null for page ${e}, canvas list length ${this.canvasList.length}`);const o=this.commonList[e],a=this.textLayerParentList[e],l=this.container.offsetWidth,u=l/r;a.style.width=`${l}px`,a.style.height=`${i*u}px`,o.style.width=`${l}px`,o.style.height=`${i*u}px`;const g=this.container.offsetWidth/r;s.style.transformOrigin="0px 0px",s.style.transform=`scale(${g})`}}},Nr=class rr{constructor(e){f(this,"hookedElem");f(this,"kModule");f(this,"opts");f(this,"modes",[]);f(this,"partialRendering",!0);f(this,"renderMode","svg");f(this,"r");f(this,"previewMode",0);f(this,"isContentPreview",!1);f(this,"isMixinOutline",!1);f(this,"backgroundColor","black");f(this,"pageColor","white");f(this,"pixelPerPt",3);f(this,"retrieveDOMState");f(this,"isRendering",!1);f(this,"moduleInitialized",!1);f(this,"patchQueue",[]);f(this,"disposeList",[]);f(this,"canvasRenderCToken");f(this,"currentRealScale",1);f(this,"currentScaleRatio",1);f(this,"vpTimeout");f(this,"sampledRenderTime",0);f(this,"partialRenderPage",0);f(this,"outline");f(this,"cursorPosition");f(this,"cachedDOMState",{width:0,height:0,window:{innerWidth:0,innerHeight:0},boundingRect:{left:0,top:0,right:0}});var t,r;this.hookedElem=e.hookedElem,this.kModule=e.kModule,this.opts=e||{};{const{renderMode:i,previewMode:s,isContentPreview:o,retrieveDOMState:a}=e||{};this.partialRendering=!1,this.renderMode=i??this.renderMode,this.previewMode=s??this.previewMode,this.isContentPreview=o||!1,this.retrieveDOMState=a??(()=>({width:this.hookedElem.offsetWidth,height:this.hookedElem.offsetHeight,window:{innerWidth:window.innerWidth,innerHeight:window.innerHeight},boundingRect:this.hookedElem.getBoundingClientRect()})),this.backgroundColor=getComputedStyle(document.documentElement).getPropertyValue("--typst-preview-background-color")}this.hookedElem.classList.add("hide-scrollbar-x"),(t=this.hookedElem.parentElement)==null||t.classList.add("hide-scrollbar-x"),this.previewMode===1&&(this.hookedElem.classList.add("hide-scrollbar-y"),(r=this.hookedElem.parentElement)==null||r.classList.add("hide-scrollbar-y")),this.installCtrlWheelHandler()}reset(){this.kModule.reset(),this.moduleInitialized=!1}dispose(){const e=this.disposeList;this.disposeList=[],e.forEach(t=>t())}static derive(e,t){return["rescale","rerender","postRender"].reduce((r,i)=>(r[i]=e[`${i}$${t}`].bind(e),console.assert(r[i]!==void 0,`${i}$${t} is undefined`),r),{})}registerMode(e){const t=rr.derive(this,e);this.modes.push([e,t]),e===this.renderMode&&(this.r=t)}installCtrlWheelHandler(){const e=[.1,.2,.3,.4,.5,.6,.7,.8,.9,1,1.1,1.3,1.5,1.7,1.9,2.1,2.4,2.7,3,3.3,3.7,4.1,4.6,5.1,5.7,6.3,7,7.7,8.5,9.4,10],t=r=>{var i,s,o,a;if(r.ctrlKey){r.preventDefault(),this.cachedDOMState=this.retrieveDOMState(),window.onresize!==null&&(window.onresize=null);const l=this.currentScaleRatio;if(r.deltaY<0){if(this.currentScaleRatio>=e.at(-1))return;this.currentScaleRatio=e.filter(C=>C>this.currentScaleRatio).at(0)}else if(r.deltaY>0){if(this.currentScaleRatio<=e.at(0))return;this.currentScaleRatio=e.filter(C=>C<this.currentScaleRatio).at(-1)}else return;const u=this.currentScaleRatio/l,g=r.pageX*(u-1),w=r.pageY*(u-1);Math.abs(this.currentScaleRatio-1)<1e-5?(this.hookedElem.classList.add("hide-scrollbar-x"),(i=this.hookedElem.parentElement)==null||i.classList.add("hide-scrollbar-x"),this.previewMode===1&&(this.hookedElem.classList.add("hide-scrollbar-y"),(s=this.hookedElem.parentElement)==null||s.classList.add("hide-scrollbar-y"))):(this.hookedElem.classList.remove("hide-scrollbar-x"),(o=this.hookedElem.parentElement)==null||o.classList.remove("hide-scrollbar-x"),this.previewMode===1&&(this.hookedElem.classList.remove("hide-scrollbar-y"),(a=this.hookedElem.parentElement)==null||a.classList.remove("hide-scrollbar-y")));const x=this.hookedElem.firstElementChild;if(x){const C=this.getSvgScaleRatio(),O=Number.parseFloat(x.getAttribute("data-height")),A=Math.ceil(O*C);this.hookedElem.style.height=`${A*2}px`}return window.scrollBy(g,w),this.addViewportChange(),!1}};this.renderMode!=="dom"&&(typeof acquireVsCodeApi<"u"?(window.addEventListener("wheel",t,{passive:!1}),this.disposeList.push(()=>{window.removeEventListener("wheel",t)})):(document.body.addEventListener("wheel",t,{passive:!1}),this.disposeList.push(()=>{document.body.removeEventListener("wheel",t)})))}getSvgScaleRatio(){const e=this.hookedElem.firstElementChild;if(!e)return 0;const t=this.cachedDOMState,r=Number.parseFloat(e.getAttribute("data-width")||e.getAttribute("width")||"1"),i=Number.parseFloat(e.getAttribute("data-height")||e.getAttribute("height")||"1");return this.currentRealScale=this.previewMode===1?Math.min(t.width/r,t.height/i):t.width/r,this.currentRealScale*this.currentScaleRatio}processQueue(e){const t=e[0];switch(t){case"new":case"diff-v1":return t==="new"&&this.reset(),this.kModule.manipulateData({action:"merge",data:e[1]}),this.moduleInitialized=!0,!0;case"viewport-change":return this.moduleInitialized?!0:(console.log("viewport-change before initialization"),!1);default:return console.log("svgUpdateEvent",e),!1}}triggerUpdate(){if(this.isRendering)return;this.isRendering=!0;const e=async()=>{if(this.cachedDOMState=this.retrieveDOMState(),this.patchQueue.length===0){this.isRendering=!1,this.postprocessChanges();return}try{let t=performance.now();const r=this.canvasRenderCToken;r&&(await r.cancel(),await r.wait(),this.canvasRenderCToken=void 0,console.log("cancel canvas rendering"));let i=!1;for(;this.patchQueue.length>0;)i=this.processQueue(this.patchQueue.shift())||i;let s=performance.now();i&&(this.r.rescale(),await this.r.rerender(),this.r.rescale());let o=performance.now();const a=(l,u,g)=>`${l} ${(g-u).toFixed(2)} ms`;this.sampledRenderTime=o-t,requestAnimationFrame(e)}catch(t){console.error(t),this.isRendering=!1,this.postprocessChanges()}};requestAnimationFrame(e)}postprocessChanges(){this.r.postRender(),this.previewMode===1&&document.querySelectorAll(".typst-page-number-indicator").forEach(e=>{e.textContent=`${this.kModule.retrievePagesInfo().length}`})}addChangement(e){e[0]==="new"&&this.patchQueue.splice(0,this.patchQueue.length);const t=()=>{this.vpTimeout=void 0,this.patchQueue.push(e),this.triggerUpdate()};this.vpTimeout!==void 0&&clearTimeout(this.vpTimeout),e[0]==="viewport-change"&&this.isRendering?this.vpTimeout=setTimeout(t,this.sampledRenderTime||100):t()}addViewportChange(){this.addChangement(["viewport-change",""])}};function Hr(n){return class{constructor(t){f(this,"impl");f(this,"kModule");if(t.isContentPreview&&(t.renderMode="canvas"),this.kModule=t.kModule,this.impl=new n(t),!this.impl.r)throw new Error(`mode is not supported, ${t==null?void 0:t.renderMode}`);t.isContentPreview&&(this.impl.partialRendering=!0,this.impl.pixelPerPt=1,this.impl.isMixinOutline=!0)}dispose(){this.impl.dispose()}reset(){this.impl.reset()}addChangement(t){this.impl.addChangement(t)}addViewportChange(){this.impl.addViewportChange()}setPageColor(t){this.impl.pageColor=t,this.addViewportChange()}setPartialRendering(t){this.impl.partialRendering=t}setCursor(t,r,i){this.impl.cursorPosition=[t,r,i]}setPartialPageNumber(t){return t<=0||t>this.kModule.retrievePagesInfo().length?!1:(this.impl.partialRenderPage=t-1,this.addViewportChange(),!0)}getPartialPageNumber(){return this.impl.partialRenderPage+1}setOutineData(t){this.impl.outline=t,this.addViewportChange()}}}function Vr(n,...e){return e.reduce((t,r)=>r(t),n)}let Jr=class{constructor(){f(this,"isCancellationRequested",!1);f(this,"_onCancelled");f(this,"_onCancelledResolveResolved");let e,t;this._onCancelled=new Promise(r=>{e=r,t&&t(r)}),this._onCancelledResolveResolved=new Promise(r=>{t=r,e&&r(e)})}async cancel(){await this._onCancelledResolveResolved,this.isCancellationRequested=!0}isCancelRequested(){return this.isCancellationRequested}async consume(){(await this._onCancelledResolveResolved)()}wait(){return this._onCancelled}};const Gr=()=>new Promise(n=>requestAnimationFrame(n));function Kr(n){return class extends n{constructor(...r){super(...r);f(this,"tmpl",document.createElement("template"));f(this,"stub",this.createElement("<stub></stub>"));f(this,"plugin");f(this,"docKernel");f(this,"resourceHeader");f(this,"pages",[]);f(this,"domScale",1);f(this,"track_mode",0);f(this,"current_task");f(this,"viewport");if(this.registerMode("dom"),this.disposeList.push(()=>{this.dispose()}),this.plugin=this.opts.renderer,this.opts.domScale!==void 0){if(this.opts.domScale<=0)throw new Error("domScale must be positive");this.domScale=this.opts.domScale}}dispose(){for(const r of this.pages)r.dispose();this.docKernel&&this.docKernel.free()}createElement(r){return this.tmpl.innerHTML=r,this.tmpl.content.firstElementChild}async mountDom(r){if(this.docKernel)throw new Error("already mounted");this.hookedElem.innerHTML='<svg class="typst-svg-resources" viewBox="0 0 0 0" width="0" height="0" style="opacity: 0; position: absolute;"></svg>',this.resourceHeader=this.hookedElem.querySelector(".typst-svg-resources"),this.docKernel=await this.plugin.renderer.mount_dom(this.kModule[k],this.hookedElem),this.docKernel.bind_functions({populateGlyphs:i=>{let o=this.createElement(i).firstElementChild;this.resourceHeader.append(o)}})}async cancelAnyway$dom(){if(this.current_task){const r=this.current_task;this.current_task=void 0,await r.cancel()}}retrieveDOMPages(){return Array.from(this.hookedElem.querySelectorAll(".typst-dom-page"))}postRender$dom(){}rescale$dom(){}getDomViewport(r,i){const s=i.left,o=-i.top,a=i.right,l=r.innerHeight-i.top,u={x:0,y:o/this.domScale,width:Math.max(a-s,0)/this.domScale,height:Math.max(l-o,0)/this.domScale};return(u.width<=0||u.height<=0)&&(u.x=u.y=u.width=u.height=0),u}async rerender$dom(){const r=this.retrieveDOMState(),{x:i,y:s,width:o,height:a}=this.getDomViewport(r.window,r.boundingRect);if(!await this.docKernel.relayout(i,s,o,a))return;const u=new Jr;this.doRender$dom(u),this.current_task=u}async doRender$dom(r){const i=(l,u)=>{if(l&&!r.isCancelRequested()&&u)return u()},s=this.retrieveDOMPages().map(l=>{const{innerWidth:u,innerHeight:g}=window,w=l.getBoundingClientRect();return{inWindow:!(w.left>u||w.right<0||w.top>g||w.bottom<0),page:l}}),o=async l=>{if(await Gr(),r.isCancelRequested())return;const u=s[l].page,g=u.getBoundingClientRect(),w=this.getDomViewport(window,g),x=B=>this.docKernel.need_repaint(l,w.x,w.y,w.width,w.height,B),C=B=>this.docKernel.repaint(l,w.x,w.y,w.width,w.height,B),O=B=>{if(!r.isCancelRequested())return i(x(B),()=>C(B))};await O(0);const A=(g.width?Number.parseFloat(u.getAttribute("data-width"))/g.width:1)*this.domScale,D=(g.height?Number.parseFloat(u.getAttribute("data-height"))/g.height:1)*this.domScale;w.x*=A,w.y*=D,w.y-=100,w.width*=A,w.height*=D,w.height+=200,await O(1),await O(2),!r.isCancelRequested()&&(x(3)?(async()=>{if(await C(3),!r.isCancelRequested())return O(4)})():await O(4))},a=async l=>{for(let u=0;u<s.length;++u){if(r.isCancelRequested())return;s[u].inWindow===l&&await o(u)}};this.cancelAnyway$dom(),await a(!0),await a(!1),r.isCancelRequested()}}}let Xr=class extends Hr(Vr(Nr,Kr)){};var Ut;let ze=(Ut=k,class{constructor(e,t){f(this,Ut);this.plugin=e,this[k]=t}set backgroundColor(e){e!==void 0&&(this[k].background_color=e)}get backgroundColor(){return this[k].background_color}set pixelPerPt(e){e!==void 0&&(this[k].pixel_per_pt=e)}get pixelPerPt(){return this[k].pixel_per_pt}reset(){this.plugin.resetSession(this)}get doc_width(){return this[k].doc_width}get docWidth(){return this[k].doc_width}get doc_height(){return this[k].doc_height}get docHeight(){return this[k].doc_height}retrievePagesInfo(){const e=this[k].pages_info,t=[],r=e.page_count;for(let i=0;i<r;i++){const s=e.page(i);t.push({pageOffset:s.page_off,width:s.width_pt,height:s.height_pt})}return t}getSourceLoc(e){return this[k].source_span(e)}renderSvg(e){return this.plugin.renderSvg({renderSession:this,...e})}renderToSvg(e){return this.plugin.renderToSvg({renderSession:this,...e})}renderCanvas(e){return this.plugin.renderCanvas({renderSession:this,...e})}manipulateData(e){this.plugin.manipulateData({renderSession:this,...e})}renderSvgDiff(e){return this.plugin.renderSvgDiff({renderSession:this,...e})}get_source_loc(e){return this[k].source_span(e)}render_in_window(e,t,r,i){return this[k].render_in_window(e,t,r,i)}merge_delta(e){this.plugin.manipulateData({renderSession:this,action:"merge",data:e})}});var Nt;let Qr=(Nt=k,class{constructor(e,t){f(this,Nt);f(this,"managedCanvasElemList",new Map);f(this,"canvasCounter",Math.random());this.plugin=e,this[k]=t}manipulateData(e,t){return this[k].manipulate_data(e,t)}renderCanvas(e){const t=this.managedCanvasElemList;for(const[a,l]of t)l[0]=0;for(const a of e){const l=a.canvas;let u=l.dataset.manageId,g=2;u||(u=this.canvasCounter.toFixed(5),this.canvasCounter+=1,l.dataset.manageId=u,g=1);let w=t.get(u);if(w&&w[0]!==0)throw new Error("cannot update a canvas for two times in batch");t.set(u,[g,{...a}])}const r=Array.from(t.entries()),i=new Uint8Array(r.length),s=new Array(r.length),o=r.map(([a,[l,u]],g)=>(l||t.delete(a),i[g]=l,s[g]=u.canvas,this.plugin.canvasOptionsToRust(u)));return this[k].render_canvas(i,s,o)}async retrievePagesInfo(){const e=await this[k].get_pages_info();console.log(e);const t=[],r=e.page_count;for(let i=0;i<r;i++){const s=e.page(i);t.push({pageOffset:s.page_off,width:s.width_pt,height:s.height_pt})}return t}});const Yr=n=>new Qt(async e=>await n.default(e));function Ye(){return new en}async function Zr(){return(await Promise.resolve().then(()=>ft)).renderer_build_info()}let wt=!0,en=class{constructor(){f(this,"renderer");f(this,"rendererJs")}async init(e){var r;this.rendererJs=await(((r=e==null?void 0:e.getWrapper)==null?void 0:r.call(e))||Promise.resolve().then(()=>ft));const t=this.rendererJs.TypstRendererBuilder;this.renderer=await Kt(e,Yr(this.rendererJs),t,{})}loadGlyphPack(e){return Promise.resolve()}createOptionsToRust(e){const t=new this.rendererJs.CreateSessionOptions;return e.format!==void 0&&(t.format=e.format),e.artifactContent!==void 0&&(t.artifact_content=e.artifactContent),t}canvasOptionsToRust(e){const t=new this.rendererJs.RenderPageImageOptions;if(e.pageOffset===void 0)throw new Error("pageOffset is required in reflexo v0.5.0");if(t.page_off=e.pageOffset,e.cacheKey!==void 0&&(t.cache_key=e.cacheKey),e.backgroundColor!==void 0&&(t.background_color=e.backgroundColor),e.pixelPerPt!==void 0&&(t.pixel_per_pt=e.pixelPerPt),e.dataSelection!==void 0){let r=0;e.dataSelection.body?r|=1:e.canvas&&wt&&(wt=!1,console.warn("dataSelection.body is not set but providing canvas for body")),(e.dataSelection.text||e.dataSelection.annotation)&&console.error("dataSelection.text and dataSelection.annotation are deprecated"),e.dataSelection.semantics&&(r|=8),t.data_selection=r}return t}retrievePagesInfoFromSession(e){return e.retrievePagesInfo()}renderCanvas(e){return this.withinOptionSession(e,async t=>this.renderer.render_page_to_canvas(t[k],e.canvas||void 0,this.canvasOptionsToRust(e)))}async inAnimationFrame(e){return new Promise((t,r)=>{requestAnimationFrame(()=>{try{t(e())}catch(i){r(i)}})})}async renderDisplayLayer(e,t,r){const s=e[k].pages_info.page_count,o=async(g,w)=>{const C=t[g].getContext("2d");if(!C)throw new Error("canvas context is null");return await this.renderCanvas({...r,canvas:C,renderSession:e,pageOffset:w})},a=performance.now(),l=await(async()=>{const g=[];for(let w=0;w<s;w++)g.push(await this.inAnimationFrame(()=>o(w,w)));return g})(),u=performance.now();return console.log(`display layer used: render = ${(u-a).toFixed(1)}ms`),l}renderTextLayer(e,t){const r=performance.now();e.forEach((s,o)=>{s.innerHTML=t[o].htmlSemantics[0]});const i=performance.now();console.log(`text layer used: render = ${(i-r).toFixed(1)}ms`)}async render(e){if("format"in e&&e.format!=="vector"&&["serde_json","js","ir"].includes(e.format))throw new Error(`deprecated format ${e.format}, please use vector format`);return this.renderToCanvas(e)}async renderDom(e){if("format"in e&&e.format!=="vector"&&["serde_json","js","ir"].includes(e.format))throw new Error(`deprecated format ${e.format}, please use vector format`);return this.withinOptionSession(e,async t=>{const r=new Xr({...e,renderMode:"dom",hookedElem:e.container,kModule:t,renderer:this});return await r.impl.mountDom(e.pixelPerPt),r})}async renderToCanvas(e){let t,r;const i=e.container;i.style.visibility="hidden";const s=async(o,a)=>{try{r=await this.renderDisplayLayer(t,o,e),a()}finally{i.style.visibility="visible"}};return this.withinOptionSession(e,async o=>{if(t=o,t[k].pages_info.page_count===0)throw new Error("No page found in session");if(e.pixelPerPt!==void 0&&e.pixelPerPt<=0)throw new Error("Invalid typst.RenderOptions.pixelPerPt, should be a positive number "+e.pixelPerPt);let a=e.backgroundColor;if(a!==void 0&&!/^#[0-9a-f]{6}$/.test(a))throw new Error("Invalid typst.backgroundColor color for matching ^#?[0-9a-f]{6}$ "+a);t.pixelPerPt=e.pixelPerPt??dt.PIXEL_PER_PT,t.backgroundColor=a??"#ffffff";const l=performance.now(),u=new tr(this.retrievePagesInfoFromSession(t),i,e),g=performance.now();console.log(`layer used: retrieve = ${(g-l).toFixed(1)}ms`),await s(u.canvasList,()=>u.resetLayout()),this.renderTextLayer(u.textLayerList,r)})}createModule(e){return Promise.resolve(new ze(this,this.renderer.create_session(e&&this.createOptionsToRust({format:"vector",artifactContent:e}))))}async createWorkerV0(e){return new Qr(this,await this.renderer.create_worker(e))}workerBridge(){return this.renderer.create_worker_bridge()}renderSvg(e,t){if(e instanceof ze||t)throw new Error("removed api, please use renderToSvg({ renderSession, container }) instead");return this.withinOptionSession(e,async r=>{let i;return e.data_selection&&(i=0,e.data_selection.body&&(i|=1),e.data_selection.defs&&(i|=2),e.data_selection.css&&(i|=4),e.data_selection.js&&(i|=8)),Promise.resolve(this.renderer.svg_data(r[k],i))})}renderSvgDiff(e){return e.window?this.renderer.render_svg_diff(e.renderSession[k],e.window.lo.x,e.window.lo.y,e.window.hi.x,e.window.hi.y):this.renderer.render_svg_diff(e.renderSession[k],0,0,1e33,1e33)}renderToSvg(e){return this.withinOptionSession(e,async t=>Promise.resolve(this.renderer.render_svg(t[k],e.container)))}getCustomV1(e){return Promise.resolve(this.renderer.get_customs(e.renderSession[k]))}resetSession(e){return this.renderer.reset(e[k])}manipulateData(e){return this.renderer.manipulate_data(e.renderSession[k],e.action??"reset",e.data)}withinOptionSession(e,t){function r(i){return"artifactContent"in i}if("renderSession"in e)return t(e.renderSession);if(r(e))return this.runWithSession(e,t);throw new Error("Invalid render options, should be one of RenderByContentOptions|RenderBySessionOptions")}async runWithSession(e,t){let r=e,i=t;t||(r=void 0,i=e);const s=this.renderer.create_session(r&&this.createOptionsToRust(r));try{const o=await i(new ze(this,s));return s.free(),o}catch(o){throw s.free(),o}}};typeof window<"u"&&(window.TypstRenderModule={RenderView:tr,createTypstRenderer:Ye,createTypstSvgRenderer:Ye,preloadRemoteFonts:V,loadFonts:V,preloadSystemFonts:Ke},window.TypstCompileModule={createTypstCompiler:ut,createTypstFontBuilder:Wr,preloadRemoteFonts:V,loadFonts:V,loadFontSync:_t,preloadSystemFonts:Ke,FetchAccessModel:Xt,MemoryAccessModel:Qe,FetchPackageRegistry:Le,withAccessModel:Xe,withPackageRegistry:Pe});window.$typst=Ce;window.TypstSnippet=U;let _,me=null;function de(){return(me===null||me.byteLength===0)&&(me=new Uint8Array(_.memory.buffer)),me}let Ee=new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0});Ee.decode();const tn=2146435072;let qe=0;function rn(n,e){return qe+=e,qe>=tn&&(Ee=new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}),Ee.decode(),qe=e),Ee.decode(de().subarray(n,n+e))}function N(n,e){return n=n>>>0,rn(n,e)}let G=new Array(128).fill(void 0);G.push(void 0,null,!0,!1);let Re=G.length;function S(n){Re===G.length&&G.push(G.length+1);const e=Re;return Re=G[e],G[e]=n,e}function y(n){return G[n]}function ie(n,e){try{return n.apply(this,e)}catch(t){_.__wbindgen_export_0(S(t))}}function Ze(n,e){return n=n>>>0,de().subarray(n/1,n/1+e)}let ye=null;function nn(){return(ye===null||ye.byteLength===0)&&(ye=new Uint32Array(_.memory.buffer)),ye}function sn(n,e){return n=n>>>0,nn().subarray(n/4,n/4+e)}function on(n){n<132||(G[n]=Re,Re=n)}function R(n){const e=y(n);return on(n),e}let F=0;const xe=new TextEncoder;"encodeInto"in xe||(xe.encodeInto=function(n,e){const t=xe.encode(n);return e.set(t),{read:n.length,written:t.length}});function $(n,e,t){if(t===void 0){const a=xe.encode(n),l=e(a.length,1)>>>0;return de().subarray(l,l+a.length).set(a),F=a.length,l}let r=n.length,i=e(r,1)>>>0;const s=de();let o=0;for(;o<r;o++){const a=n.charCodeAt(o);if(a>127)break;s[i+o]=a}if(o!==r){o!==0&&(n=n.slice(o)),i=t(i,r,r=o+n.length*3,1)>>>0;const a=de().subarray(i+o,i+r),l=xe.encodeInto(n,a);o+=l.written,i=t(i,r,o,1)>>>0}return F=o,i}let Y=null;function p(){return(Y===null||Y.buffer.detached===!0||Y.buffer.detached===void 0&&Y.buffer!==_.memory.buffer)&&(Y=new DataView(_.memory.buffer)),Y}function j(n){return n==null}function et(n){const e=typeof n;if(e=="number"||e=="boolean"||n==null)return`${n}`;if(e=="string")return`"${n}"`;if(e=="symbol"){const i=n.description;return i==null?"Symbol":`Symbol(${i})`}if(e=="function"){const i=n.name;return typeof i=="string"&&i.length>0?`Function(${i})`:"Function"}if(Array.isArray(n)){const i=n.length;let s="[";i>0&&(s+=et(n[0]));for(let o=1;o<i;o++)s+=", "+et(n[o]);return s+="]",s}const t=/\[object ([^\]]+)\]/.exec(toString.call(n));let r;if(t&&t.length>1)r=t[1];else return toString.call(n);if(r=="Object")try{return"Object("+JSON.stringify(n)+")"}catch{return"Object"}return n instanceof Error?`${n.name}: ${n.message}
${n.stack}`:r}const ht=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(n=>{_.__wbindgen_export_4.get(n.dtor)(n.a,n.b)});function an(n,e,t,r){const i={a:n,b:e,cnt:1,dtor:t},s=(...o)=>{i.cnt++;const a=i.a;i.a=0;try{return r(a,i.b,...o)}finally{--i.cnt===0?(_.__wbindgen_export_4.get(i.dtor)(a,i.b),ht.unregister(i)):i.a=a}};return s.original=i,ht.register(s,i,i),s}function cn(n){const e=_.get_font_info(S(n));return R(e)}function tt(n,e){if(!(n instanceof e))throw new Error(`expected instance of ${e.name}`)}function nr(n,e){const t=e(n.length*1,1)>>>0;return de().set(n,t/1),F=n.length,t}function _n(n,e){n=n>>>0;const t=p(),r=[];for(let i=n;i<n+4*e;i+=4)r.push(R(t.getUint32(i,!0)));return r}function Ie(n,e){const t=e(n.length*4,4)>>>0,r=p();for(let i=0;i<n.length;i++)r.setUint32(t+4*i,S(n[i]),!0);return F=n.length,t}function dn(n,e,t){_.__wbindgen_export_5(n,e,S(t))}function un(n,e,t,r){_.__wbindgen_export_6(n,e,S(t),S(r))}const pt=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(n=>_.__wbg_incrserver_free(n>>>0,1));class Q{static __wrap(e){e=e>>>0;const t=Object.create(Q.prototype);return t.__wbg_ptr=e,pt.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,pt.unregister(this),e}free(){const e=this.__destroy_into_raw();_.__wbg_incrserver_free(e,0)}set_attach_debug_info(e){_.incrserver_set_attach_debug_info(this.__wbg_ptr,e)}current(){try{const r=_.__wbindgen_add_to_stack_pointer(-16);_.incrserver_current(r,this.__wbg_ptr);var e=p().getInt32(r+0,!0),t=p().getInt32(r+4,!0);let i;return e!==0&&(i=Ze(e,t).slice(),_.__wbindgen_export_1(e,t*1,1)),i}finally{_.__wbindgen_add_to_stack_pointer(16)}}reset(){_.incrserver_reset(this.__wbg_ptr)}}Symbol.dispose&&(Q.prototype[Symbol.dispose]=Q.prototype.free);const Ue=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(n=>_.__wbg_proxycontext_free(n>>>0,1));class le{static __wrap(e){e=e>>>0;const t=Object.create(le.prototype);return t.__wbg_ptr=e,Ue.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Ue.unregister(this),e}free(){const e=this.__destroy_into_raw();_.__wbg_proxycontext_free(e,0)}constructor(e){const t=_.proxycontext_new(S(e));return this.__wbg_ptr=t>>>0,Ue.register(this,this.__wbg_ptr,this),this}get context(){const e=_.proxycontext_context(this.__wbg_ptr);return R(e)}untar(e,t){try{const s=_.__wbindgen_add_to_stack_pointer(-16),o=nr(e,_.__wbindgen_export_2),a=F;_.proxycontext_untar(s,this.__wbg_ptr,o,a,S(t));var r=p().getInt32(s+0,!0),i=p().getInt32(s+4,!0);if(i)throw R(r)}finally{_.__wbindgen_add_to_stack_pointer(16)}}}Symbol.dispose&&(le.prototype[Symbol.dispose]=le.prototype.free);const bt=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(n=>_.__wbg_typstcompileworld_free(n>>>0,1));class fe{static __wrap(e){e=e>>>0;const t=Object.create(fe.prototype);return t.__wbg_ptr=e,bt.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,bt.unregister(this),e}free(){const e=this.__destroy_into_raw();_.__wbg_typstcompileworld_free(e,0)}compile(e,t){try{const o=_.__wbindgen_add_to_stack_pointer(-16);_.typstcompileworld_compile(o,this.__wbg_ptr,e,t);var r=p().getInt32(o+0,!0),i=p().getInt32(o+4,!0),s=p().getInt32(o+8,!0);if(s)throw R(i);return R(r)}finally{_.__wbindgen_add_to_stack_pointer(16)}}title(e){try{const o=_.__wbindgen_add_to_stack_pointer(-16);_.typstcompileworld_title(o,this.__wbg_ptr,e);var t=p().getInt32(o+0,!0),r=p().getInt32(o+4,!0),i=p().getInt32(o+8,!0),s=p().getInt32(o+12,!0);if(s)throw R(i);let a;return t!==0&&(a=N(t,r).slice(),_.__wbindgen_export_1(t,r*1,1)),a}finally{_.__wbindgen_add_to_stack_pointer(16)}}get_artifact(e,t){try{const o=_.__wbindgen_add_to_stack_pointer(-16);_.typstcompileworld_get_artifact(o,this.__wbg_ptr,e,t);var r=p().getInt32(o+0,!0),i=p().getInt32(o+4,!0),s=p().getInt32(o+8,!0);if(s)throw R(i);return R(r)}finally{_.__wbindgen_add_to_stack_pointer(16)}}query(e,t,r){let i,s;try{const O=_.__wbindgen_add_to_stack_pointer(-16),A=$(t,_.__wbindgen_export_2,_.__wbindgen_export_3),D=F;var o=j(r)?0:$(r,_.__wbindgen_export_2,_.__wbindgen_export_3),a=F;_.typstcompileworld_query(O,this.__wbg_ptr,e,A,D,o,a);var l=p().getInt32(O+0,!0),u=p().getInt32(O+4,!0),g=p().getInt32(O+8,!0),w=p().getInt32(O+12,!0),x=l,C=u;if(w)throw x=0,C=0,R(g);return i=x,s=C,N(x,C)}finally{_.__wbindgen_add_to_stack_pointer(16),_.__wbindgen_export_1(i,s,1)}}incr_compile(e,t){try{const o=_.__wbindgen_add_to_stack_pointer(-16);tt(e,Q),_.typstcompileworld_incr_compile(o,this.__wbg_ptr,e.__wbg_ptr,t);var r=p().getInt32(o+0,!0),i=p().getInt32(o+4,!0),s=p().getInt32(o+8,!0);if(s)throw R(i);return R(r)}finally{_.__wbindgen_add_to_stack_pointer(16)}}}Symbol.dispose&&(fe.prototype[Symbol.dispose]=fe.prototype.free);const mt=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(n=>_.__wbg_typstcompiler_free(n>>>0,1));class ge{static __wrap(e){e=e>>>0;const t=Object.create(ge.prototype);return t.__wbg_ptr=e,mt.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,mt.unregister(this),e}free(){const e=this.__destroy_into_raw();_.__wbg_typstcompiler_free(e,0)}reset(){try{const r=_.__wbindgen_add_to_stack_pointer(-16);_.typstcompiler_reset(r,this.__wbg_ptr);var e=p().getInt32(r+0,!0),t=p().getInt32(r+4,!0);if(t)throw R(e)}finally{_.__wbindgen_add_to_stack_pointer(16)}}set_fonts(e){try{const i=_.__wbindgen_add_to_stack_pointer(-16);tt(e,te),_.typstcompiler_set_fonts(i,this.__wbg_ptr,e.__wbg_ptr);var t=p().getInt32(i+0,!0),r=p().getInt32(i+4,!0);if(r)throw R(t)}finally{_.__wbindgen_add_to_stack_pointer(16)}}set_inputs(e){try{const i=_.__wbindgen_add_to_stack_pointer(-16);_.typstcompiler_set_inputs(i,this.__wbg_ptr,S(e));var t=p().getInt32(i+0,!0),r=p().getInt32(i+4,!0);if(r)throw R(t)}finally{_.__wbindgen_add_to_stack_pointer(16)}}add_source(e,t){const r=$(e,_.__wbindgen_export_2,_.__wbindgen_export_3),i=F,s=$(t,_.__wbindgen_export_2,_.__wbindgen_export_3),o=F;return _.typstcompiler_add_source(this.__wbg_ptr,r,i,s,o)!==0}map_shadow(e,t){const r=$(e,_.__wbindgen_export_2,_.__wbindgen_export_3),i=F,s=nr(t,_.__wbindgen_export_2),o=F;return _.typstcompiler_map_shadow(this.__wbg_ptr,r,i,s,o)!==0}unmap_shadow(e){const t=$(e,_.__wbindgen_export_2,_.__wbindgen_export_3),r=F;return _.typstcompiler_unmap_shadow(this.__wbg_ptr,t,r)!==0}reset_shadow(){_.typstcompiler_reset_shadow(this.__wbg_ptr)}get_loaded_fonts(){try{const i=_.__wbindgen_add_to_stack_pointer(-16);_.typstcompiler_get_loaded_fonts(i,this.__wbg_ptr);var e=p().getInt32(i+0,!0),t=p().getInt32(i+4,!0),r=_n(e,t).slice();return _.__wbindgen_export_1(e,t*4,4),r}finally{_.__wbindgen_add_to_stack_pointer(16)}}get_ast(e){let t,r;try{const g=_.__wbindgen_add_to_stack_pointer(-16),w=$(e,_.__wbindgen_export_2,_.__wbindgen_export_3),x=F;_.typstcompiler_get_ast(g,this.__wbg_ptr,w,x);var i=p().getInt32(g+0,!0),s=p().getInt32(g+4,!0),o=p().getInt32(g+8,!0),a=p().getInt32(g+12,!0),l=i,u=s;if(a)throw l=0,u=0,R(o);return t=l,r=u,N(l,u)}finally{_.__wbindgen_add_to_stack_pointer(16),_.__wbindgen_export_1(t,r,1)}}get_semantic_token_legend(){try{const i=_.__wbindgen_add_to_stack_pointer(-16);_.typstcompiler_get_semantic_token_legend(i,this.__wbg_ptr);var e=p().getInt32(i+0,!0),t=p().getInt32(i+4,!0),r=p().getInt32(i+8,!0);if(r)throw R(t);return R(e)}finally{_.__wbindgen_add_to_stack_pointer(16)}}get_semantic_tokens(e,t,r){try{const w=_.__wbindgen_add_to_stack_pointer(-16),x=$(e,_.__wbindgen_export_2,_.__wbindgen_export_3),C=F;var i=j(t)?0:$(t,_.__wbindgen_export_2,_.__wbindgen_export_3),s=F,o=j(r)?0:$(r,_.__wbindgen_export_2,_.__wbindgen_export_3),a=F;_.typstcompiler_get_semantic_tokens(w,this.__wbg_ptr,x,C,i,s,o,a);var l=p().getInt32(w+0,!0),u=p().getInt32(w+4,!0),g=p().getInt32(w+8,!0);if(g)throw R(u);return R(l)}finally{_.__wbindgen_add_to_stack_pointer(16)}}snapshot(e,t,r){try{const C=_.__wbindgen_add_to_stack_pointer(-16);var i=j(e)?0:$(e,_.__wbindgen_export_2,_.__wbindgen_export_3),s=F,o=j(t)?0:$(t,_.__wbindgen_export_2,_.__wbindgen_export_3),a=F,l=j(r)?0:Ie(r,_.__wbindgen_export_2),u=F;_.typstcompiler_snapshot(C,this.__wbg_ptr,i,s,o,a,l,u);var g=p().getInt32(C+0,!0),w=p().getInt32(C+4,!0),x=p().getInt32(C+8,!0);if(x)throw R(w);return fe.__wrap(g)}finally{_.__wbindgen_add_to_stack_pointer(16)}}get_artifact(e,t){try{const o=_.__wbindgen_add_to_stack_pointer(-16),a=$(e,_.__wbindgen_export_2,_.__wbindgen_export_3),l=F;_.typstcompiler_get_artifact(o,this.__wbg_ptr,a,l,t);var r=p().getInt32(o+0,!0),i=p().getInt32(o+4,!0),s=p().getInt32(o+8,!0);if(s)throw R(i);return R(r)}finally{_.__wbindgen_add_to_stack_pointer(16)}}compile(e,t,r,i){try{const x=_.__wbindgen_add_to_stack_pointer(-16);var s=j(e)?0:$(e,_.__wbindgen_export_2,_.__wbindgen_export_3),o=F,a=j(t)?0:Ie(t,_.__wbindgen_export_2),l=F;const C=$(r,_.__wbindgen_export_2,_.__wbindgen_export_3),O=F;_.typstcompiler_compile(x,this.__wbg_ptr,s,o,a,l,C,O,i);var u=p().getInt32(x+0,!0),g=p().getInt32(x+4,!0),w=p().getInt32(x+8,!0);if(w)throw R(g);return R(u)}finally{_.__wbindgen_add_to_stack_pointer(16)}}query(e,t,r,i){let s,o;try{const B=_.__wbindgen_add_to_stack_pointer(-16),Cr=$(e,_.__wbindgen_export_2,_.__wbindgen_export_3),Rr=F;var a=j(t)?0:Ie(t,_.__wbindgen_export_2),l=F;const xr=$(r,_.__wbindgen_export_2,_.__wbindgen_export_3),kr=F;var u=j(i)?0:$(i,_.__wbindgen_export_2,_.__wbindgen_export_3),g=F;_.typstcompiler_query(B,this.__wbg_ptr,Cr,Rr,a,l,xr,kr,u,g);var w=p().getInt32(B+0,!0),x=p().getInt32(B+4,!0),C=p().getInt32(B+8,!0),O=p().getInt32(B+12,!0),A=w,D=x;if(O)throw A=0,D=0,R(C);return s=A,o=D,N(A,D)}finally{_.__wbindgen_add_to_stack_pointer(16),_.__wbindgen_export_1(s,o,1)}}create_incr_server(){try{const i=_.__wbindgen_add_to_stack_pointer(-16);_.typstcompiler_create_incr_server(i,this.__wbg_ptr);var e=p().getInt32(i+0,!0),t=p().getInt32(i+4,!0),r=p().getInt32(i+8,!0);if(r)throw R(t);return Q.__wrap(e)}finally{_.__wbindgen_add_to_stack_pointer(16)}}incr_compile(e,t,r,i){try{const g=_.__wbindgen_add_to_stack_pointer(-16),w=$(e,_.__wbindgen_export_2,_.__wbindgen_export_3),x=F;var s=j(t)?0:Ie(t,_.__wbindgen_export_2),o=F;tt(r,Q),_.typstcompiler_incr_compile(g,this.__wbg_ptr,w,x,s,o,r.__wbg_ptr,i);var a=p().getInt32(g+0,!0),l=p().getInt32(g+4,!0),u=p().getInt32(g+8,!0);if(u)throw R(l);return R(a)}finally{_.__wbindgen_add_to_stack_pointer(16)}}}Symbol.dispose&&(ge.prototype[Symbol.dispose]=ge.prototype.free);const yt=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(n=>_.__wbg_typstcompilerbuilder_free(n>>>0,1));class rt{__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,yt.unregister(this),e}free(){const e=this.__destroy_into_raw();_.__wbg_typstcompilerbuilder_free(e,0)}constructor(){try{const i=_.__wbindgen_add_to_stack_pointer(-16);_.typstcompilerbuilder_new(i);var e=p().getInt32(i+0,!0),t=p().getInt32(i+4,!0),r=p().getInt32(i+8,!0);if(r)throw R(t);return this.__wbg_ptr=e>>>0,yt.register(this,this.__wbg_ptr,this),this}finally{_.__wbindgen_add_to_stack_pointer(16)}}set_dummy_access_model(){try{const r=_.__wbindgen_add_to_stack_pointer(-16);_.typstcompilerbuilder_set_dummy_access_model(r,this.__wbg_ptr);var e=p().getInt32(r+0,!0),t=p().getInt32(r+4,!0);if(t)throw R(e)}finally{_.__wbindgen_add_to_stack_pointer(16)}}set_access_model(e,t,r,i,s){const o=_.typstcompilerbuilder_set_access_model(this.__wbg_ptr,S(e),S(t),S(r),S(i),S(s));return R(o)}set_package_registry(e,t){const r=_.typstcompilerbuilder_set_package_registry(this.__wbg_ptr,S(e),S(t));return R(r)}add_raw_font(e){const t=_.typstcompilerbuilder_add_raw_font(this.__wbg_ptr,S(e));return R(t)}add_lazy_font(e,t){const r=_.typstcompilerbuilder_add_lazy_font(this.__wbg_ptr,S(e),S(t));return R(r)}build(){const e=this.__destroy_into_raw(),t=_.typstcompilerbuilder_build(e);return R(t)}}Symbol.dispose&&(rt.prototype[Symbol.dispose]=rt.prototype.free);const vt=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(n=>_.__wbg_typstfontresolver_free(n>>>0,1));class te{static __wrap(e){e=e>>>0;const t=Object.create(te.prototype);return t.__wbg_ptr=e,vt.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,vt.unregister(this),e}free(){const e=this.__destroy_into_raw();_.__wbg_typstfontresolver_free(e,0)}}Symbol.dispose&&(te.prototype[Symbol.dispose]=te.prototype.free);const St=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(n=>_.__wbg_typstfontresolverbuilder_free(n>>>0,1));class nt{__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,St.unregister(this),e}free(){const e=this.__destroy_into_raw();_.__wbg_typstfontresolverbuilder_free(e,0)}constructor(){try{const i=_.__wbindgen_add_to_stack_pointer(-16);_.typstfontresolverbuilder_new(i);var e=p().getInt32(i+0,!0),t=p().getInt32(i+4,!0),r=p().getInt32(i+8,!0);if(r)throw R(t);return this.__wbg_ptr=e>>>0,St.register(this,this.__wbg_ptr,this),this}finally{_.__wbindgen_add_to_stack_pointer(16)}}get_font_info(e){try{const s=_.__wbindgen_add_to_stack_pointer(-16);_.typstfontresolverbuilder_get_font_info(s,this.__wbg_ptr,S(e));var t=p().getInt32(s+0,!0),r=p().getInt32(s+4,!0),i=p().getInt32(s+8,!0);if(i)throw R(r);return R(t)}finally{_.__wbindgen_add_to_stack_pointer(16)}}add_raw_font(e){try{const i=_.__wbindgen_add_to_stack_pointer(-16);_.typstfontresolverbuilder_add_raw_font(i,this.__wbg_ptr,S(e));var t=p().getInt32(i+0,!0),r=p().getInt32(i+4,!0);if(r)throw R(t)}finally{_.__wbindgen_add_to_stack_pointer(16)}}add_lazy_font(e,t){try{const s=_.__wbindgen_add_to_stack_pointer(-16);_.typstfontresolverbuilder_add_lazy_font(s,this.__wbg_ptr,S(e),S(t));var r=p().getInt32(s+0,!0),i=p().getInt32(s+4,!0);if(i)throw R(r)}finally{_.__wbindgen_add_to_stack_pointer(16)}}build(){const e=this.__destroy_into_raw(),t=_.typstfontresolverbuilder_build(e);return R(t)}}Symbol.dispose&&(nt.prototype[Symbol.dispose]=nt.prototype.free);const ln=new Set(["basic","cors","default"]);async function fn(n,e){if(typeof Response=="function"&&n instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(n,e)}catch(r){if(n.ok&&ln.has(n.type)&&n.headers.get("Content-Type")!=="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve Wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",r);else throw r}const t=await n.arrayBuffer();return await WebAssembly.instantiate(t,e)}else{const t=await WebAssembly.instantiate(n,e);return t instanceof WebAssembly.Instance?{instance:t,module:n}:t}}function ir(){const n={};return n.wbg={},n.wbg.__wbg_Error_e17e777aac105295=function(e,t){const r=Error(N(e,t));return S(r)},n.wbg.__wbg_Number_998bea33bd87c3e0=function(e){return Number(y(e))},n.wbg.__wbg_call_13410aac570ffff7=function(){return ie(function(e,t){const r=y(e).call(y(t));return S(r)},arguments)},n.wbg.__wbg_call_a5400b25a865cfd8=function(){return ie(function(e,t,r){const i=y(e).call(y(t),y(r));return S(i)},arguments)},n.wbg.__wbg_call_f1fd202ba222e0ec=function(){return ie(function(e,t,r,i,s){const o=y(e).call(y(t),y(r),y(i),y(s));return S(o)},arguments)},n.wbg.__wbg_done_75ed0ee6dd243d9d=function(e){return y(e).done},n.wbg.__wbg_entries_2be2f15bd5554996=function(e){const t=Object.entries(y(e));return S(t)},n.wbg.__wbg_error_7534b8e9a36f1ab4=function(e,t){let r,i;try{r=e,i=t,console.error(N(e,t))}finally{_.__wbindgen_export_1(r,i,1)}},n.wbg.__wbg_error_9eeaeffe2964d2ba=function(e,t,r){console.error(y(e),y(t),y(r))},n.wbg.__wbg_getTimezoneOffset_1e3ddc1382e7c8b0=function(e){return y(e).getTimezoneOffset()},n.wbg.__wbg_get_0da715ceaecea5c8=function(e,t){const r=y(e)[t>>>0];return S(r)},n.wbg.__wbg_get_458e874b43b18b25=function(){return ie(function(e,t){const r=Reflect.get(y(e),y(t));return S(r)},arguments)},n.wbg.__wbg_getwithrefkey_1dc361bd10053bfe=function(e,t){const r=y(e)[y(t)];return S(r)},n.wbg.__wbg_info_6cf68c1a86a92f6a=function(e){console.info(y(e))},n.wbg.__wbg_instanceof_ArrayBuffer_67f3012529f6a2dd=function(e){let t;try{t=y(e)instanceof ArrayBuffer}catch{t=!1}return t},n.wbg.__wbg_instanceof_Map_ebb01a5b6b5ffd0b=function(e){let t;try{t=y(e)instanceof Map}catch{t=!1}return t},n.wbg.__wbg_instanceof_Uint8Array_9a8378d955933db7=function(e){let t;try{t=y(e)instanceof Uint8Array}catch{t=!1}return t},n.wbg.__wbg_isArray_030cce220591fb41=function(e){return Array.isArray(y(e))},n.wbg.__wbg_isSafeInteger_1c0d1af5542e102a=function(e){return Number.isSafeInteger(y(e))},n.wbg.__wbg_iterator_f370b34483c71a1c=function(){return S(Symbol.iterator)},n.wbg.__wbg_length_186546c51cd61acd=function(e){return y(e).length},n.wbg.__wbg_length_6bb7e81f9d7713e4=function(e){return y(e).length},n.wbg.__wbg_new_19c25a3f2fa63a02=function(){const e=new Object;return S(e)},n.wbg.__wbg_new_1f3a344cf3123716=function(){const e=new Array;return S(e)},n.wbg.__wbg_new_2e3c58a15f39f5f9=function(e,t){try{var r={a:e,b:t},i=(o,a)=>{const l=r.a;r.a=0;try{return un(l,r.b,o,a)}finally{r.a=l}};const s=new Promise(i);return S(s)}finally{r.a=r.b=0}},n.wbg.__wbg_new_5a2ae4557f92b50e=function(e){const t=new Date(y(e));return S(t)},n.wbg.__wbg_new_638ebfaedbf32a5e=function(e){const t=new Uint8Array(y(e));return S(t)},n.wbg.__wbg_new_8a6f238a6ece86ea=function(){const e=new Error;return S(e)},n.wbg.__wbg_new_da9dc54c5db29dfa=function(e,t){const r=new Error(N(e,t));return S(r)},n.wbg.__wbg_newfromslice_074c56947bd43469=function(e,t){const r=new Uint8Array(Ze(e,t));return S(r)},n.wbg.__wbg_newfromslice_bd5b07f10e7e3c36=function(e,t){const r=new Uint32Array(sn(e,t));return S(r)},n.wbg.__wbg_newnoargs_254190557c45b4ec=function(e,t){const r=new Function(N(e,t));return S(r)},n.wbg.__wbg_newwithargs_b8065bb443501079=function(e,t,r,i){const s=new Function(N(e,t),N(r,i));return S(s)},n.wbg.__wbg_next_5b3530e612fde77d=function(e){const t=y(e).next;return S(t)},n.wbg.__wbg_next_692e82279131b03c=function(){return ie(function(e){const t=y(e).next();return S(t)},arguments)},n.wbg.__wbg_now_1e80617bcee43265=function(){return Date.now()},n.wbg.__wbg_prototypesetcall_3d4a26c1ed734349=function(e,t,r){Uint8Array.prototype.set.call(Ze(e,t),y(r))},n.wbg.__wbg_proxycontext_new=function(e){const t=le.__wrap(e);return S(t)},n.wbg.__wbg_push_330b2eb93e4e1212=function(e,t){return y(e).push(y(t))},n.wbg.__wbg_queueMicrotask_25d0739ac89e8c88=function(e){queueMicrotask(y(e))},n.wbg.__wbg_queueMicrotask_4488407636f5bf24=function(e){const t=y(e).queueMicrotask;return S(t)},n.wbg.__wbg_resolve_4055c623acdd6a1b=function(e){const t=Promise.resolve(y(e));return S(t)},n.wbg.__wbg_set_3f1d0b984ed272ed=function(e,t,r){y(e)[R(t)]=R(r)},n.wbg.__wbg_set_453345bcda80b89a=function(){return ie(function(e,t,r){return Reflect.set(y(e),y(t),y(r))},arguments)},n.wbg.__wbg_set_90f6c0f7bd8c0415=function(e,t,r){y(e)[t>>>0]=R(r)},n.wbg.__wbg_stack_0ed75d68575b0f3c=function(e,t){const r=y(t).stack,i=$(r,_.__wbindgen_export_2,_.__wbindgen_export_3),s=F;p().setInt32(e+4,s,!0),p().setInt32(e+0,i,!0)},n.wbg.__wbg_static_accessor_GLOBAL_8921f820c2ce3f12=function(){const e=typeof global>"u"?null:global;return j(e)?0:S(e)},n.wbg.__wbg_static_accessor_GLOBAL_THIS_f0a4409105898184=function(){const e=typeof globalThis>"u"?null:globalThis;return j(e)?0:S(e)},n.wbg.__wbg_static_accessor_SELF_995b214ae681ff99=function(){const e=typeof self>"u"?null:self;return j(e)?0:S(e)},n.wbg.__wbg_static_accessor_WINDOW_cde3890479c675ea=function(){const e=typeof window>"u"?null:window;return j(e)?0:S(e)},n.wbg.__wbg_then_e22500defe16819f=function(e,t){const r=y(e).then(y(t));return S(r)},n.wbg.__wbg_typstcompiler_new=function(e){const t=ge.__wrap(e);return S(t)},n.wbg.__wbg_typstfontresolver_new=function(e){const t=te.__wrap(e);return S(t)},n.wbg.__wbg_value_dd9372230531eade=function(e){const t=y(e).value;return S(t)},n.wbg.__wbg_wbindgenbigintgetasi64_ac743ece6ab9bba1=function(e,t){const r=y(t),i=typeof r=="bigint"?r:void 0;p().setBigInt64(e+8,j(i)?BigInt(0):i,!0),p().setInt32(e+0,!j(i),!0)},n.wbg.__wbg_wbindgenbooleanget_3fe6f642c7d97746=function(e){const t=y(e),r=typeof t=="boolean"?t:void 0;return j(r)?16777215:r?1:0},n.wbg.__wbg_wbindgencbdrop_eb10308566512b88=function(e){const t=y(e).original;return t.cnt--==1?(t.a=0,!0):!1},n.wbg.__wbg_wbindgendebugstring_99ef257a3ddda34d=function(e,t){const r=et(y(t)),i=$(r,_.__wbindgen_export_2,_.__wbindgen_export_3),s=F;p().setInt32(e+4,s,!0),p().setInt32(e+0,i,!0)},n.wbg.__wbg_wbindgenin_d7a1ee10933d2d55=function(e,t){return y(e)in y(t)},n.wbg.__wbg_wbindgenisbigint_ecb90cc08a5a9154=function(e){return typeof y(e)=="bigint"},n.wbg.__wbg_wbindgenisfunction_8cee7dce3725ae74=function(e){return typeof y(e)=="function"},n.wbg.__wbg_wbindgenisobject_307a53c6bd97fbf8=function(e){const t=y(e);return typeof t=="object"&&t!==null},n.wbg.__wbg_wbindgenisstring_d4fa939789f003b0=function(e){return typeof y(e)=="string"},n.wbg.__wbg_wbindgenisundefined_c4b71d073b92f3c5=function(e){return y(e)===void 0},n.wbg.__wbg_wbindgenjsvaleq_e6f2ad59ccae1b58=function(e,t){return y(e)===y(t)},n.wbg.__wbg_wbindgenjsvallooseeq_9bec8c9be826bed1=function(e,t){return y(e)==y(t)},n.wbg.__wbg_wbindgennumberget_f74b4c7525ac05cb=function(e,t){const r=y(t),i=typeof r=="number"?r:void 0;p().setFloat64(e+8,j(i)?0:i,!0),p().setInt32(e+0,!j(i),!0)},n.wbg.__wbg_wbindgenstringget_0f16a6ddddef376f=function(e,t){const r=y(t),i=typeof r=="string"?r:void 0;var s=j(i)?0:$(i,_.__wbindgen_export_2,_.__wbindgen_export_3),o=F;p().setInt32(e+4,o,!0),p().setInt32(e+0,s,!0)},n.wbg.__wbg_wbindgenthrow_451ec1a8469d7eb6=function(e,t){throw new Error(N(e,t))},n.wbg.__wbindgen_cast_18dd738794d8ed40=function(e,t){const r=an(e,t,238,dn);return S(r)},n.wbg.__wbindgen_cast_2241b6af4c4b2941=function(e,t){const r=N(e,t);return S(r)},n.wbg.__wbindgen_cast_4625c577ab2ec9ee=function(e){const t=BigInt.asUintN(64,e);return S(t)},n.wbg.__wbindgen_cast_9ae0607507abb057=function(e){return S(e)},n.wbg.__wbindgen_cast_d6cd19b81560fd6e=function(e){return S(e)},n.wbg.__wbindgen_object_clone_ref=function(e){const t=y(e);return S(t)},n.wbg.__wbindgen_object_drop_ref=function(e){R(e)},n}function sr(n,e){return _=n.exports,or.__wbindgen_wasm_module=e,Y=null,ye=null,me=null,_}function gn(n){if(_!==void 0)return _;typeof n<"u"&&(Object.getPrototypeOf(n)===Object.prototype?{module:n}=n:console.warn("using deprecated parameters for `initSync()`; pass a single object instead"));const e=ir();n instanceof WebAssembly.Module||(n=new WebAssembly.Module(n));const t=new WebAssembly.Instance(n,e);return sr(t,n)}async function or(n){if(_!==void 0)return _;typeof n<"u"&&(Object.getPrototypeOf(n)===Object.prototype?{module_or_path:n}=n:console.warn("using deprecated parameters for the initialization function; pass a single object instead")),typeof n>"u"&&(n=ar("typst_ts_web_compiler_bg.wasm",typeof document>"u"?require("url").pathToFileURL(__filename).href:_e&&_e.tagName.toUpperCase()==="SCRIPT"&&_e.src||new URL("cjs/contrib/all-in-one-lite.bundle.js",document.baseURI).href));const e=ir();(typeof n=="string"||typeof Request=="function"&&n instanceof Request||typeof URL=="function"&&n instanceof URL)&&(n=fetch(n));const{instance:t,module:r}=await fn(await n,e);return sr(t,r)}let ar=async function(n,e){throw new Error("Cannot import wasm module without importer: "+n+" "+e)};function cr(n){ar=n}let wn=async function(n,e){const t=new Function("m","return import(m)"),{readFileSync:r}=await t("fs"),i=new URL(n,e);return await r(i).buffer};const hn=typeof process<"u"&&process.versions!=null&&process.versions.node!=null;hn&&cr(wn);const We=Object.freeze(Object.defineProperty({__proto__:null,IncrServer:Q,ProxyContext:le,TypstCompileWorld:fe,TypstCompiler:ge,TypstCompilerBuilder:rt,TypstFontResolver:te,TypstFontResolverBuilder:nt,default:or,get_font_info:cn,initSync:gn,setImportWasmModule:cr},Symbol.toStringTag,{value:"Module"}));class pn{constructor(){f(this,"loadedFonts",new Set);f(this,"fetcher",fetch)}setFetcher(e){this.fetcher=e}async loadFonts(e,t){const r=new Function("m","return import(m)"),i=this.fetcher||(this.fetcher=await async function(){const{fetchBuilder:a,FileSystemCache:l}=await r("node-fetch-cache"),u=new l({cacheDirectory:".cache/typst/fonts"}),g=a.withCache(u);return function(w,x){const C=setTimeout(()=>{console.warn("font fetching is stucking:",w)},15e3);return g(w,x).finally(()=>{clearTimeout(C)})}}()),s=t.filter(a=>a instanceof Uint8Array||typeof a=="object"&&"info"in a?!0:this.loadedFonts.has(a)?!1:(this.loadedFonts.add(a),!0)),o=await Promise.all(s.map(async a=>{if(a instanceof Uint8Array){await e.add_raw_font(a);return}if(typeof a=="object"&&"info"in a){await e.add_lazy_font(a,"blob"in a?a.blob:bn(a));return}return new Uint8Array(await(await i(a)).arrayBuffer())}));for(const a of o)a&&await e.add_raw_font(a)}async build(e,t,r){const i={ref:this,builder:t,hooks:r};for(const s of(e==null?void 0:e.beforeBuild)??[])await s(void 0,i);return r.latelyBuild&&r.latelyBuild(i),await t.build()}}async function _r(n,e,t,r){var i;return await e.init((i=n==null?void 0:n.getModule)==null?void 0:i.call(n)),await new pn().build(n,new t,r)}function bn(n){return()=>{const e=new XMLHttpRequest;return e.overrideMimeType("text/plain; charset=x-user-defined"),e.open("GET",n.url,!1),e.send(null),e.status===200&&(e.response instanceof String||typeof e.response=="string")?Uint8Array.from(e.response,t=>t.charCodeAt(0)):new Uint8Array}}const I=Symbol.for("reflexo-obj");var Me;(function(n){n[n.PIXEL_PER_PT=3]="PIXEL_PER_PT"})(Me||(Me={}));const mn=["DejaVuSansMono-Bold.ttf","DejaVuSansMono-BoldOblique.ttf","DejaVuSansMono-Oblique.ttf","DejaVuSansMono.ttf","LibertinusSerif-Bold.otf","LibertinusSerif-BoldItalic.otf","LibertinusSerif-Italic.otf","LibertinusSerif-Regular.otf","LibertinusSerif-Semibold.otf","LibertinusSerif-SemiboldItalic.otf","NewCM10-Bold.otf","NewCM10-BoldItalic.otf","NewCM10-Italic.otf","NewCM10-Regular.otf","NewCMMath-Bold.otf","NewCMMath-Book.otf","NewCMMath-Regular.otf"],yn=["InriaSerif-Bold.ttf","InriaSerif-BoldItalic.ttf","InriaSerif-Italic.ttf","InriaSerif-Regular.ttf","Roboto-Regular.ttf","NotoSerifCJKsc-Regular.otf"],vn=["TwitterColorEmoji.ttf","NotoColorEmoji-Regular-COLR.subset.ttf"];function Sn(n){var t,r;const e=[];if(n&&(n==null?void 0:n.assets)!==!1&&((t=n==null?void 0:n.assets)!=null&&t.length)&&((r=n==null?void 0:n.assets)==null?void 0:r.length)>0){let i={text:"https://cdn.jsdelivr.net/gh/typst/typst-assets@v0.13.1/files/fonts/",_:"https://cdn.jsdelivr.net/gh/typst/typst-dev-assets@v0.13.1/files/fonts/"},s=n.assetUrlPrefix??i;typeof s=="string"?s={_:s}:s={...i,...s};for(const a of Object.keys(s)){const l=s[a];l[l.length-1]!=="/"&&(s[a]=l+"/")}const o=(a,l)=>l.map(u=>(s[a]||s._)+u);for(const a of n.assets)switch(a){case"text":e.push(...o(a,mn));break;case"cjk":e.push(...o(a,yn));break;case"emoji":e.push(...o(a,vn));break}}return e}function Cn(n,e){const t=Sn(e),r=async(i,{ref:s,builder:o})=>{e!=null&&e.fetcher&&s.setFetcher(e.fetcher),await s.loadFonts(o,[...n,...t])};return r._preloadRemoteFontOptions=e,r._kind="fontLoader",r}const Rn=n=>{let e=!1,t;return()=>e?t:(e=!0,t=n())};class dr{constructor(e){f(this,"wasmBin");f(this,"initOnce");if(typeof e!="function")throw new Error("initFn is not a function");this.initOnce=Rn(async()=>{await e(this.wasmBin)})}async init(e){this.wasmBin=e,await this.initOnce()}}var Te;(function(n){n[n.vector=0]="vector",n[n.pdf=1]="pdf",n[n._dummy=2]="_dummy"})(Te||(Te={}));var Ht;Ht=I;class ur{constructor(e){f(this,Ht);this[I]=e}reset(){this[I].reset()}current(){return this[I].current()}setAttachDebugInfo(e){this[I].set_attach_debug_info(e)}}function xn(){return new wr}var Vt;Vt=I;class lr{constructor(e){f(this,Vt);this[I]=e}compile(e){return this[I].compile(0,oe(e==null?void 0:e.diagnostics))}compileHtml(e){return this[I].compile(1,oe(e==null?void 0:e.diagnostics))}async query(e){return JSON.parse(this[I].query(0,e.selector,e.field))}title(){return this[I].title(0)}vector(e){return this[I].get_artifact(0,oe(e==null?void 0:e.diagnostics))||{}}pdf(e){return this[I].get_artifact(1,oe(e==null?void 0:e.diagnostics))||{}}}const fr=n=>new dr(async e=>await n.default(e));function gr(){return new Oe}class wr{constructor(){f(this,"fontBuilderJs");f(this,"fontBuilder")}async init(e){var t,r;this.fontBuilderJs=await(((t=e==null?void 0:e.getWrapper)==null?void 0:t.call(e))||Promise.resolve().then(()=>We)),await fr(this.fontBuilderJs).init((r=e==null?void 0:e.getModule)==null?void 0:r.call(e)),this.fontBuilder=new this.fontBuilderJs.TypstFontResolverBuilder}async getFontInfo(e){return this.fontBuilder.get_font_info(e)}async addFontData(e){this.fontBuilder.add_raw_font(e)}async addLazyFont(e,t){return this.fontBuilder.add_lazy_font(e,t)}async build(e){const t=await this.fontBuilder.build(),r=await e(t);return t.free(),r}}const je=class je{constructor(){f(this,"compiler");f(this,"compilerJs")}async init(e){var u;this.compilerJs=await(((u=e==null?void 0:e.getWrapper)==null?void 0:u.call(e))||Promise.resolve().then(()=>We));const t=this.compilerJs.TypstCompilerBuilder,r={...e||{}},i=r.beforeBuild??(r.beforeBuild=[]),s=i.some(g=>g._preloadRemoteFontOptions!==void 0),o=i.some(g=>{var w;return((w=g._preloadRemoteFontOptions)==null?void 0:w.assets)!==void 0}),a=i.some(g=>{var w;return((w=g._preloadRemoteFontOptions)==null?void 0:w.assets)===!1});if((!s||!o&&!a)&&i.push(Cn([],{assets:je.defaultAssets})),!i.some(g=>g._kind==="fontLoader"))throw new Error("TypstCompiler: no font loader found, please use font loaders, e.g. loadFonts or preloadSystemFonts");this.compiler=await _r(e,fr(this.compilerJs),t,{})}setFonts(e){this.compiler.set_fonts(e)}compile(e){return new Promise(t=>{const r=this.compiler.snapshot(e.root,e.mainFilePath,Ct(e.inputs));if("incrementalServer"in e){t(r.incr_compile(e.incrementalServer[I],oe(e.diagnostics)));return}t(r.get_artifact(e.format||Te.vector,oe(e.diagnostics)))})}async runWithWorld(e,t){const r=this.compiler.snapshot(e.root,e.mainFilePath,Ct(e.inputs));let i=await t(new lr(r));return r.free(),i}query(e){return this.runWithWorld(e,async t=>JSON.parse(await t.query(e)))}getSemanticTokenLegend(){return new Promise(e=>{e(this.compiler.get_semantic_token_legend())})}getSemanticTokens(e){return new Promise(t=>{this.compiler.reset(),t(this.compiler.get_semantic_tokens(e.offsetEncoding||"utf-16",e.mainFilePath,e.resultId))})}async withIncrementalServer(e){const t=new ur(this.compiler.create_incr_server());try{return await e(t)}finally{t[I].free()}}async getAst(e){return this.compiler.get_ast(e)}async reset(){await new Promise(e=>{this.compiler.reset(),e(void 0)})}addSource(e,t){if(arguments.length>2)throw new Error("use of addSource(path, source, isMain) is deprecated, please use addSource(path, source) instead");this.compiler.add_source(e,t)}mapShadow(e,t){this.compiler.map_shadow(e,t)}unmapShadow(e){this.compiler.unmap_shadow(e)}resetShadow(){this.compiler.reset_shadow()}renderPageToCanvas(){throw new Error("Please use the api TypstRenderer.renderToCanvas in v0.4.0")}};f(je,"defaultAssets",["text"]);let Oe=je;gr._impl=Oe;function Ct(n){return n?Object.entries(n):void 0}function oe(n){switch(n){case"none":return 1;case"unix":return 2;case"full":default:return 3}}const Ne=Object.freeze(Object.defineProperty({__proto__:null,get CompileFormatEnum(){return Te},IncrementalServer:ur,TypstFontBuilderDriver:wr,TypstWorld:lr,createTypstCompiler:gr,createTypstFontBuilder:xn},Symbol.toStringTag,{value:"Module"}));let Rt,He;function kn(n,e){const t=Rt||n();return He!==void 0?He:He=(async()=>(await t.init(e),Rt=t))()}const In=Object.freeze(Object.defineProperty({__proto__:null,createGlobalCompiler:kn},Symbol.toStringTag,{value:"Module"}));class Pn{constructor(e,t,r){f(this,"pageInfos");f(this,"loadPageCount");f(this,"imageScaleFactor");f(this,"container");f(this,"canvasList");f(this,"textLayerList");f(this,"commonList");f(this,"textLayerParentList");f(this,"semanticLayerList");this.pageInfos=e,this.imageScaleFactor=r.pixelPerPt??Me.PIXEL_PER_PT,t.innerHTML="",t.style.width="100%",this.container=t,this.canvasList=new Array(this.loadPageCount),this.textLayerList=new Array(this.loadPageCount),this.commonList=new Array(this.loadPageCount),this.textLayerParentList=new Array(this.loadPageCount),this.semanticLayerList=new Array(this.loadPageCount);const i=(s,o,a)=>{const l=Math.ceil(o.width)*this.imageScaleFactor,u=Math.ceil(o.height)*this.imageScaleFactor,g=this.canvasList[s]=document.createElement("canvas"),w=this.semanticLayerList[s]=document.createElement("div"),x=this.textLayerList[s]=document.createElement("div"),C=this.textLayerParentList[s]=document.createElement("div");if(g.getContext("2d")){const A=document.createElement("div");g.width=l,g.height=u,A.appendChild(g),a.appendChild(A),A.style.position="absolute"}{C.appendChild(x),C.className="typst-html-semantics";const A=t.offsetWidth,D=A/o.width;C.style.width=`${A}px`,C.style.height=`${o.height*D}px`,C.style.setProperty("--data-text-width",`${D}px`),C.style.setProperty("--data-text-height",`${D}px`),a.classList.add("typst-page"),a.classList.add("canvas"),a.style.width=`${A}px`,a.style.height=`${u*D}px`,a.style.position="relative",w.appendChild(C),a.appendChild(w)}};for(let s=0;s<this.pageInfos.length;s++){const o=this.pageInfos[s];let a;a=this.commonList[s]=document.createElement("div"),t.appendChild(a),i(s,o,a)}}resetLayout(){for(let e=0;e<this.pageInfos.length;e++){const t=this.pageInfos[e],r=Math.ceil(t.width)*this.imageScaleFactor,i=Math.ceil(t.height)*this.imageScaleFactor,s=this.canvasList[e].parentElement;if(!s)throw new Error(`canvasDiv is null for page ${e}, canvas list length ${this.canvasList.length}`);const o=this.commonList[e],a=this.textLayerParentList[e],l=this.container.offsetWidth,u=l/r;a.style.width=`${l}px`,a.style.height=`${i*u}px`,o.style.width=`${l}px`,o.style.height=`${i*u}px`;const g=this.container.offsetWidth/r;s.style.transformOrigin="0px 0px",s.style.transform=`scale(${g})`}}}var X;(function(n){n[n.Doc=0]="Doc",n[n.Slide=1]="Slide"})(X||(X={}));class lt{constructor(e){f(this,"hookedElem");f(this,"kModule");f(this,"opts");f(this,"modes",[]);f(this,"partialRendering",!0);f(this,"renderMode","svg");f(this,"r");f(this,"previewMode",X.Doc);f(this,"isContentPreview",!1);f(this,"isMixinOutline",!1);f(this,"backgroundColor","black");f(this,"pageColor","white");f(this,"pixelPerPt",3);f(this,"retrieveDOMState");f(this,"isRendering",!1);f(this,"moduleInitialized",!1);f(this,"patchQueue",[]);f(this,"disposeList",[]);f(this,"canvasRenderCToken");f(this,"currentRealScale",1);f(this,"currentScaleRatio",1);f(this,"vpTimeout");f(this,"sampledRenderTime",0);f(this,"partialRenderPage",0);f(this,"outline");f(this,"cursorPosition");f(this,"cachedDOMState",{width:0,height:0,window:{innerWidth:0,innerHeight:0},boundingRect:{left:0,top:0,right:0}});var t,r;this.hookedElem=e.hookedElem,this.kModule=e.kModule,this.opts=e||{};{const{renderMode:i,previewMode:s,isContentPreview:o,retrieveDOMState:a}=e||{};this.partialRendering=!1,this.renderMode=i??this.renderMode,this.previewMode=s??this.previewMode,this.isContentPreview=o||!1,this.retrieveDOMState=a??(()=>({width:this.hookedElem.offsetWidth,height:this.hookedElem.offsetHeight,window:{innerWidth:window.innerWidth,innerHeight:window.innerHeight},boundingRect:this.hookedElem.getBoundingClientRect()})),this.backgroundColor=getComputedStyle(document.documentElement).getPropertyValue("--typst-preview-background-color")}this.hookedElem.classList.add("hide-scrollbar-x"),(t=this.hookedElem.parentElement)==null||t.classList.add("hide-scrollbar-x"),this.previewMode===X.Slide&&(this.hookedElem.classList.add("hide-scrollbar-y"),(r=this.hookedElem.parentElement)==null||r.classList.add("hide-scrollbar-y")),this.installCtrlWheelHandler()}reset(){this.kModule.reset(),this.moduleInitialized=!1}dispose(){const e=this.disposeList;this.disposeList=[],e.forEach(t=>t())}static derive(e,t){return["rescale","rerender","postRender"].reduce((r,i)=>(r[i]=e[`${i}$${t}`].bind(e),console.assert(r[i]!==void 0,`${i}$${t} is undefined`),r),{})}registerMode(e){const t=lt.derive(this,e);this.modes.push([e,t]),e===this.renderMode&&(this.r=t)}installCtrlWheelHandler(){const e=[.1,.2,.3,.4,.5,.6,.7,.8,.9,1,1.1,1.3,1.5,1.7,1.9,2.1,2.4,2.7,3,3.3,3.7,4.1,4.6,5.1,5.7,6.3,7,7.7,8.5,9.4,10],t=r=>{var i,s,o,a;if(r.ctrlKey){r.preventDefault(),this.cachedDOMState=this.retrieveDOMState(),window.onresize!==null&&(window.onresize=null);const l=this.currentScaleRatio;if(r.deltaY<0){if(this.currentScaleRatio>=e.at(-1))return;this.currentScaleRatio=e.filter(C=>C>this.currentScaleRatio).at(0)}else if(r.deltaY>0){if(this.currentScaleRatio<=e.at(0))return;this.currentScaleRatio=e.filter(C=>C<this.currentScaleRatio).at(-1)}else return;const u=this.currentScaleRatio/l,g=r.pageX*(u-1),w=r.pageY*(u-1);Math.abs(this.currentScaleRatio-1)<1e-5?(this.hookedElem.classList.add("hide-scrollbar-x"),(i=this.hookedElem.parentElement)==null||i.classList.add("hide-scrollbar-x"),this.previewMode===X.Slide&&(this.hookedElem.classList.add("hide-scrollbar-y"),(s=this.hookedElem.parentElement)==null||s.classList.add("hide-scrollbar-y"))):(this.hookedElem.classList.remove("hide-scrollbar-x"),(o=this.hookedElem.parentElement)==null||o.classList.remove("hide-scrollbar-x"),this.previewMode===X.Slide&&(this.hookedElem.classList.remove("hide-scrollbar-y"),(a=this.hookedElem.parentElement)==null||a.classList.remove("hide-scrollbar-y")));const x=this.hookedElem.firstElementChild;if(x){const C=this.getSvgScaleRatio(),O=Number.parseFloat(x.getAttribute("data-height")),A=Math.ceil(O*C);this.hookedElem.style.height=`${A*2}px`}return window.scrollBy(g,w),this.addViewportChange(),!1}};this.renderMode!=="dom"&&(typeof acquireVsCodeApi<"u"?(window.addEventListener("wheel",t,{passive:!1}),this.disposeList.push(()=>{window.removeEventListener("wheel",t)})):(document.body.addEventListener("wheel",t,{passive:!1}),this.disposeList.push(()=>{document.body.removeEventListener("wheel",t)})))}getSvgScaleRatio(){const e=this.hookedElem.firstElementChild;if(!e)return 0;const t=this.cachedDOMState,r=Number.parseFloat(e.getAttribute("data-width")||e.getAttribute("width")||"1"),i=Number.parseFloat(e.getAttribute("data-height")||e.getAttribute("height")||"1");return this.currentRealScale=this.previewMode===X.Slide?Math.min(t.width/r,t.height/i):t.width/r,this.currentRealScale*this.currentScaleRatio}processQueue(e){const t=e[0];switch(t){case"new":case"diff-v1":return t==="new"&&this.reset(),this.kModule.manipulateData({action:"merge",data:e[1]}),this.moduleInitialized=!0,!0;case"viewport-change":return this.moduleInitialized?!0:(console.log("viewport-change before initialization"),!1);default:return console.log("svgUpdateEvent",e),!1}}triggerUpdate(){if(this.isRendering)return;this.isRendering=!0;const e=async()=>{if(this.cachedDOMState=this.retrieveDOMState(),this.patchQueue.length===0){this.isRendering=!1,this.postprocessChanges();return}try{let t=performance.now();const r=this.canvasRenderCToken;r&&(await r.cancel(),await r.wait(),this.canvasRenderCToken=void 0,console.log("cancel canvas rendering"));let i=!1;for(;this.patchQueue.length>0;)i=this.processQueue(this.patchQueue.shift())||i;let s=performance.now();i&&(this.r.rescale(),await this.r.rerender(),this.r.rescale());let o=performance.now();const a=(l,u,g)=>`${l} ${(g-u).toFixed(2)} ms`;this.sampledRenderTime=o-t,requestAnimationFrame(e)}catch(t){console.error(t),this.isRendering=!1,this.postprocessChanges()}};requestAnimationFrame(e)}postprocessChanges(){this.r.postRender(),this.previewMode===X.Slide&&document.querySelectorAll(".typst-page-number-indicator").forEach(e=>{e.textContent=`${this.kModule.retrievePagesInfo().length}`})}addChangement(e){e[0]==="new"&&this.patchQueue.splice(0,this.patchQueue.length);const t=()=>{this.vpTimeout=void 0,this.patchQueue.push(e),this.triggerUpdate()};this.vpTimeout!==void 0&&clearTimeout(this.vpTimeout),e[0]==="viewport-change"&&this.isRendering?this.vpTimeout=setTimeout(t,this.sampledRenderTime||100):t()}addViewportChange(){this.addChangement(["viewport-change",""])}}function En(n){return class{constructor(t){f(this,"impl");f(this,"kModule");if(t.isContentPreview&&(t.renderMode="canvas"),this.kModule=t.kModule,this.impl=new n(t),!this.impl.r)throw new Error(`mode is not supported, ${t==null?void 0:t.renderMode}`);t.isContentPreview&&(this.impl.partialRendering=!0,this.impl.pixelPerPt=1,this.impl.isMixinOutline=!0)}dispose(){this.impl.dispose()}reset(){this.impl.reset()}addChangement(t){this.impl.addChangement(t)}addViewportChange(){this.impl.addViewportChange()}setPageColor(t){this.impl.pageColor=t,this.addViewportChange()}setPartialRendering(t){this.impl.partialRendering=t}setCursor(t,r,i){this.impl.cursorPosition=[t,r,i]}setPartialPageNumber(t){return t<=0||t>this.kModule.retrievePagesInfo().length?!1:(this.impl.partialRenderPage=t-1,this.addViewportChange(),!0)}getPartialPageNumber(){return this.impl.partialRenderPage+1}setOutineData(t){this.impl.outline=t,this.addViewportChange()}}}function Fn(n,...e){return e.reduce((t,r)=>r(t),n)}class An{constructor(){f(this,"isCancellationRequested",!1);f(this,"_onCancelled");f(this,"_onCancelledResolveResolved");let e,t;this._onCancelled=new Promise(r=>{e=r,t&&t(r)}),this._onCancelledResolveResolved=new Promise(r=>{t=r,e&&r(e)})}async cancel(){await this._onCancelledResolveResolved,this.isCancellationRequested=!0}isCancelRequested(){return this.isCancellationRequested}async consume(){(await this._onCancelledResolveResolved)()}wait(){return this._onCancelled}}const Ln=()=>new Promise(n=>requestAnimationFrame(n));var it;(function(n){n[n.Doc=0]="Doc",n[n.Pages=1]="Pages"})(it||(it={}));var J;(function(n){n[n.Layout=0]="Layout",n[n.Svg=1]="Svg",n[n.Semantics=2]="Semantics",n[n.PrepareCanvas=3]="PrepareCanvas",n[n.Canvas=4]="Canvas"})(J||(J={}));function Mn(n){return class extends n{constructor(...r){super(...r);f(this,"tmpl",document.createElement("template"));f(this,"stub",this.createElement("<stub></stub>"));f(this,"plugin");f(this,"docKernel");f(this,"resourceHeader");f(this,"pages",[]);f(this,"domScale",1);f(this,"track_mode",it.Doc);f(this,"current_task");f(this,"viewport");if(this.registerMode("dom"),this.disposeList.push(()=>{this.dispose()}),this.plugin=this.opts.renderer,this.opts.domScale!==void 0){if(this.opts.domScale<=0)throw new Error("domScale must be positive");this.domScale=this.opts.domScale}}dispose(){for(const r of this.pages)r.dispose();this.docKernel&&this.docKernel.free()}createElement(r){return this.tmpl.innerHTML=r,this.tmpl.content.firstElementChild}async mountDom(r){if(this.docKernel)throw new Error("already mounted");this.hookedElem.innerHTML='<svg class="typst-svg-resources" viewBox="0 0 0 0" width="0" height="0" style="opacity: 0; position: absolute;"></svg>',this.resourceHeader=this.hookedElem.querySelector(".typst-svg-resources"),this.docKernel=await this.plugin.renderer.mount_dom(this.kModule[I],this.hookedElem),this.docKernel.bind_functions({populateGlyphs:i=>{let o=this.createElement(i).firstElementChild;this.resourceHeader.append(o)}})}async cancelAnyway$dom(){if(this.current_task){const r=this.current_task;this.current_task=void 0,await r.cancel()}}retrieveDOMPages(){return Array.from(this.hookedElem.querySelectorAll(".typst-dom-page"))}postRender$dom(){}rescale$dom(){}getDomViewport(r,i){const s=i.left,o=-i.top,a=i.right,l=r.innerHeight-i.top,u={x:0,y:o/this.domScale,width:Math.max(a-s,0)/this.domScale,height:Math.max(l-o,0)/this.domScale};return(u.width<=0||u.height<=0)&&(u.x=u.y=u.width=u.height=0),u}async rerender$dom(){const r=this.retrieveDOMState(),{x:i,y:s,width:o,height:a}=this.getDomViewport(r.window,r.boundingRect);if(!await this.docKernel.relayout(i,s,o,a))return;const u=new An;this.doRender$dom(u),this.current_task=u}async doRender$dom(r){const i=(l,u)=>{if(l&&!r.isCancelRequested()&&u)return u()},s=this.retrieveDOMPages().map(l=>{const{innerWidth:u,innerHeight:g}=window,w=l.getBoundingClientRect();return{inWindow:!(w.left>u||w.right<0||w.top>g||w.bottom<0),page:l}}),o=async l=>{if(await Ln(),r.isCancelRequested())return;const u=s[l].page,g=u.getBoundingClientRect(),w=this.getDomViewport(window,g),x=B=>this.docKernel.need_repaint(l,w.x,w.y,w.width,w.height,B),C=B=>this.docKernel.repaint(l,w.x,w.y,w.width,w.height,B),O=B=>{if(!r.isCancelRequested())return i(x(B),()=>C(B))};await O(J.Layout);const A=(g.width?Number.parseFloat(u.getAttribute("data-width"))/g.width:1)*this.domScale,D=(g.height?Number.parseFloat(u.getAttribute("data-height"))/g.height:1)*this.domScale;w.x*=A,w.y*=D,w.y-=100,w.width*=A,w.height*=D,w.height+=200,await O(J.Svg),await O(J.Semantics),!r.isCancelRequested()&&(x(J.PrepareCanvas)?(async()=>{if(await C(J.PrepareCanvas),!r.isCancelRequested())return O(J.Canvas)})():await O(J.Canvas))},a=async l=>{for(let u=0;u<s.length;++u){if(r.isCancelRequested())return;s[u].inWindow===l&&await o(u)}};this.cancelAnyway$dom(),await a(!0),await a(!1),r.isCancelRequested()}}}class Tn extends En(Fn(lt,Mn)){}var Jt;let Fe=(Jt=I,class{constructor(e,t){f(this,"plugin");f(this,Jt);this.plugin=e,this[I]=t}set backgroundColor(e){e!==void 0&&(this[I].background_color=e)}get backgroundColor(){return this[I].background_color}set pixelPerPt(e){e!==void 0&&(this[I].pixel_per_pt=e)}get pixelPerPt(){return this[I].pixel_per_pt}reset(){this.plugin.resetSession(this)}get doc_width(){return this[I].doc_width}get docWidth(){return this[I].doc_width}get doc_height(){return this[I].doc_height}get docHeight(){return this[I].doc_height}retrievePagesInfo(){const e=this[I].pages_info,t=[],r=e.page_count;for(let i=0;i<r;i++){const s=e.page(i);t.push({pageOffset:s.page_off,width:s.width_pt,height:s.height_pt})}return t}getSourceLoc(e){return this[I].source_span(e)}renderSvg(e){return this.plugin.renderSvg({renderSession:this,...e})}renderToSvg(e){return this.plugin.renderToSvg({renderSession:this,...e})}renderCanvas(e){return this.plugin.renderCanvas({renderSession:this,...e})}manipulateData(e){this.plugin.manipulateData({renderSession:this,...e})}renderSvgDiff(e){return this.plugin.renderSvgDiff({renderSession:this,...e})}get_source_loc(e){return this[I].source_span(e)}render_in_window(e,t,r,i){return this[I].render_in_window(e,t,r,i)}merge_delta(e){this.plugin.manipulateData({renderSession:this,action:"merge",data:e})}});var ae;(function(n){n[n.Delete=0]="Delete",n[n.New=1]="New",n[n.Update=2]="Update"})(ae||(ae={}));var Gt;let hr=(Gt=I,class{constructor(e,t){f(this,"plugin");f(this,Gt);f(this,"managedCanvasElemList",new Map);f(this,"canvasCounter",Math.random());this.plugin=e,this[I]=t}manipulateData(e,t){return this[I].manipulate_data(e,t)}renderCanvas(e){const t=this.managedCanvasElemList;for(const[a,l]of t)l[0]=ae.Delete;for(const a of e){const l=a.canvas;let u=l.dataset.manageId,g=ae.Update;u||(u=this.canvasCounter.toFixed(5),this.canvasCounter+=1,l.dataset.manageId=u,g=ae.New);let w=t.get(u);if(w&&w[0]!==ae.Delete)throw new Error("cannot update a canvas for two times in batch");t.set(u,[g,{...a}])}const r=Array.from(t.entries()),i=new Uint8Array(r.length),s=new Array(r.length),o=r.map(([a,[l,u]],g)=>(l||t.delete(a),i[g]=l,s[g]=u.canvas,this.plugin.canvasOptionsToRust(u)));return this[I].render_canvas(i,s,o)}async retrievePagesInfo(){const e=await this[I].get_pages_info();console.log(e);const t=[],r=e.page_count;for(let i=0;i<r;i++){const s=e.page(i);t.push({pageOffset:s.page_off,width:s.width_pt,height:s.height_pt})}return t}});const On=n=>new dr(async e=>await n.default(e));function $n(){return new pr}let xt=!0;class pr{constructor(){f(this,"renderer");f(this,"rendererJs")}async init(e){var r;this.rendererJs=await(((r=e==null?void 0:e.getWrapper)==null?void 0:r.call(e))||Promise.resolve().then(()=>ft));const t=this.rendererJs.TypstRendererBuilder;this.renderer=await _r(e,On(this.rendererJs),t,{})}loadGlyphPack(e){return Promise.resolve()}createOptionsToRust(e){const t=new this.rendererJs.CreateSessionOptions;return e.format!==void 0&&(t.format=e.format),e.artifactContent!==void 0&&(t.artifact_content=e.artifactContent),t}canvasOptionsToRust(e){const t=new this.rendererJs.RenderPageImageOptions;if(e.pageOffset===void 0)throw new Error("pageOffset is required in reflexo v0.5.0");if(t.page_off=e.pageOffset,e.cacheKey!==void 0&&(t.cache_key=e.cacheKey),e.backgroundColor!==void 0&&(t.background_color=e.backgroundColor),e.pixelPerPt!==void 0&&(t.pixel_per_pt=e.pixelPerPt),e.dataSelection!==void 0){let r=0;e.dataSelection.body?r|=1:e.canvas&&xt&&(xt=!1,console.warn("dataSelection.body is not set but providing canvas for body")),(e.dataSelection.text||e.dataSelection.annotation)&&console.error("dataSelection.text and dataSelection.annotation are deprecated"),e.dataSelection.semantics&&(r|=8),t.data_selection=r}return t}retrievePagesInfoFromSession(e){return e.retrievePagesInfo()}renderCanvas(e){return this.withinOptionSession(e,async t=>this.renderer.render_page_to_canvas(t[I],e.canvas||void 0,this.canvasOptionsToRust(e)))}async inAnimationFrame(e){return new Promise((t,r)=>{requestAnimationFrame(()=>{try{t(e())}catch(i){r(i)}})})}async renderDisplayLayer(e,t,r){const s=e[I].pages_info.page_count,o=async(g,w)=>{const C=t[g].getContext("2d");if(!C)throw new Error("canvas context is null");return await this.renderCanvas({...r,canvas:C,renderSession:e,pageOffset:w})},a=performance.now(),l=await(async()=>{const g=[];for(let w=0;w<s;w++)g.push(await this.inAnimationFrame(()=>o(w,w)));return g})(),u=performance.now();return console.log(`display layer used: render = ${(u-a).toFixed(1)}ms`),l}renderTextLayer(e,t){const r=performance.now();e.forEach((s,o)=>{s.innerHTML=t[o].htmlSemantics[0]});const i=performance.now();console.log(`text layer used: render = ${(i-r).toFixed(1)}ms`)}async render(e){if("format"in e&&e.format!=="vector"&&["serde_json","js","ir"].includes(e.format))throw new Error(`deprecated format ${e.format}, please use vector format`);return this.renderToCanvas(e)}async renderDom(e){if("format"in e&&e.format!=="vector"&&["serde_json","js","ir"].includes(e.format))throw new Error(`deprecated format ${e.format}, please use vector format`);return this.withinOptionSession(e,async t=>{const r=new Tn({...e,renderMode:"dom",hookedElem:e.container,kModule:t,renderer:this});return await r.impl.mountDom(e.pixelPerPt),r})}async renderToCanvas(e){let t,r;const i=e.container;i.style.visibility="hidden";const s=async(o,a)=>{try{r=await this.renderDisplayLayer(t,o,e),a()}finally{i.style.visibility="visible"}};return this.withinOptionSession(e,async o=>{if(t=o,t[I].pages_info.page_count===0)throw new Error("No page found in session");if(e.pixelPerPt!==void 0&&e.pixelPerPt<=0)throw new Error("Invalid typst.RenderOptions.pixelPerPt, should be a positive number "+e.pixelPerPt);let a=e.backgroundColor;if(a!==void 0&&!/^#[0-9a-f]{6}$/.test(a))throw new Error("Invalid typst.backgroundColor color for matching ^#?[0-9a-f]{6}$ "+a);t.pixelPerPt=e.pixelPerPt??Me.PIXEL_PER_PT,t.backgroundColor=a??"#ffffff";const l=performance.now(),u=new Pn(this.retrievePagesInfoFromSession(t),i,e),g=performance.now();console.log(`layer used: retrieve = ${(g-l).toFixed(1)}ms`),await s(u.canvasList,()=>u.resetLayout()),this.renderTextLayer(u.textLayerList,r)})}createModule(e){return Promise.resolve(new Fe(this,this.renderer.create_session(e&&this.createOptionsToRust({format:"vector",artifactContent:e}))))}async createWorkerV0(e){return new hr(this,await this.renderer.create_worker(e))}workerBridge(){return this.renderer.create_worker_bridge()}renderSvg(e,t){if(e instanceof Fe||t)throw new Error("removed api, please use renderToSvg({ renderSession, container }) instead");return this.withinOptionSession(e,async r=>{let i;return e.data_selection&&(i=0,e.data_selection.body&&(i|=1),e.data_selection.defs&&(i|=2),e.data_selection.css&&(i|=4),e.data_selection.js&&(i|=8)),Promise.resolve(this.renderer.svg_data(r[I],i))})}renderSvgDiff(e){return e.window?this.renderer.render_svg_diff(e.renderSession[I],e.window.lo.x,e.window.lo.y,e.window.hi.x,e.window.hi.y):this.renderer.render_svg_diff(e.renderSession[I],0,0,1e33,1e33)}renderToSvg(e){return this.withinOptionSession(e,async t=>Promise.resolve(this.renderer.render_svg(t[I],e.container)))}getCustomV1(e){return Promise.resolve(this.renderer.get_customs(e.renderSession[I]))}resetSession(e){return this.renderer.reset(e[I])}manipulateData(e){return this.renderer.manipulate_data(e.renderSession[I],e.action??"reset",e.data)}withinOptionSession(e,t){function r(i){return"artifactContent"in i}if("renderSession"in e)return t(e.renderSession);if(r(e))return this.runWithSession(e,t);throw new Error("Invalid render options, should be one of RenderByContentOptions|RenderBySessionOptions")}async runWithSession(e,t){let r=e,i=t;t||(r=void 0,i=e);const s=this.renderer.create_session(r&&this.createOptionsToRust(r));try{const o=await i(new Fe(this,s));return s.free(),o}catch(o){throw s.free(),o}}}const kt=Object.freeze(Object.defineProperty({__proto__:null,RenderSession:Fe,TypstRendererDriver:pr,TypstWorker:hr,createTypstRenderer:$n},Symbol.toStringTag,{value:"Module"}));let It,Ve;function Dn(n,e){const t=It||n();return Ve!==void 0?Ve:Ve=(async()=>(await t.init(e),It=t))()}const Bn=Object.freeze(Object.defineProperty({__proto__:null,createGlobalRenderer:Dn},Symbol.toStringTag,{value:"Module"}));let c,K=new Array(128).fill(void 0);K.push(void 0,null,!0,!1);function d(n){return K[n]}let ce=K.length;function v(n){ce===K.length&&K.push(K.length+1);const e=ce;if(ce=K[e],typeof ce!="number")throw new Error("corrupt heap");return K[e]=n,e}function P(n,e){try{return n.apply(this,e)}catch(t){c.__wbindgen_export_0(v(t))}}function h(n,e){try{return n.apply(this,e)}catch(t){let r=function(){try{return t instanceof Error?`${t.message}

Stack:
${t.stack}`:t.toString()}catch{return"<failed to stringify thrown value>"}}();throw console.error("wasm-bindgen: imported JS function that was not marked as `catch` threw an error:",r),t}}function b(n){if(typeof n!="number")throw new Error(`expected a number argument, found ${typeof n}`)}let ve=null;function ue(){return(ve===null||ve.byteLength===0)&&(ve=new Uint8Array(c.memory.buffer)),ve}let Ae=new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0});Ae.decode();const jn=2146435072;let Je=0;function Wn(n,e){return Je+=e,Je>=jn&&(Ae=new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}),Ae.decode(),Je=e),Ae.decode(ue().subarray(n,n+e))}function E(n,e){return n=n>>>0,Wn(n,e)}let T=0;const ke=new TextEncoder;"encodeInto"in ke||(ke.encodeInto=function(n,e){const t=ke.encode(n);return e.set(t),{read:n.length,written:t.length}});function z(n,e,t){if(typeof n!="string")throw new Error(`expected a string argument, found ${typeof n}`);if(t===void 0){const a=ke.encode(n),l=e(a.length,1)>>>0;return ue().subarray(l,l+a.length).set(a),T=a.length,l}let r=n.length,i=e(r,1)>>>0;const s=ue();let o=0;for(;o<r;o++){const a=n.charCodeAt(o);if(a>127)break;s[i+o]=a}if(o!==r){o!==0&&(n=n.slice(o)),i=t(i,r,r=o+n.length*3,1)>>>0;const a=ue().subarray(i+o,i+r),l=ke.encodeInto(n,a);if(l.read!==n.length)throw new Error("failed to pass whole string");o+=l.written,i=t(i,r,o,1)>>>0}return T=o,i}let Z=null;function m(){return(Z===null||Z.buffer.detached===!0||Z.buffer.detached===void 0&&Z.buffer!==c.memory.buffer)&&(Z=new DataView(c.memory.buffer)),Z}function M(n){return n==null}function W(n){if(typeof n!="boolean")throw new Error(`expected a boolean argument, found ${typeof n}`)}function Pt(n,e){return n=n>>>0,ue().subarray(n/1,n/1+e)}function zn(n){n<132||(K[n]=ce,ce=n)}function L(n){const e=d(n);return zn(n),e}function st(n){const e=typeof n;if(e=="number"||e=="boolean"||n==null)return`${n}`;if(e=="string")return`"${n}"`;if(e=="symbol"){const i=n.description;return i==null?"Symbol":`Symbol(${i})`}if(e=="function"){const i=n.name;return typeof i=="string"&&i.length>0?`Function(${i})`:"Function"}if(Array.isArray(n)){const i=n.length;let s="[";i>0&&(s+=st(n[0]));for(let o=1;o<i;o++)s+=", "+st(n[o]);return s+="]",s}const t=/\[object ([^\]]+)\]/.exec(toString.call(n));let r;if(t&&t.length>1)r=t[1];else return toString.call(n);if(r=="Object")try{return"Object("+JSON.stringify(n)+")"}catch{return"Object"}return n instanceof Error?`${n.name}: ${n.message}
${n.stack}`:r}const $e=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(n=>{c.__wbindgen_export_4.get(n.dtor)(n.a,n.b)});function Et(n,e,t,r){const i={a:n,b:e,cnt:1,dtor:t},s=(...o)=>{i.cnt++;try{return r(i.a,i.b,...o)}finally{--i.cnt===0&&(c.__wbindgen_export_4.get(i.dtor)(i.a,i.b),i.a=0,$e.unregister(i))}};return s.original=i,$e.register(s,i,i),s}function qn(n,e,t,r){const i={a:n,b:e,cnt:1,dtor:t},s=(...o)=>{i.cnt++;const a=i.a;i.a=0;try{return r(a,i.b,...o)}finally{--i.cnt===0?(c.__wbindgen_export_4.get(i.dtor)(a,i.b),$e.unregister(i)):i.a=a}};return s.original=i,$e.register(s,i,i),s}function Un(){const n=c.renderer_build_info();return L(n)}function H(n,e){if(!(n instanceof e))throw new Error(`expected instance of ${e.name}`)}function De(n,e){const t=e(n.length*1,1)>>>0;return ue().set(n,t/1),T=n.length,t}let Se=null;function Nn(){return(Se===null||Se.byteLength===0)&&(Se=new Uint32Array(c.memory.buffer)),Se}function Hn(n,e){const t=e(n.length*4,4)>>>0;return Nn().set(n,t/4),T=n.length,t}function Ft(n,e){const t=e(n.length*4,4)>>>0,r=m();for(let i=0;i<n.length;i++)r.setUint32(t+4*i,v(n[i]),!0);return T=n.length,t}function Vn(n,e,t){b(n),b(e),c.__wbindgen_export_5(n,e,v(t))}function Jn(n,e){b(n),b(e),c.__wbindgen_export_6(n,e)}function Gn(n,e,t){b(n),b(e),c.__wbindgen_export_7(n,e,v(t))}function Kn(n,e,t,r){b(n),b(e),c.__wbindgen_export_8(n,e,v(t),v(r))}const At=["nonzero","evenodd"],Lt=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(n=>c.__wbg_createsessionoptions_free(n>>>0,1));class Be{__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Lt.unregister(this),e}free(){const e=this.__destroy_into_raw();c.__wbg_createsessionoptions_free(e,0)}constructor(){const e=c.createsessionoptions_new();return this.__wbg_ptr=e>>>0,Lt.register(this,this.__wbg_ptr,this),this}set format(e){if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");b(this.__wbg_ptr);const t=z(e,c.__wbindgen_export_1,c.__wbindgen_export_2),r=T;c.createsessionoptions_set_format(this.__wbg_ptr,t,r)}set artifact_content(e){if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");b(this.__wbg_ptr);const t=De(e,c.__wbindgen_export_1),r=T;c.createsessionoptions_set_artifact_content(this.__wbg_ptr,t,r)}}Symbol.dispose&&(Be.prototype[Symbol.dispose]=Be.prototype.free);const Mt=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(n=>c.__wbg_incrdomdocclient_free(n>>>0,1));class we{constructor(){throw new Error("cannot invoke `new` directly")}static __wrap(e){e=e>>>0;const t=Object.create(we.prototype);return t.__wbg_ptr=e,Mt.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Mt.unregister(this),e}free(){const e=this.__destroy_into_raw();c.__wbg_incrdomdocclient_free(e,0)}bind_functions(e){if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");b(this.__wbg_ptr),c.incrdomdocclient_bind_functions(this.__wbg_ptr,v(e))}relayout(e,t,r,i){if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");b(this.__wbg_ptr);const s=c.incrdomdocclient_relayout(this.__wbg_ptr,e,t,r,i);return L(s)}need_repaint(e,t,r,i,s,o){try{if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");const g=c.__wbindgen_add_to_stack_pointer(-16);b(this.__wbg_ptr),b(e),b(o),c.incrdomdocclient_need_repaint(g,this.__wbg_ptr,e,t,r,i,s,o);var a=m().getInt32(g+0,!0),l=m().getInt32(g+4,!0),u=m().getInt32(g+8,!0);if(u)throw L(l);return a!==0}finally{c.__wbindgen_add_to_stack_pointer(16)}}repaint(e,t,r,i,s,o){try{if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");const g=c.__wbindgen_add_to_stack_pointer(-16);b(this.__wbg_ptr),b(e),b(o),c.incrdomdocclient_repaint(g,this.__wbg_ptr,e,t,r,i,s,o);var a=m().getInt32(g+0,!0),l=m().getInt32(g+4,!0),u=m().getInt32(g+8,!0);if(u)throw L(l);return L(a)}finally{c.__wbindgen_add_to_stack_pointer(16)}}}Symbol.dispose&&(we.prototype[Symbol.dispose]=we.prototype.free);const Tt=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(n=>c.__wbg_pageinfo_free(n>>>0,1));class re{constructor(){throw new Error("cannot invoke `new` directly")}static __wrap(e){e=e>>>0;const t=Object.create(re.prototype);return t.__wbg_ptr=e,Tt.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Tt.unregister(this),e}free(){const e=this.__destroy_into_raw();c.__wbg_pageinfo_free(e,0)}get page_off(){if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");return b(this.__wbg_ptr),c.pageinfo_page_off(this.__wbg_ptr)>>>0}get width_pt(){if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");return b(this.__wbg_ptr),c.pageinfo_width_pt(this.__wbg_ptr)}get height_pt(){if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");return b(this.__wbg_ptr),c.pageinfo_height_pt(this.__wbg_ptr)}}Symbol.dispose&&(re.prototype[Symbol.dispose]=re.prototype.free);const Ot=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(n=>c.__wbg_pagesinfo_free(n>>>0,1));class he{constructor(){throw new Error("cannot invoke `new` directly")}static __wrap(e){e=e>>>0;const t=Object.create(he.prototype);return t.__wbg_ptr=e,Ot.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Ot.unregister(this),e}free(){const e=this.__destroy_into_raw();c.__wbg_pagesinfo_free(e,0)}get page_count(){if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");return b(this.__wbg_ptr),c.pagesinfo_page_count(this.__wbg_ptr)>>>0}page_by_number(e){if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");b(this.__wbg_ptr),b(e);const t=c.pagesinfo_page_by_number(this.__wbg_ptr,e);return t===0?void 0:re.__wrap(t)}page(e){if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");b(this.__wbg_ptr),b(e);const t=c.pagesinfo_page(this.__wbg_ptr,e);return re.__wrap(t)}width(){if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");return b(this.__wbg_ptr),c.pagesinfo_width(this.__wbg_ptr)}height(){if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");return b(this.__wbg_ptr),c.pagesinfo_height(this.__wbg_ptr)}}Symbol.dispose&&(he.prototype[Symbol.dispose]=he.prototype.free);const $t=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(n=>c.__wbg_renderpageimageoptions_free(n>>>0,1));class ne{static __unwrap(e){return e instanceof ne?e.__destroy_into_raw():0}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,$t.unregister(this),e}free(){const e=this.__destroy_into_raw();c.__wbg_renderpageimageoptions_free(e,0)}constructor(){const e=c.renderpageimageoptions_new();return this.__wbg_ptr=e>>>0,$t.register(this,this.__wbg_ptr,this),this}get pixel_per_pt(){if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");b(this.__wbg_ptr);const e=c.renderpageimageoptions_pixel_per_pt(this.__wbg_ptr);return e===4294967297?void 0:e}set pixel_per_pt(e){if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");b(this.__wbg_ptr),M(e)||b(e),c.renderpageimageoptions_set_pixel_per_pt(this.__wbg_ptr,M(e)?4294967297:Math.fround(e))}get background_color(){try{if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");const r=c.__wbindgen_add_to_stack_pointer(-16);b(this.__wbg_ptr),c.renderpageimageoptions_background_color(r,this.__wbg_ptr);var e=m().getInt32(r+0,!0),t=m().getInt32(r+4,!0);let i;return e!==0&&(i=E(e,t).slice(),c.__wbindgen_export_3(e,t*1,1)),i}finally{c.__wbindgen_add_to_stack_pointer(16)}}set background_color(e){if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");b(this.__wbg_ptr);var t=M(e)?0:z(e,c.__wbindgen_export_1,c.__wbindgen_export_2),r=T;c.renderpageimageoptions_set_background_color(this.__wbg_ptr,t,r)}get page_off(){if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");return b(this.__wbg_ptr),c.renderpageimageoptions_page_off(this.__wbg_ptr)>>>0}set page_off(e){if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");b(this.__wbg_ptr),b(e),c.renderpageimageoptions_set_page_off(this.__wbg_ptr,e)}get cache_key(){try{if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");const r=c.__wbindgen_add_to_stack_pointer(-16);b(this.__wbg_ptr),c.renderpageimageoptions_cache_key(r,this.__wbg_ptr);var e=m().getInt32(r+0,!0),t=m().getInt32(r+4,!0);let i;return e!==0&&(i=E(e,t).slice(),c.__wbindgen_export_3(e,t*1,1)),i}finally{c.__wbindgen_add_to_stack_pointer(16)}}set cache_key(e){if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");b(this.__wbg_ptr);var t=M(e)?0:z(e,c.__wbindgen_export_1,c.__wbindgen_export_2),r=T;c.renderpageimageoptions_set_cache_key(this.__wbg_ptr,t,r)}get data_selection(){if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");b(this.__wbg_ptr);const e=c.renderpageimageoptions_data_selection(this.__wbg_ptr);return e===4294967297?void 0:e}set data_selection(e){if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");b(this.__wbg_ptr),M(e)||b(e),c.renderpageimageoptions_set_data_selection(this.__wbg_ptr,M(e)?4294967297:e>>>0)}}Symbol.dispose&&(ne.prototype[Symbol.dispose]=ne.prototype.free);const Dt=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(n=>c.__wbg_rendersession_free(n>>>0,1));class q{constructor(){throw new Error("cannot invoke `new` directly")}static __wrap(e){e=e>>>0;const t=Object.create(q.prototype);return t.__wbg_ptr=e,Dt.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Dt.unregister(this),e}free(){const e=this.__destroy_into_raw();c.__wbg_rendersession_free(e,0)}get pixel_per_pt(){if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");b(this.__wbg_ptr);const e=c.rendersession_pixel_per_pt(this.__wbg_ptr);return e===4294967297?void 0:e}set pixel_per_pt(e){if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");b(this.__wbg_ptr),M(e)||b(e),c.rendersession_set_pixel_per_pt(this.__wbg_ptr,M(e)?4294967297:Math.fround(e))}get background_color(){try{if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");const r=c.__wbindgen_add_to_stack_pointer(-16);b(this.__wbg_ptr),c.rendersession_background_color(r,this.__wbg_ptr);var e=m().getInt32(r+0,!0),t=m().getInt32(r+4,!0);let i;return e!==0&&(i=E(e,t).slice(),c.__wbindgen_export_3(e,t*1,1)),i}finally{c.__wbindgen_add_to_stack_pointer(16)}}set background_color(e){if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");b(this.__wbg_ptr);var t=M(e)?0:z(e,c.__wbindgen_export_1,c.__wbindgen_export_2),r=T;c.rendersession_set_background_color(this.__wbg_ptr,t,r)}get pages_info(){if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");b(this.__wbg_ptr);const e=c.rendersession_pages_info(this.__wbg_ptr);return he.__wrap(e)}get doc_width(){if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");return b(this.__wbg_ptr),c.rendersession_doc_width(this.__wbg_ptr)}get doc_height(){if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");return b(this.__wbg_ptr),c.rendersession_doc_height(this.__wbg_ptr)}source_span(e){try{if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");const o=c.__wbindgen_add_to_stack_pointer(-16);b(this.__wbg_ptr);const a=Hn(e,c.__wbindgen_export_1),l=T;c.rendersession_source_span(o,this.__wbg_ptr,a,l);var t=m().getInt32(o+0,!0),r=m().getInt32(o+4,!0),i=m().getInt32(o+8,!0),s=m().getInt32(o+12,!0);if(s)throw L(i);let u;return t!==0&&(u=E(t,r).slice(),c.__wbindgen_export_3(t,r*1,1)),u}finally{c.__wbindgen_add_to_stack_pointer(16)}}render_in_window(e,t,r,i){let s,o;try{if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");const u=c.__wbindgen_add_to_stack_pointer(-16);b(this.__wbg_ptr),c.rendersession_render_in_window(u,this.__wbg_ptr,e,t,r,i);var a=m().getInt32(u+0,!0),l=m().getInt32(u+4,!0);return s=a,o=l,E(a,l)}finally{c.__wbindgen_add_to_stack_pointer(16),c.__wbindgen_export_3(s,o,1)}}}Symbol.dispose&&(q.prototype[Symbol.dispose]=q.prototype.free);const Bt=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(n=>c.__wbg_rendersessionoptions_free(n>>>0,1));class ot{__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Bt.unregister(this),e}free(){const e=this.__destroy_into_raw();c.__wbg_rendersessionoptions_free(e,0)}constructor(){const e=c.rendersessionoptions_new();return this.__wbg_ptr=e>>>0,Bt.register(this,this.__wbg_ptr,this),this}get pixel_per_pt(){if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");b(this.__wbg_ptr);const e=c.rendersession_pixel_per_pt(this.__wbg_ptr);return e===4294967297?void 0:e}set pixel_per_pt(e){if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");b(this.__wbg_ptr),M(e)||b(e),c.rendersession_set_pixel_per_pt(this.__wbg_ptr,M(e)?4294967297:Math.fround(e))}get background_color(){try{if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");const r=c.__wbindgen_add_to_stack_pointer(-16);b(this.__wbg_ptr),c.rendersessionoptions_background_color(r,this.__wbg_ptr);var e=m().getInt32(r+0,!0),t=m().getInt32(r+4,!0);let i;return e!==0&&(i=E(e,t).slice(),c.__wbindgen_export_3(e,t*1,1)),i}finally{c.__wbindgen_add_to_stack_pointer(16)}}set background_color(e){if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");b(this.__wbg_ptr);var t=M(e)?0:z(e,c.__wbindgen_export_1,c.__wbindgen_export_2),r=T;c.rendersessionoptions_set_background_color(this.__wbg_ptr,t,r)}get format(){try{if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");const r=c.__wbindgen_add_to_stack_pointer(-16);b(this.__wbg_ptr),c.rendersessionoptions_format(r,this.__wbg_ptr);var e=m().getInt32(r+0,!0),t=m().getInt32(r+4,!0);let i;return e!==0&&(i=E(e,t).slice(),c.__wbindgen_export_3(e,t*1,1)),i}finally{c.__wbindgen_add_to_stack_pointer(16)}}set format(e){if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");b(this.__wbg_ptr);var t=M(e)?0:z(e,c.__wbindgen_export_1,c.__wbindgen_export_2),r=T;c.rendersessionoptions_set_format(this.__wbg_ptr,t,r)}}Symbol.dispose&&(ot.prototype[Symbol.dispose]=ot.prototype.free);const Ge=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(n=>c.__wbg_typstrenderer_free(n>>>0,1));class pe{static __wrap(e){e=e>>>0;const t=Object.create(pe.prototype);return t.__wbg_ptr=e,Ge.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Ge.unregister(this),e}free(){const e=this.__destroy_into_raw();c.__wbg_typstrenderer_free(e,0)}constructor(){const e=c.typstrenderer_new();return this.__wbg_ptr=e>>>0,Ge.register(this,this.__wbg_ptr,this),this}create_session(e){try{if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");const s=c.__wbindgen_add_to_stack_pointer(-16);b(this.__wbg_ptr);let o=0;if(!M(e)){if(H(e,Be),e.__wbg_ptr===0)throw new Error("Attempt to use a moved value");o=e.__destroy_into_raw()}c.typstrenderer_create_session(s,this.__wbg_ptr,o);var t=m().getInt32(s+0,!0),r=m().getInt32(s+4,!0),i=m().getInt32(s+8,!0);if(i)throw L(r);return q.__wrap(t)}finally{c.__wbindgen_add_to_stack_pointer(16)}}reset(e){try{if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");const i=c.__wbindgen_add_to_stack_pointer(-16);if(b(this.__wbg_ptr),H(e,q),e.__wbg_ptr===0)throw new Error("Attempt to use a moved value");c.typstrenderer_reset(i,this.__wbg_ptr,e.__wbg_ptr);var t=m().getInt32(i+0,!0),r=m().getInt32(i+4,!0);if(r)throw L(t)}finally{c.__wbindgen_add_to_stack_pointer(16)}}manipulate_data(e,t,r){try{if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");const o=c.__wbindgen_add_to_stack_pointer(-16);if(b(this.__wbg_ptr),H(e,q),e.__wbg_ptr===0)throw new Error("Attempt to use a moved value");const a=z(t,c.__wbindgen_export_1,c.__wbindgen_export_2),l=T,u=De(r,c.__wbindgen_export_1),g=T;c.typstrenderer_manipulate_data(o,this.__wbg_ptr,e.__wbg_ptr,a,l,u,g);var i=m().getInt32(o+0,!0),s=m().getInt32(o+4,!0);if(s)throw L(i)}finally{c.__wbindgen_add_to_stack_pointer(16)}}session_from_artifact(e,t){try{if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");const o=c.__wbindgen_add_to_stack_pointer(-16);b(this.__wbg_ptr);const a=De(e,c.__wbindgen_export_1),l=T,u=z(t,c.__wbindgen_export_1,c.__wbindgen_export_2),g=T;c.typstrenderer_session_from_artifact(o,this.__wbg_ptr,a,l,u,g);var r=m().getInt32(o+0,!0),i=m().getInt32(o+4,!0),s=m().getInt32(o+8,!0);if(s)throw L(i);return q.__wrap(r)}finally{c.__wbindgen_add_to_stack_pointer(16)}}load_glyph_pack(e){try{if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");const i=c.__wbindgen_add_to_stack_pointer(-16);b(this.__wbg_ptr),c.typstrenderer_load_glyph_pack(i,this.__wbg_ptr,v(e));var t=m().getInt32(i+0,!0),r=m().getInt32(i+4,!0);if(r)throw L(t)}finally{c.__wbindgen_add_to_stack_pointer(16)}}render_svg_diff(e,t,r,i,s){let o,a;try{if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");const g=c.__wbindgen_add_to_stack_pointer(-16);if(b(this.__wbg_ptr),H(e,q),e.__wbg_ptr===0)throw new Error("Attempt to use a moved value");c.typstrenderer_render_svg_diff(g,this.__wbg_ptr,e.__wbg_ptr,t,r,i,s);var l=m().getInt32(g+0,!0),u=m().getInt32(g+4,!0);return o=l,a=u,E(l,u)}finally{c.__wbindgen_add_to_stack_pointer(16),c.__wbindgen_export_3(o,a,1)}}svg_data(e,t){let r,i;try{if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");const w=c.__wbindgen_add_to_stack_pointer(-16);if(b(this.__wbg_ptr),H(e,q),e.__wbg_ptr===0)throw new Error("Attempt to use a moved value");M(t)||b(t),c.typstrenderer_svg_data(w,this.__wbg_ptr,e.__wbg_ptr,M(t)?4294967297:t>>>0);var s=m().getInt32(w+0,!0),o=m().getInt32(w+4,!0),a=m().getInt32(w+8,!0),l=m().getInt32(w+12,!0),u=s,g=o;if(l)throw u=0,g=0,L(a);return r=u,i=g,E(u,g)}finally{c.__wbindgen_add_to_stack_pointer(16),c.__wbindgen_export_3(r,i,1)}}get_customs(e){if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");if(b(this.__wbg_ptr),H(e,q),e.__wbg_ptr===0)throw new Error("Attempt to use a moved value");const t=c.typstrenderer_get_customs(this.__wbg_ptr,e.__wbg_ptr);return L(t)}render_svg(e,t){try{if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");const o=c.__wbindgen_add_to_stack_pointer(-16);if(b(this.__wbg_ptr),H(e,q),e.__wbg_ptr===0)throw new Error("Attempt to use a moved value");c.typstrenderer_render_svg(o,this.__wbg_ptr,e.__wbg_ptr,v(t));var r=m().getInt32(o+0,!0),i=m().getInt32(o+4,!0),s=m().getInt32(o+8,!0);if(s)throw L(i);return r!==0}finally{c.__wbindgen_add_to_stack_pointer(16)}}create_worker(e){if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");b(this.__wbg_ptr);const t=c.typstrenderer_create_worker(this.__wbg_ptr,v(e));return L(t)}create_worker_bridge(){try{if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");const i=this.__destroy_into_raw(),s=c.__wbindgen_add_to_stack_pointer(-16);b(i),c.typstrenderer_create_worker_bridge(s,i);var e=m().getInt32(s+0,!0),t=m().getInt32(s+4,!0),r=m().getInt32(s+8,!0);if(r)throw L(t);return be.__wrap(e)}finally{c.__wbindgen_add_to_stack_pointer(16)}}mount_dom(e,t){if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");if(b(this.__wbg_ptr),H(e,q),e.__wbg_ptr===0)throw new Error("Attempt to use a moved value");const r=c.typstrenderer_mount_dom(this.__wbg_ptr,e.__wbg_ptr,v(t));return L(r)}render_page_to_canvas(e,t,r){if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");if(b(this.__wbg_ptr),H(e,q),e.__wbg_ptr===0)throw new Error("Attempt to use a moved value");let i=0;if(!M(r)){if(H(r,ne),r.__wbg_ptr===0)throw new Error("Attempt to use a moved value");i=r.__destroy_into_raw()}const s=c.typstrenderer_render_page_to_canvas(this.__wbg_ptr,e.__wbg_ptr,v(t),i);return L(s)}}Symbol.dispose&&(pe.prototype[Symbol.dispose]=pe.prototype.free);const jt=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(n=>c.__wbg_typstrendererbuilder_free(n>>>0,1));class at{__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,jt.unregister(this),e}free(){const e=this.__destroy_into_raw();c.__wbg_typstrendererbuilder_free(e,0)}constructor(){try{const i=c.__wbindgen_add_to_stack_pointer(-16);c.typstrendererbuilder_new(i);var e=m().getInt32(i+0,!0),t=m().getInt32(i+4,!0),r=m().getInt32(i+8,!0);if(r)throw L(t);return this.__wbg_ptr=e>>>0,jt.register(this,this.__wbg_ptr,this),this}finally{c.__wbindgen_add_to_stack_pointer(16)}}build(){if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");const e=this.__destroy_into_raw();b(e);const t=c.typstrendererbuilder_build(e);return L(t)}add_glyph_pack(e){if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");b(this.__wbg_ptr);const t=c.typstrendererbuilder_add_glyph_pack(this.__wbg_ptr,v(e));return L(t)}add_raw_font(e){if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");b(this.__wbg_ptr);const t=c.typstrendererbuilder_add_raw_font(this.__wbg_ptr,v(e));return L(t)}add_lazy_font(e,t){if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");b(this.__wbg_ptr);const r=c.typstrendererbuilder_add_lazy_font(this.__wbg_ptr,v(e),v(t));return L(r)}}Symbol.dispose&&(at.prototype[Symbol.dispose]=at.prototype.free);const Xn=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(n=>c.__wbg_typstworker_free(n>>>0,1));class ct{constructor(){throw new Error("cannot invoke `new` directly")}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Xn.unregister(this),e}free(){const e=this.__destroy_into_raw();c.__wbg_typstworker_free(e,0)}manipulate_data(e,t){try{if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");const o=c.__wbindgen_add_to_stack_pointer(-16);b(this.__wbg_ptr);const a=z(e,c.__wbindgen_export_1,c.__wbindgen_export_2),l=T;c.typstworker_manipulate_data(o,this.__wbg_ptr,a,l,v(t));var r=m().getInt32(o+0,!0),i=m().getInt32(o+4,!0),s=m().getInt32(o+8,!0);if(s)throw L(i);return L(r)}finally{c.__wbindgen_add_to_stack_pointer(16)}}get_pages_info(){if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");b(this.__wbg_ptr);const e=c.typstworker_get_pages_info(this.__wbg_ptr);return L(e)}render_canvas(e,t,r){try{if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");const a=c.__wbindgen_add_to_stack_pointer(-16);b(this.__wbg_ptr);const l=De(e,c.__wbindgen_export_1),u=T,g=Ft(t,c.__wbindgen_export_1),w=T,x=Ft(r,c.__wbindgen_export_1),C=T;c.typstworker_render_canvas(a,this.__wbg_ptr,l,u,g,w,x,C);var i=m().getInt32(a+0,!0),s=m().getInt32(a+4,!0),o=m().getInt32(a+8,!0);if(o)throw L(s);return L(i)}finally{c.__wbindgen_add_to_stack_pointer(16)}}}Symbol.dispose&&(ct.prototype[Symbol.dispose]=ct.prototype.free);const Wt=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(n=>c.__wbg_workerbridge_free(n>>>0,1));class be{constructor(){throw new Error("cannot invoke `new` directly")}static __wrap(e){e=e>>>0;const t=Object.create(be.prototype);return t.__wbg_ptr=e,Wt.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Wt.unregister(this),e}free(){const e=this.__destroy_into_raw();c.__wbg_workerbridge_free(e,0)}}Symbol.dispose&&(be.prototype[Symbol.dispose]=be.prototype.free);const Qn=new Set(["basic","cors","default"]);async function Yn(n,e){if(typeof Response=="function"&&n instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(n,e)}catch(r){if(n.ok&&Qn.has(n.type)&&n.headers.get("Content-Type")!=="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve Wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",r);else throw r}const t=await n.arrayBuffer();return await WebAssembly.instantiate(t,e)}else{const t=await WebAssembly.instantiate(n,e);return t instanceof WebAssembly.Instance?{instance:t,module:n}:t}}function br(){const n={};return n.wbg={},n.wbg.__wbg_appendChild_87a6cc0aeb132c06=function(){return P(function(e,t){const r=d(e).appendChild(d(t));return v(r)},arguments)},n.wbg.__wbg_call_13410aac570ffff7=function(){return P(function(e,t){const r=d(e).call(d(t));return v(r)},arguments)},n.wbg.__wbg_call_641db1bb5db5a579=function(){return P(function(e,t,r,i){const s=d(e).call(d(t),d(r),d(i));return v(s)},arguments)},n.wbg.__wbg_call_a5400b25a865cfd8=function(){return P(function(e,t,r){const i=d(e).call(d(t),d(r));return v(i)},arguments)},n.wbg.__wbg_call_f1fd202ba222e0ec=function(){return P(function(e,t,r,i,s){const o=d(e).call(d(t),d(r),d(i),d(s));return v(o)},arguments)},n.wbg.__wbg_clearRect_448c93ecc652d129=function(){return h(function(e,t,r,i,s){d(e).clearRect(t,r,i,s)},arguments)},n.wbg.__wbg_clientWidth_8a498b7a82cae772=function(){return h(function(e){const t=d(e).clientWidth;return b(t),t},arguments)},n.wbg.__wbg_clip_2009d02864d41d14=function(){return h(function(e,t){d(e).clip(d(t))},arguments)},n.wbg.__wbg_clip_be4c2f92cf5ce700=function(){return h(function(e,t){d(e).clip(d(t))},arguments)},n.wbg.__wbg_cloneNode_79d46b18d5619863=function(){return P(function(e){const t=d(e).cloneNode();return v(t)},arguments)},n.wbg.__wbg_content_a26016a510c10d06=function(){return h(function(e){const t=d(e).content;return v(t)},arguments)},n.wbg.__wbg_createElement_4909dfa2011f2abe=function(){return P(function(e,t,r){const i=d(e).createElement(E(t,r));return v(i)},arguments)},n.wbg.__wbg_createImageBitmap_d788b02f79d6bb1c=function(){return P(function(e,t){const r=d(e).createImageBitmap(d(t));return v(r)},arguments)},n.wbg.__wbg_createImageBitmap_f0017ef8064b2e1d=function(){return P(function(e,t){const r=d(e).createImageBitmap(d(t));return v(r)},arguments)},n.wbg.__wbg_createObjectURL_c80225986d2b928b=function(){return P(function(e,t){const r=URL.createObjectURL(d(t)),i=z(r,c.__wbindgen_export_1,c.__wbindgen_export_2),s=T;m().setInt32(e+4,s,!0),m().setInt32(e+0,i,!0)},arguments)},n.wbg.__wbg_document_7d29d139bd619045=function(){return h(function(e){const t=d(e).document;return M(t)?0:v(t)},arguments)},n.wbg.__wbg_drawImage_0fcff80aa0873c4e=function(){return P(function(e,t,r,i){d(e).drawImage(d(t),r,i)},arguments)},n.wbg.__wbg_drawImage_231d6a0afcfbfc3d=function(){return P(function(e,t,r,i,s,o){d(e).drawImage(d(t),r,i,s,o)},arguments)},n.wbg.__wbg_drawImage_285f406fd1771a6d=function(){return P(function(e,t,r,i){d(e).drawImage(d(t),r,i)},arguments)},n.wbg.__wbg_drawImage_4902f5efaec99256=function(){return P(function(e,t,r,i,s,o){d(e).drawImage(d(t),r,i,s,o)},arguments)},n.wbg.__wbg_drawImage_69a008f28f3150a9=function(){return P(function(e,t,r,i,s,o){d(e).drawImage(d(t),r,i,s,o)},arguments)},n.wbg.__wbg_drawImage_b8b2c11c9e042476=function(){return P(function(e,t,r,i){d(e).drawImage(d(t),r,i)},arguments)},n.wbg.__wbg_drawImage_e6fefc71cc7e1583=function(){return P(function(e,t,r,i,s,o){d(e).drawImage(d(t),r,i,s,o)},arguments)},n.wbg.__wbg_error_7534b8e9a36f1ab4=function(){return h(function(e,t){let r,i;try{r=e,i=t,console.error(E(e,t))}finally{c.__wbindgen_export_3(r,i,1)}},arguments)},n.wbg.__wbg_fillRect_81988a39149f1e60=function(){return h(function(e,t,r,i,s){d(e).fillRect(t,r,i,s)},arguments)},n.wbg.__wbg_fillRect_a160edfa11fce49b=function(){return h(function(e,t,r,i,s){d(e).fillRect(t,r,i,s)},arguments)},n.wbg.__wbg_fill_062772ac70d2abe5=function(){return h(function(e,t){d(e).fill(d(t))},arguments)},n.wbg.__wbg_fill_3aba41a9072d4324=function(){return h(function(e,t,r){d(e).fill(d(t),At[r])},arguments)},n.wbg.__wbg_fill_8fa14f899c13b2b8=function(){return h(function(e,t,r){d(e).fill(d(t),At[r])},arguments)},n.wbg.__wbg_fill_a12dd0da87e4b294=function(){return h(function(e,t){d(e).fill(d(t))},arguments)},n.wbg.__wbg_firstElementChild_27076cbfeed86254=function(){return h(function(e){const t=d(e).firstElementChild;return M(t)?0:v(t)},arguments)},n.wbg.__wbg_firstElementChild_d38fc714a20581dc=function(){return h(function(e){const t=d(e).firstElementChild;return M(t)?0:v(t)},arguments)},n.wbg.__wbg_getAttribute_8bfaf67e99ed2ee3=function(){return h(function(e,t,r,i){const s=d(t).getAttribute(E(r,i));var o=M(s)?0:z(s,c.__wbindgen_export_1,c.__wbindgen_export_2),a=T;m().setInt32(e+4,a,!0),m().setInt32(e+0,o,!0)},arguments)},n.wbg.__wbg_getContext_15e158d04230a6f6=function(){return P(function(e,t,r){const i=d(e).getContext(E(t,r));return M(i)?0:v(i)},arguments)},n.wbg.__wbg_getContext_8b08935510bf607c=function(){return P(function(e,t,r){const i=d(e).getContext(E(t,r));return M(i)?0:v(i)},arguments)},n.wbg.__wbg_get_458e874b43b18b25=function(){return P(function(e,t){const r=Reflect.get(d(e),d(t));return v(r)},arguments)},n.wbg.__wbg_globalCompositeOperation_a9343749f60fc3c3=function(){return P(function(e,t){const r=d(t).globalCompositeOperation,i=z(r,c.__wbindgen_export_1,c.__wbindgen_export_2),s=T;m().setInt32(e+4,s,!0),m().setInt32(e+0,i,!0)},arguments)},n.wbg.__wbg_globalCompositeOperation_fca573f41169da73=function(){return P(function(e,t){const r=d(t).globalCompositeOperation,i=z(r,c.__wbindgen_export_1,c.__wbindgen_export_2),s=T;m().setInt32(e+4,s,!0),m().setInt32(e+0,i,!0)},arguments)},n.wbg.__wbg_height_dcede88ab14fa083=function(){return h(function(e){const t=d(e).height;return b(t),t},arguments)},n.wbg.__wbg_incrdomdocclient_new=function(){return h(function(e){const t=we.__wrap(e);return v(t)},arguments)},n.wbg.__wbg_instanceof_CanvasRenderingContext2d_8c616198ec03b12f=function(){return h(function(e){let t;try{t=d(e)instanceof CanvasRenderingContext2D}catch{t=!1}const r=t;return W(r),r},arguments)},n.wbg.__wbg_instanceof_Element_162e4334c7d6f450=function(){return h(function(e){let t;try{t=d(e)instanceof Element}catch{t=!1}const r=t;return W(r),r},arguments)},n.wbg.__wbg_instanceof_HtmlCanvasElement_299c60950dbb3428=function(){return h(function(e){let t;try{t=d(e)instanceof HTMLCanvasElement}catch{t=!1}const r=t;return W(r),r},arguments)},n.wbg.__wbg_instanceof_HtmlDivElement_d375b5c79180c917=function(){return h(function(e){let t;try{t=d(e)instanceof HTMLDivElement}catch{t=!1}const r=t;return W(r),r},arguments)},n.wbg.__wbg_instanceof_HtmlElement_d60c51c41eb8699a=function(){return h(function(e){let t;try{t=d(e)instanceof HTMLElement}catch{t=!1}const r=t;return W(r),r},arguments)},n.wbg.__wbg_instanceof_HtmlTemplateElement_68e5e8157bcbd653=function(){return h(function(e){let t;try{t=d(e)instanceof HTMLTemplateElement}catch{t=!1}const r=t;return W(r),r},arguments)},n.wbg.__wbg_instanceof_ImageBitmap_e82e6a629ec3d3e8=function(){return h(function(e){let t;try{t=d(e)instanceof ImageBitmap}catch{t=!1}const r=t;return W(r),r},arguments)},n.wbg.__wbg_instanceof_OffscreenCanvasRenderingContext2d_6234c9d9a0c6958a=function(){return h(function(e){let t;try{t=d(e)instanceof OffscreenCanvasRenderingContext2D}catch{t=!1}const r=t;return W(r),r},arguments)},n.wbg.__wbg_instanceof_OffscreenCanvas_da9915e5258f24fb=function(){return h(function(e){let t;try{t=d(e)instanceof OffscreenCanvas}catch{t=!1}const r=t;return W(r),r},arguments)},n.wbg.__wbg_instanceof_Promise_3ec9e849bf41bdb6=function(){return h(function(e){let t;try{t=d(e)instanceof Promise}catch{t=!1}const r=t;return W(r),r},arguments)},n.wbg.__wbg_instanceof_SvgGraphicsElement_50bb1acb75ae606a=function(){return h(function(e){let t;try{t=d(e)instanceof SVGGraphicsElement}catch{t=!1}const r=t;return W(r),r},arguments)},n.wbg.__wbg_instanceof_SvgsvgElement_b0e42b8ec77c0d1e=function(){return h(function(e){let t;try{t=d(e)instanceof SVGSVGElement}catch{t=!1}const r=t;return W(r),r},arguments)},n.wbg.__wbg_instanceof_Window_12d20d558ef92592=function(){return h(function(e){let t;try{t=d(e)instanceof Window}catch{t=!1}const r=t;return W(r),r},arguments)},n.wbg.__wbg_instanceof_WorkerGlobalScope_85d487cc157fd065=function(){return h(function(e){let t;try{t=d(e)instanceof WorkerGlobalScope}catch{t=!1}const r=t;return W(r),r},arguments)},n.wbg.__wbg_lastElementChild_7b35e6537e048254=function(){return h(function(e){const t=d(e).lastElementChild;return M(t)?0:v(t)},arguments)},n.wbg.__wbg_length_6bb7e81f9d7713e4=function(){return h(function(e){const t=d(e).length;return b(t),t},arguments)},n.wbg.__wbg_log_6c7b5f4f00b8ce3f=function(){return h(function(e){console.log(d(e))},arguments)},n.wbg.__wbg_log_7917fde260a8fd39=function(){return h(function(e,t){console.log(d(e),d(t))},arguments)},n.wbg.__wbg_measureText_ce63d5548118a11b=function(){return P(function(e,t,r){const i=d(e).measureText(E(t,r));return v(i)},arguments)},n.wbg.__wbg_new_19c25a3f2fa63a02=function(){return h(function(){const e=new Object;return v(e)},arguments)},n.wbg.__wbg_new_1b0539a012a993e2=function(){return P(function(){const e=new Image;return v(e)},arguments)},n.wbg.__wbg_new_1f3a344cf3123716=function(){return h(function(){const e=new Array;return v(e)},arguments)},n.wbg.__wbg_new_2e3c58a15f39f5f9=function(){return h(function(e,t){try{var r={a:e,b:t},i=(o,a)=>{const l=r.a;r.a=0;try{return Kn(l,r.b,o,a)}finally{r.a=l}};const s=new Promise(i);return v(s)}finally{r.a=r.b=0}},arguments)},n.wbg.__wbg_new_8a6f238a6ece86ea=function(){return h(function(){const e=new Error;return v(e)},arguments)},n.wbg.__wbg_new_da9dc54c5db29dfa=function(){return h(function(e,t){const r=new Error(E(e,t));return v(r)},arguments)},n.wbg.__wbg_new_dd6c7b0f98f05245=function(){return P(function(e,t){const r=new OffscreenCanvas(e>>>0,t>>>0);return v(r)},arguments)},n.wbg.__wbg_newfromslice_074c56947bd43469=function(){return h(function(e,t){const r=new Uint8Array(Pt(e,t));return v(r)},arguments)},n.wbg.__wbg_newnoargs_254190557c45b4ec=function(){return h(function(e,t){const r=new Function(E(e,t));return v(r)},arguments)},n.wbg.__wbg_newwithlength_a167dcc7aaa3ba77=function(){return h(function(e){const t=new Uint8Array(e>>>0);return v(t)},arguments)},n.wbg.__wbg_newwithpathstring_0dbb2ef6187c1fee=function(){return P(function(e,t){const r=new Path2D(E(e,t));return v(r)},arguments)},n.wbg.__wbg_newwithu8arraysequenceandoptions_2df1a97d9f42efa4=function(){return P(function(e,t){const r=new Blob(d(e),d(t));return v(r)},arguments)},n.wbg.__wbg_nextElementSibling_4b565fe9b7cdb849=function(){return h(function(e){const t=d(e).nextElementSibling;return M(t)?0:v(t)},arguments)},n.wbg.__wbg_push_330b2eb93e4e1212=function(){return h(function(e,t){const r=d(e).push(d(t));return b(r),r},arguments)},n.wbg.__wbg_putImageData_0324b5d1f2cb58d9=function(){return P(function(e,t,r,i){d(e).putImageData(d(t),r,i)},arguments)},n.wbg.__wbg_putImageData_3413ec0b4386cceb=function(){return P(function(e,t,r,i){d(e).putImageData(d(t),r,i)},arguments)},n.wbg.__wbg_queueMicrotask_25d0739ac89e8c88=function(){return h(function(e){queueMicrotask(d(e))},arguments)},n.wbg.__wbg_queueMicrotask_4488407636f5bf24=function(){return h(function(e){const t=d(e).queueMicrotask;return v(t)},arguments)},n.wbg.__wbg_removeProperty_8912427f4d0f6361=function(){return P(function(e,t,r,i){const s=d(t).removeProperty(E(r,i)),o=z(s,c.__wbindgen_export_1,c.__wbindgen_export_2),a=T;m().setInt32(e+4,a,!0),m().setInt32(e+0,o,!0)},arguments)},n.wbg.__wbg_remove_fec7bce376b31b32=function(){return h(function(e){d(e).remove()},arguments)},n.wbg.__wbg_renderpageimageoptions_unwrap=function(){return h(function(e){const t=ne.__unwrap(L(e));return b(t),t},arguments)},n.wbg.__wbg_replaceWith_b871dd8b39227476=function(){return P(function(e,t){d(e).replaceWith(d(t))},arguments)},n.wbg.__wbg_resolve_4055c623acdd6a1b=function(){return h(function(e){const t=Promise.resolve(d(e));return v(t)},arguments)},n.wbg.__wbg_restore_1367a274a3a9c52f=function(){return h(function(e){d(e).restore()},arguments)},n.wbg.__wbg_restore_45dead792d0756f6=function(){return h(function(e){d(e).restore()},arguments)},n.wbg.__wbg_revokeObjectURL_651b859c81bf1af0=function(){return P(function(e,t){URL.revokeObjectURL(E(e,t))},arguments)},n.wbg.__wbg_save_9c2af6c4f73acbb8=function(){return h(function(e){d(e).save()},arguments)},n.wbg.__wbg_save_e5fc517a51a9e73d=function(){return h(function(e){d(e).save()},arguments)},n.wbg.__wbg_setAttribute_d1baf9023ad5696f=function(){return P(function(e,t,r,i,s){d(e).setAttribute(E(t,r),E(i,s))},arguments)},n.wbg.__wbg_setLineDash_5c96338d7fd195f9=function(){return P(function(e,t){d(e).setLineDash(d(t))},arguments)},n.wbg.__wbg_setLineDash_7792494c18c240bc=function(){return P(function(e,t){d(e).setLineDash(d(t))},arguments)},n.wbg.__wbg_setProperty_a4431938dd3e6945=function(){return P(function(e,t,r,i,s){d(e).setProperty(E(t,r),E(i,s))},arguments)},n.wbg.__wbg_setTransform_64b36b5b2fe7eb81=function(){return P(function(e,t,r,i,s,o,a){d(e).setTransform(t,r,i,s,o,a)},arguments)},n.wbg.__wbg_setTransform_e8b3bc7c8210c0e6=function(){return P(function(e,t,r,i,s,o,a){d(e).setTransform(t,r,i,s,o,a)},arguments)},n.wbg.__wbg_set_1353b2a5e96bc48c=function(){return h(function(e,t,r){d(e).set(Pt(t,r))},arguments)},n.wbg.__wbg_set_453345bcda80b89a=function(){return P(function(e,t,r){const i=Reflect.set(d(e),d(t),d(r));return W(i),i},arguments)},n.wbg.__wbg_set_90f6c0f7bd8c0415=function(){return h(function(e,t,r){d(e)[t>>>0]=L(r)},arguments)},n.wbg.__wbg_setfillStyle_a9ad5b25cf62a5bc=function(){return h(function(e,t,r){d(e).fillStyle=E(t,r)},arguments)},n.wbg.__wbg_setfillStyle_dae40abc0110b0d0=function(){return h(function(e,t,r){d(e).fillStyle=E(t,r)},arguments)},n.wbg.__wbg_setfont_73ce8e14831e02ab=function(){return h(function(e,t,r){d(e).font=E(t,r)},arguments)},n.wbg.__wbg_setglobalCompositeOperation_e5ac8e2ee1998039=function(){return P(function(e,t,r){d(e).globalCompositeOperation=E(t,r)},arguments)},n.wbg.__wbg_setglobalCompositeOperation_e5ec3a5c4c8e9185=function(){return P(function(e,t,r){d(e).globalCompositeOperation=E(t,r)},arguments)},n.wbg.__wbg_setheight_4fce583024b2d088=function(){return h(function(e,t){d(e).height=t>>>0},arguments)},n.wbg.__wbg_setinnerHTML_34e240d6b8e8260c=function(){return h(function(e,t,r){d(e).innerHTML=E(t,r)},arguments)},n.wbg.__wbg_setlineCap_8032972ab3563404=function(){return h(function(e,t,r){d(e).lineCap=E(t,r)},arguments)},n.wbg.__wbg_setlineCap_c4746ffc7c654931=function(){return h(function(e,t,r){d(e).lineCap=E(t,r)},arguments)},n.wbg.__wbg_setlineDashOffset_8e4721199e50ad71=function(){return h(function(e,t){d(e).lineDashOffset=t},arguments)},n.wbg.__wbg_setlineDashOffset_f6bdd1bf33764013=function(){return h(function(e,t){d(e).lineDashOffset=t},arguments)},n.wbg.__wbg_setlineJoin_2ff9aa15911a2360=function(){return h(function(e,t,r){d(e).lineJoin=E(t,r)},arguments)},n.wbg.__wbg_setlineJoin_30c59321fbc0bd3d=function(){return h(function(e,t,r){d(e).lineJoin=E(t,r)},arguments)},n.wbg.__wbg_setlineWidth_069d571345379833=function(){return h(function(e,t){d(e).lineWidth=t},arguments)},n.wbg.__wbg_setlineWidth_c640999c86cc71b6=function(){return h(function(e,t){d(e).lineWidth=t},arguments)},n.wbg.__wbg_setmiterLimit_4b89ef6d3f97e1b0=function(){return h(function(e,t){d(e).miterLimit=t},arguments)},n.wbg.__wbg_setmiterLimit_b4aa08d1762d6104=function(){return h(function(e,t){d(e).miterLimit=t},arguments)},n.wbg.__wbg_setonerror_6eedc824b763863d=function(){return h(function(e,t){d(e).onerror=d(t)},arguments)},n.wbg.__wbg_setonload_5f59eacd9a040d42=function(){return h(function(e,t){d(e).onload=d(t)},arguments)},n.wbg.__wbg_setsrc_953e439f2c70484a=function(){return h(function(e,t,r){d(e).src=E(t,r)},arguments)},n.wbg.__wbg_setstrokeStyle_3c450999cfcdcd2f=function(){return h(function(e,t,r){d(e).strokeStyle=E(t,r)},arguments)},n.wbg.__wbg_setstrokeStyle_e602cffe46d6113f=function(){return h(function(e,t,r){d(e).strokeStyle=E(t,r)},arguments)},n.wbg.__wbg_settype_298968e371b58a33=function(){return h(function(e,t,r){d(e).type=E(t,r)},arguments)},n.wbg.__wbg_setwidth_40a6ed203b92839d=function(){return h(function(e,t){d(e).width=t>>>0},arguments)},n.wbg.__wbg_stack_0ed75d68575b0f3c=function(){return h(function(e,t){const r=d(t).stack,i=z(r,c.__wbindgen_export_1,c.__wbindgen_export_2),s=T;m().setInt32(e+4,s,!0),m().setInt32(e+0,i,!0)},arguments)},n.wbg.__wbg_static_accessor_GLOBAL_8921f820c2ce3f12=function(){return h(function(){const e=typeof global>"u"?null:global;return M(e)?0:v(e)},arguments)},n.wbg.__wbg_static_accessor_GLOBAL_THIS_f0a4409105898184=function(){return h(function(){const e=typeof globalThis>"u"?null:globalThis;return M(e)?0:v(e)},arguments)},n.wbg.__wbg_static_accessor_SELF_995b214ae681ff99=function(){return h(function(){const e=typeof self>"u"?null:self;return M(e)?0:v(e)},arguments)},n.wbg.__wbg_static_accessor_WINDOW_cde3890479c675ea=function(){return h(function(){const e=typeof window>"u"?null:window;return M(e)?0:v(e)},arguments)},n.wbg.__wbg_stringify_b98c93d0a190446a=function(){return P(function(e){const t=JSON.stringify(d(e));return v(t)},arguments)},n.wbg.__wbg_stroke_1682cb55b83fabcd=function(){return h(function(e,t){d(e).stroke(d(t))},arguments)},n.wbg.__wbg_stroke_84ffe7bcfdec57c3=function(){return h(function(e,t){d(e).stroke(d(t))},arguments)},n.wbg.__wbg_style_32a3c8393b46a115=function(){return h(function(e){const t=d(e).style;return v(t)},arguments)},n.wbg.__wbg_then_b33a773d723afa3e=function(){return h(function(e,t,r){const i=d(e).then(d(t),d(r));return v(i)},arguments)},n.wbg.__wbg_then_e22500defe16819f=function(){return h(function(e,t){const r=d(e).then(d(t));return v(r)},arguments)},n.wbg.__wbg_transferToImageBitmap_ebacbcba8c548fc6=function(){return P(function(e){const t=d(e).transferToImageBitmap();return v(t)},arguments)},n.wbg.__wbg_typstrenderer_new=function(){return h(function(e){const t=pe.__wrap(e);return v(t)},arguments)},n.wbg.__wbg_warn_e2ada06313f92f09=function(){return h(function(e){console.warn(d(e))},arguments)},n.wbg.__wbg_wbindgencbdrop_eb10308566512b88=function(e){const t=d(e).original;if(t.cnt--==1)return t.a=0,!0;const r=!1;return W(r),r},n.wbg.__wbg_wbindgendebugstring_99ef257a3ddda34d=function(e,t){const r=st(d(t)),i=z(r,c.__wbindgen_export_1,c.__wbindgen_export_2),s=T;m().setInt32(e+4,s,!0),m().setInt32(e+0,i,!0)},n.wbg.__wbg_wbindgenisfunction_8cee7dce3725ae74=function(e){const t=typeof d(e)=="function";return W(t),t},n.wbg.__wbg_wbindgenisundefined_c4b71d073b92f3c5=function(e){const t=d(e)===void 0;return W(t),t},n.wbg.__wbg_wbindgenjsvaleq_e6f2ad59ccae1b58=function(e,t){const r=d(e)===d(t);return W(r),r},n.wbg.__wbg_wbindgenstringget_0f16a6ddddef376f=function(e,t){const r=d(t),i=typeof r=="string"?r:void 0;var s=M(i)?0:z(i,c.__wbindgen_export_1,c.__wbindgen_export_2),o=T;m().setInt32(e+4,o,!0),m().setInt32(e+0,s,!0)},n.wbg.__wbg_wbindgenthrow_451ec1a8469d7eb6=function(e,t){throw new Error(E(e,t))},n.wbg.__wbg_width_5671cc92dc930a91=function(){return h(function(e){return d(e).width},arguments)},n.wbg.__wbg_width_cb2a94a03e71098c=function(){return h(function(e){const t=d(e).width;return b(t),t},arguments)},n.wbg.__wbindgen_cast_2241b6af4c4b2941=function(){return h(function(e,t){const r=E(e,t);return v(r)},arguments)},n.wbg.__wbindgen_cast_86466341b6bc6242=function(){return h(function(e,t){const r=Et(e,t,391,Gn);return v(r)},arguments)},n.wbg.__wbindgen_cast_b3a874c70d0fc95a=function(){return h(function(e,t){const r=Et(e,t,391,Jn);return v(r)},arguments)},n.wbg.__wbindgen_cast_d6cd19b81560fd6e=function(){return h(function(e){return v(e)},arguments)},n.wbg.__wbindgen_cast_f6a59d405c61762b=function(){return h(function(e,t){const r=qn(e,t,474,Vn);return v(r)},arguments)},n.wbg.__wbindgen_object_clone_ref=function(e){const t=d(e);return v(t)},n.wbg.__wbindgen_object_drop_ref=function(e){L(e)},n}function mr(n,e){return c=n.exports,yr.__wbindgen_wasm_module=e,Z=null,Se=null,ve=null,c}function Zn(n){if(c!==void 0)return c;typeof n<"u"&&(Object.getPrototypeOf(n)===Object.prototype?{module:n}=n:console.warn("using deprecated parameters for `initSync()`; pass a single object instead"));const e=br();n instanceof WebAssembly.Module||(n=new WebAssembly.Module(n));const t=new WebAssembly.Instance(n,e);return mr(t,n)}async function yr(n){if(c!==void 0)return c;typeof n<"u"&&(Object.getPrototypeOf(n)===Object.prototype?{module_or_path:n}=n:console.warn("using deprecated parameters for the initialization function; pass a single object instead")),typeof n>"u"&&(n=vr("typst_ts_renderer_bg.wasm",typeof document>"u"?require("url").pathToFileURL(__filename).href:_e&&_e.tagName.toUpperCase()==="SCRIPT"&&_e.src||new URL("cjs/contrib/all-in-one-lite.bundle.js",document.baseURI).href));const e=br();(typeof n=="string"||typeof Request=="function"&&n instanceof Request||typeof URL=="function"&&n instanceof URL)&&(n=fetch(n));const{instance:t,module:r}=await Yn(await n,e);return mr(t,r)}let vr=async function(n,e){throw new Error("Cannot import wasm module without importer: "+n+" "+e)};function Sr(n){vr=n}let ei=async function(n,e){const t=new Function("m","return import(m)"),{readFileSync:r}=await t("fs"),i=new URL(n,e);return await r(i).buffer};const ti=typeof process<"u"&&process.versions!=null&&process.versions.node!=null;ti&&Sr(ei);const ft=Object.freeze(Object.defineProperty({__proto__:null,CreateSessionOptions:Be,IncrDomDocClient:we,PageInfo:re,PagesInfo:he,RenderPageImageOptions:ne,RenderSession:q,RenderSessionOptions:ot,TypstRenderer:pe,TypstRendererBuilder:at,TypstWorker:ct,WorkerBridge:be,default:yr,initSync:Zn,renderer_build_info:Un,setImportWasmModule:Sr},Symbol.toStringTag,{value:"Module"}));exports.$typst=Ce;exports.FetchAccessModel=Xt;exports.FetchPackageRegistry=Le;exports.TypstSnippet=U;exports.createTypstCompiler=ut;exports.createTypstRenderer=Ye;exports.loadFonts=V;exports.preloadRemoteFonts=Or;exports.preloadSystemFonts=Ke;exports.rendererBuildInfo=Zr;
