import { jsx as _jsx, jsxs as _jsxs } from "react/jsx-runtime";
import { useRef, useEffect } from 'react';
import { withGlobalRenderer } from '@myriaddreamin/typst.ts/dist/esm/contrib/global-renderer.mjs';
import * as typst from '@myriaddreamin/typst.ts';
import htmlLayerCss from './typst.css?inline';
let moduleInitOptions = {
    beforeBuild: [],
    getModule: () => '/node_modules/@myriaddreamin/typst-ts-renderer/pkg/typst_ts_renderer_bg.wasm',
};
export const TypstDocument = ({ fill, artifact, format }) => {
    const displayDivRef = useRef(null);
    const getDisplayLayerDiv = () => {
        return displayDivRef?.current;
    };
    useEffect(() => {
        const doRender = (renderer) => {
            const divElem = getDisplayLayerDiv();
            if (!divElem) {
                return;
            }
            return renderer.render({
                artifactContent: artifact,
                format: 'vector',
                backgroundColor: fill,
                container: divElem,
                pixelPerPt: 3,
            });
        };
        /// get display layer div
        const divElem = getDisplayLayerDiv();
        if (!divElem) {
            return;
        }
        /// we allow empty artifact
        if (!artifact?.length) {
            divElem.innerHTML = '';
            return;
        }
        /// render after init
        withGlobalRenderer(typst.createTypstRenderer, moduleInitOptions, doRender);
    }, [displayDivRef, fill, artifact, format]);
    return (_jsxs("div", { children: [_jsx("style", { children: htmlLayerCss }), _jsx("div", { className: "typst-app", style: { height: '0' }, ref: displayDivRef })] }));
};
/**
 * @deprecated since version v0.6.0
 */
TypstDocument.setWasmModuleInitOptions = (opts) => {
    moduleInitOptions = opts;
};
